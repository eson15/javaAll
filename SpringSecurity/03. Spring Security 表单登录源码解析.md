

# Spring Security è¡¨å•ç™»å½•æºç è§£æ

> æ–‡ç« å¯ä»¥ç™½å«–ï¼Œå…¬ä¼—å·ä¸èƒ½ä¸å…³æ³¨ï¼Œæ‰‹åŠ¨æ»‘ç¨½ğŸ¤£ğŸ¤£ &nbsp;
>
> æ¬¢è¿å¤§å®¶å…³æ³¨ï¼š**æ­¦å“¥èŠç¼–ç¨‹**ã€**Javaå¼€å‘å®å…¸**ï¼Œæ‚¨çš„æ”¯æŒï¼Œæ˜¯æˆ‘åˆ›ä½œçš„æŒç»­åŠ¨åŠ›ï¼&nbsp;&nbsp;

![æ­¦å“¥èŠç¼–ç¨‹](https://img-blog.csdnimg.cn/202002150421550.jpg)![Javaå¼€å‘å®å…¸](https://img-blog.csdnimg.cn/20200608005630228.png)

----

å…ˆçœ‹ä¸€ä¸‹æœ¬æ–‡çš„æ€ç»´å¯¼å›¾ï¼š

![å›¾1-0 è¡¨å•ç™»å½•æºç è§£ææ€»ç»“å›¾](https://img-blog.csdnimg.cn/20200926142908481.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMDM3Ng==,size_16,color_FFFFFF,t_70#pic_center)

## åŸç†è®²è§£

æ¥ä¸Šå›åˆ†è§£ï¼Œä¸Šå›æˆ‘ä»¬èŠåˆ°äº†[åŸºäºè¡¨å•ç™»å½•çš„è®¤è¯æ¨¡å¼](https://github.com/eson15/javaAll/blob/master/SpringSecurity/02.%20Spring%20Security%20%E5%9F%BA%E4%BA%8E%E8%A1%A8%E5%8D%95%E7%99%BB%E5%BD%95%E7%9A%84%E8%AE%A4%E8%AF%81%E6%A8%A1%E5%BC%8F.md)ï¼Œæ­£æ‰€è°“ï¼š"çŸ¥å…¶ç„¶ï¼Œç„¶åçŸ¥å…¶æ‰€ä»¥ç„¶"ï¼›å°±è®©æˆ‘ä»¬æ¥ä¸€æ¢ç©¶ç«Ÿï¼Œç…ç… ```Spring Security``` åˆ°åº•æ˜¯æ€ä¹ˆå®ç°è¡¨å•ç™»å½•çš„ã€‚

é¦–å…ˆæˆ‘ä»¬å…ˆæ¥å›é¡¾ä¸€ä¸‹ä¸Šç¯‡æ–‡ç« æˆ‘ä»¬åˆ¶ä½œçš„ ```Spring Security``` çš„è¡¨å•è®¤è¯çš„æµç¨‹å›¾ï¼š

![å›¾1-1 Spring Securityè¡¨å•ç™»å½•è®¤è¯æµç¨‹å›¾](https://img-blog.csdnimg.cn/20200913133846485.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMDM3Ng==,size_16,color_FFFFFF,t_70#pic_center)

ä»æµç¨‹å›¾ä¸­æˆ‘ä»¬å¯ä»¥ç®€å•çš„äº†è§£åˆ°ï¼Œæ•´ä¸ªè®¤è¯æµç¨‹å¤§è‡´ä¸Šåˆ†ä¸º3ä¸ªæ¨¡å—ï¼š

- ç™»å½•ä¿¡æ¯çš„å°è£…

- è®¤è¯

- æ”¶å°¾å¤„ç†ï¼ˆæˆåŠŸ&å¤±è´¥å¤„ç†ï¼‰

æ ¸å¿ƒæ¨¡å—ä¸º ```è®¤è¯æ¨¡å—```ï¼Œä¸‹é¢å°±æ¥çœ‹çœ‹è®¤è¯æ¨¡å— ```AuthenticationManager```çš„ç›¸å…³ç±»å›¾ï¼š

![å›¾1-2 è®¤è¯ç±»å›¾](https://img-blog.csdnimg.cn/20200926115054719.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMDM3Ng==,size_16,color_FFFFFF,t_70#pic_center)

è¯¥å›¾å¯ä»¥åˆ†2å—æ¥çœ‹ï¼Œåˆ†åˆ«æ˜¯å·¦è¾¹è´Ÿè´£æŒæ§å…¨å±€çš„"å¤§å“¥"ï¼Œä»¥åŠå³è¾¹å‹¤å‹¤æ³æ³çš„"å°å¼Ÿä»¬"ã€‚

æ€»æ‰€å‘¨çŸ¥ï¼Œ"å¤§å“¥"éƒ½ä¸éœ€è¦äº²å†äº²ä¸ºçš„ï¼Œæ‰€ä»¥"å¤§å“¥" ```AuthenticationManager``` è®¤è¯ç®¡ç†æ¥å£ï¼Œåªå®šä¹‰äº†è®¤è¯æ–¹æ³• ```authenticate()```ï¼Œå…·ä½“å’‹å®ç°å°±è®©å°å¼Ÿä»¬å»æå§~~

"äºŒå½“å®¶" ```ProviderManager``` ä¸ºè®¤è¯ç®¡ç†ç±»ï¼Œå®ç°äº† ```AuthenticationManager``` (äºŒå½“å®¶è‚¯å®šè¦å¬å¤§å“¥çš„è¯)ï¼Œå¹¶åœ¨è®¤è¯æ–¹æ³• ```authenticate()``` ä¸­å°†èº«ä»½è®¤è¯å§”æ‰˜ç»™å…·æœ‰è®¤è¯èµ„æ ¼çš„ ```AuthenticationProvider```(çœŸæ­£å¹²æ´»çš„å°å¼Ÿä»¬)ï¼›åŒæ—¶
```ProviderManaer``` æœ‰ä¸€ä¸ªæˆå‘˜å˜é‡ ```List<AuthenticationProvider> providers``` ç”¨ä»¥å­˜å‚¨äº†æ‰€æœ‰å…·ä½“æ‰§è¡Œè®¤è¯çš„"å°å¼Ÿä»¬"ã€‚

æ¥ä¸‹æ¥ä»‹ç»ä¸€ä¸‹å³è¾¹å‹¤å‹¤æ³æ³çš„"å°å¼Ÿä»¬"ï¼Œé¦–å…ˆæ˜¯```AuthenticationProvider```è®¤è¯æ¥å£ç±»ï¼Œå…¶å®šä¹‰äº†èº«ä»½è®¤è¯æ–¹æ³•```authenticate()```ï¼›è¿™ä¸ªä¹Ÿæ¯”è¾ƒå¥½ç†è§£ï¼›ä½ æ€ä¹ˆè¯æ˜è‡ªå·±æ˜¯æˆ‘çš„"å°å¼Ÿ"å‘¢ï¼Ÿå½“ç„¶æ˜¯å¾—å…¥æˆ‘é—¨ä¸ºæˆ‘å¹²æ´»æ‹‰ï¼```AuthenticationProvider```æ¥å£å°±æ˜¯èµ·è¿™ä¸ªä½œç”¨ã€‚

```AbstractUserDetailAuthenticationProvider```ä¸ºè®¤è¯æŠ½è±¡ç±»ï¼Œå®ç°äº†æ¥å£```AuthenticationProvider```ï¼ŒåŒæ—¶è¿˜å®šä¹‰äº†æŠ½è±¡æ–¹æ³•```retrieveUser()```ç”¨äºä»æ•°æ®åº“ä¸­è·å–ç”¨æˆ·ä¿¡æ¯ï¼Œä»¥åŠ```additionalAuthenticationChecks()```åšèº«ä»½è®¤è¯ï¼›è¿™å—å¯èƒ½ä¼šçŠ¯è¿·ç³Šï¼Œä¸ºå•¥å­è¿™ä¸ª"å°å¼Ÿ"è¿˜æ˜¯ä¸ªæŠ½è±¡ç±»å‘¢ï¼Ÿä¸å¿…æ…Œå¼ ï¼Œå…¶å®åªæ˜¯ä¸ºäº†ä¸€äº›åŠŸèƒ½çš„å¤ç”¨ã€‚

```DaoAuthenticationProvider```è®¤è¯ç±»ç»§æ‰¿äº```AbstractUserDetailAuthenticationProvider```æŠ½è±¡è®¤è¯ç±»ï¼Œå®ç°äº†ä¸Šé¢æåˆ°çš„2ä¸ªæŠ½è±¡æ–¹æ³•```retrieveUserå’ŒadditionalAuthenticationChecks```ï¼›å¹¶è‡ªå®šä¹‰äº†ä¸€äº›æˆå‘˜å˜é‡ï¼š```private UserDetailsService userDetailsService;``` ç”¨ä»¥ç”¨æˆ·ä¿¡æ¯æŸ¥è¯¢ï¼Œä»¥åŠ```private PasswordEncoder passwordEncoder``` ç”¨ä½œå¯†ç çš„åŠ å¯†è®¤è¯ã€‚

## æºç è§£æ

åœ¨å¤§è‡´äº†è§£äº†åŸç†ä¹‹åï¼Œå°±å¼€å§‹äº†æˆ‘ä»¬çš„é˜…è¯»æºç ä¹‹æ—…æ‹‰ï¼›åˆ†ä¸¤ä¸ªæ¨¡å—æ¥çœ‹ï¼Œåˆ†åˆ«æ˜¯ï¼š```ç™»å½•ä¿¡æ¯çš„å°è£…``` ä»¥åŠ ```è®¤è¯```ã€‚

### ç™»å½•ä¿¡æ¯çš„å°è£…

ç™»å½•ä¿¡æ¯çš„å°è£…æ˜¯æŒ‡å°†å‰ç«¯ä¼ é€’çš„```usernameå’Œpassword```å°è£…æˆ ```UsernamePasswordAuthenticationToken```ã€‚

UsernamePasswordAuthenticationFilter.classçš„ ```attemptAuthentication()```æ–¹æ³•

```java
public Authentication attemptAuthentication(HttpServletRequest request, HttpServletResponse response) throws AuthenticationException {
    if (this.postOnly && !request.getMethod().equals("POST")) {
        throw new AuthenticationServiceException("Authentication method not supported: " + request.getMethod());
    } else {
        String username = this.obtainUsername(request);
        String password = this.obtainPassword(request);
        if (username == null) {
            username = "";
        }

        if (password == null) {
            password = "";
        }

        username = username.trim();
        // å°†httpè¯·æ±‚çš„Requestå¸¦çš„è®¤è¯å‚æ•°:usernameã€passwordè½¬æ¢ä¸ºè®¤è¯çš„tokenå¯¹è±¡
        UsernamePasswordAuthenticationToken authRequest = new UsernamePasswordAuthenticationToken(username, password);
        // è®¾ç½®ä¸€äº›è¯¦ç»†ä¿¡æ¯ï¼Œ è¯¸å¦‚å‘é€è¯·æ±‚çš„ipç­‰...
        this.setDetails(request, authRequest);
        // è°ƒç”¨AuthenticationManagerçš„authenticateæ–¹æ³• æ‰§è¡Œè®¤è¯
        return this.getAuthenticationManager().authenticate(authRequest);
    }
}
```

```attemptAuthentication()``` æ–¹æ³•åšçš„äº‹æƒ…å¾ˆç®€å•ï¼Œä¸»è¦æ˜¯å°†ç™»å½•ä¿¡æ¯ ```usernameå’Œpassword``` å°è£…æˆ ```UsernamePasswordAuthenticationToken```ã€‚é‚£ä¹ˆè¿™ä¸ª```Token``` åˆ°åº•æ˜¯èµ·ä»€ä¹ˆä½œç”¨å‘¢ï¼Ÿå…¶å®ä¹Ÿå¾ˆç®€å•ï¼Œä¸»è¦æ˜¯ç”¨äºåç»­è®¤è¯çš„æ—¶å€™ï¼Œå¯»æ‰¾åŒ¹é…çš„è®¤è¯å¤„ç†å™¨ï¼Œä¾‹å¦‚è¡¨å•ç™»å½•çš„ ```UsernamePasswordAuthenticationToken``` ä¼šå”¯ä¸€åŒ¹é…ç›¸åº”çš„è®¤è¯```Provider```ã€‚

### è®¤è¯

ä»ä¸Šé¢æˆ‘ä»¬ä¹Ÿå¯ä»¥çœ‹åˆ°ï¼Œåœ¨å°†ç™»å½•ä¿¡æ¯å°è£…æˆ```Token``` åï¼Œå°±è°ƒç”¨äº† ```AuthenticationManager``` çš„ ```authenticate()``` æ–¹æ³•æ‰§è¡Œè®¤è¯æ“ä½œï¼›å›  ```AuthenticationManager```æ˜¯ä¸€ä¸ªæ¥å£ï¼Œæˆ‘ä»¬æ¥åˆ†æå®ƒçš„å®ç°ç±» ```ProviderManager```ã€‚

ProviderManager.classçš„```authenticate()```æ–¹æ³•

```java
public Authentication authenticate(Authentication authentication) throws AuthenticationException {
    Class<? extends Authentication> toTest = authentication.getClass();
    AuthenticationException lastException = null;
    Authentication result = null;
    boolean debug = logger.isDebugEnabled();

    // è·å–æ‰€æœ‰å¹²æ´»çš„â€œå°å¼Ÿâ€ providers è®¤è¯å™¨
    Iterator var6 = this.getProviders().iterator();

    // æŒ¨ä¸ªéå†ï¼Œæ‰¾åˆ°èƒ½æ”¯æŒå½“å‰ç™»å½•æ–¹å¼ï¼ˆè¡¨å•ç™»å½•---ç”±tokenæ¥åŒºåˆ†ï¼‰çš„è®¤è¯å™¨
    while(var6.hasNext()) {
        AuthenticationProvider provider = (AuthenticationProvider)var6.next();
        // ä¹‹å‰æˆ‘ä»¬ä»‹ç»è¿‡ AuthenticationProvider æ¥å£ï¼Œé‡Œé¢å®šä¹‰çš„supportsæ–¹æ³•ï¼Œå°±æ˜¯ç”¨äºåˆ¤å®šä¸€ä¸ªprovideræ”¯æŒé‚£ç§ç±»å‹çš„è®¤è¯æ–¹å¼
        if (provider.supports(toTest)) {
            if (debug) {
                logger.debug("Authentication attempt using " + provider.getClass().getName());
            }

            // åŒ¹é…åˆ°å¯¹åº”çš„provideråï¼Œè°ƒç”¨providerçš„authenticateæ–¹æ³•è¿›è¡Œè®¤è¯
            try {
                result = provider.authenticate(authentication);
                if (result != null) {
                    // è®¤è¯æˆåŠŸï¼Œcopyä¸€äº›ç»†èŠ‚çš„å‚æ•°åˆ°è®¤è¯å¯¹è±¡ä¸Š
                    this.copyDetails(authentication, result);
                    break;
                }
            } catch (AccountStatusException var11) {
                this.prepareException(var11, authentication);
                throw var11;
            } catch (InternalAuthenticationServiceException var12) {
                this.prepareException(var12, authentication);
                throw var12;
            } catch (AuthenticationException var13) {
                lastException = var13;
            }
        }
    }

    if (result == null && this.parent != null) {
        try {
            result = this.parent.authenticate(authentication);
        } catch (ProviderNotFoundException var9) {
        } catch (AuthenticationException var10) {
            lastException = var10;
        }
    }

    if (result != null) {
        if (this.eraseCredentialsAfterAuthentication && result instanceof CredentialsContainer) {
            ((CredentialsContainer)result).eraseCredentials();
        }

        this.eventPublisher.publishAuthenticationSuccess(result);
        return result;
    } else {
        if (lastException == null) {
            lastException = new ProviderNotFoundException(this.messages.getMessage("ProviderManager.providerNotFound", new Object[]{toTest.getName()}, "No AuthenticationProvider found for {0}"));
        }

        this.prepareException((AuthenticationException)lastException, authentication);
        throw lastException;
    }
}
```

```ProviderManager``` çš„ ```authenticate()``` æ–¹æ³•é˜…è¯»èµ·æ¥ä¹Ÿä¸å›°éš¾ï¼Œç›®çš„æ€§ååˆ†çš„æ˜ç¡®ï¼›é¦–å…ˆæ˜¯æ‰¾åˆ°æ‰€æœ‰çš„è®¤è¯å™¨(å¹²æ´»çš„â€œå°å¼Ÿä»¬â€)ï¼ŒæŒ¨ä¸ªéå†æ ¹æ®```Token```è¿›è¡ŒåŒ¹é…ï¼Œå¦‚æœåŒ¹é…æˆåŠŸåˆ™è¿›è¡Œè®¤è¯ã€‚å› æœ¬æ–‡åˆ†æçš„æ˜¯è¡¨å•ç™»å½•ï¼Œæ‰€ä»¥æ ¹æ®```UsernamePasswordAuthenticationToken``` åŒ¹é…åˆ°çš„ ```Provider```æ˜¯ ```DaoAuthenticationProvider```ã€‚

DaoAuthenticationProvider.classçš„ ```authenticate()```æ–¹æ³• (PS: ```DaoAuthenticationProvider```ç»§æ‰¿äºæŠ½è±¡ç±» ```AbstractUserDetailsAuthenticationProvider```ï¼Œè‡ªèº«å¹¶æ— ```authenticate()```)

```java
public Authentication authenticate(Authentication authentication) throws AuthenticationException {
    // å‰ç½®æ£€æŸ¥ è¯¥provideråªæ”¯æŒ UsernamePasswordAuthenticationTokençš„è®¤è¯æ–¹å¼
    Assert.isInstanceOf(UsernamePasswordAuthenticationToken.class, authentication,
        this.messages.getMessage("AbstractUserDetailsAuthenticationProvider.onlySupports", "Only UsernamePasswordAuthenticationToken is supported"));

    String username = authentication.getPrincipal() == null ? "NONE_PROVIDED" : authentication.getName();
    boolean cacheWasUsed = true;
    // å°è¯•ä»ç¼“å­˜ä¸­è·å–ç”¨æˆ·ä¿¡æ¯
    UserDetails user = this.userCache.getUserFromCache(username);

    if (user == null) {
        cacheWasUsed = false;

        // ä»ç¼“å­˜ä¸­è·å–ä¸åˆ°ç”¨æˆ·ä¿¡æ¯ï¼Œ è°ƒç”¨å­ç±» DaoAuthenticationProviderçš„retrieveUseræ–¹æ³•ï¼Œä»æ•°æ®åº“ä¸­åŠ è½½ç”¨æˆ·ä¿¡æ¯
        try {
            user = this.retrieveUser(username, (UsernamePasswordAuthenticationToken)authentication);
        } catch (UsernameNotFoundException var6) {
            this.logger.debug("User '" + username + "' not found");
            if (this.hideUserNotFoundExceptions) {
                throw new BadCredentialsException(this.messages.getMessage("AbstractUserDetailsAuthenticationProvider.badCredentials", "Bad credentials"));
            }

            throw var6;
        }

        Assert.notNull(user, "retrieveUser returned null - a violation of the interface contract");
    }

    try {
        // é¢„æ£€æŸ¥ï¼Œä¹‹å‰æˆ‘ä»¬ä»‹ç»UserDetailsçš„æ—¶å€™ï¼Œæœ‰æåˆ°è¿‡å‡ ä¸ªæ–¹æ³•ï¼Œä¾‹å¦‚åˆ¤æ–­è´¦å·æ˜¯å¦å¯ç”¨ã€è´¦å·æ˜¯å¦è¿‡æœŸç­‰...
        this.preAuthenticationChecks.check(user);
        // è®¤è¯æ“ä½œï¼Œ è°ƒç”¨å­ç±»DaoAuthenticationProviderå®ç°çš„additionalAuthenticationChecksè¿›è¡Œè®¤è¯
        this.additionalAuthenticationChecks(user, (UsernamePasswordAuthenticationToken)authentication);
    } catch (AuthenticationException var7) {
        if (!cacheWasUsed) {
            throw var7;
        }

        cacheWasUsed = false;
        user = this.retrieveUser(username, (UsernamePasswordAuthenticationToken)authentication);
        this.preAuthenticationChecks.check(user);
        this.additionalAuthenticationChecks(user, (UsernamePasswordAuthenticationToken)authentication);
    }

    this.postAuthenticationChecks.check(user);
    if (!cacheWasUsed) {
        this.userCache.putUserInCache(user);
    }

    Object principalToReturn = user;
    if (this.forcePrincipalAsString) {
        principalToReturn = user.getUsername();
    }

    return this.createSuccessAuthentication(principalToReturn, authentication, user);
}
```

é˜…è¯»ä»£ç æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œé¦–å…ˆå…ˆå°è¯•ç”¨ç¼“å­˜ä¸­è·å–ç”¨æˆ·ï¼Œå½“ä»ç¼“å­˜ä¸­è·å–ä¸åˆ°ç”¨æˆ·çš„æ—¶å€™ï¼Œè°ƒç”¨å­ç±»```DaoAuthenticationProvider``` å®ç°çš„ ```retrieveUser()``` æ–¹æ³•ï¼Œä»æ•°æ®åº“ä¸­åŠ è½½ç”¨æˆ·ä¿¡æ¯ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š

DaoAuthenticationProvider.classçš„ ```reretrieveUser()```æ–¹æ³•

```java
protected final UserDetails retrieveUser(String username, UsernamePasswordAuthenticationToken authentication) throws AuthenticationException {
    // æ£€æŸ¥passwordEncoder
    this.prepareTimingAttackProtection();

    try {
        // UserDetailsServiceçš„loadUserByUsernameæ–¹æ³•ï¼Œæ ¹æ®ç”¨æˆ·åä»æ•°æ®åº“ä¸­è·å–ç”¨æˆ·ä¿¡æ¯ï¼Œæ˜¯ä¸æ˜¯å¾ˆç†Ÿæ‚‰~~~
        UserDetails loadedUser = this.getUserDetailsService().loadUserByUsername(username);
        if (loadedUser == null) {
            throw new InternalAuthenticationServiceException("UserDetailsService returned null, which is an interface contract violation");
        } else {
            return loadedUser;
        }
    } catch (UsernameNotFoundException var4) {
        this.mitigateAgainstTimingAttack(authentication);
        throw var4;
    } catch (InternalAuthenticationServiceException var5) {
        throw var5;
    } catch (Exception var6) {
        throw new InternalAuthenticationServiceException(var6.getMessage(), var6);
    }
}

private void prepareTimingAttackProtection() {
    if (this.userNotFoundEncodedPassword == null) {
        this.userNotFoundEncodedPassword = this.passwordEncoder.encode("userNotFoundPassword");
    }

}

```

å½“åŠ è½½å®Œç”¨æˆ·ä¿¡æ¯ï¼Œè¿›è¡Œé¢„æ£€æŸ¥åï¼Œå°±è°ƒç”¨å­ç±»DaoAuthenticationProvider.classçš„```additionalAuthenticationChecks()``` è¿›è¡Œæœ€ç»ˆçš„è®¤è¯æ ¡éªŒ

DaoAuthenticationProvider.classçš„```additionalAuthenticationChecks()```æ–¹æ³•

```java
protected void additionalAuthenticationChecks(UserDetails userDetails, UsernamePasswordAuthenticationToken authentication) throws AuthenticationException {
    // è®¤è¯è¯·æ±‚çš„å¯†ç éç©ºåˆ¤æ–­
    if (authentication.getCredentials() == null) {
        this.logger.debug("Authentication failed: no credentials provided");
        throw new BadCredentialsException(this.messages.getMessage("AbstractUserDetailsAuthenticationProvider.badCredentials", "Bad credentials"));
    } else {
        // è°ƒç”¨passwordEncoderçš„matchesåŒ¹é…æ–¹æ³•ï¼Œåˆ¤æ–­å‰ç«¯ä¼ é€’çš„å¯†ç å’Œä»æ•°æ®åº“loadå‡ºæ¥çš„å¯†ç æ˜¯å¦åŒ¹é…
        String presentedPassword = authentication.getCredentials().toString();
        if (!this.passwordEncoder.matches(presentedPassword, userDetails.getPassword())) {
            this.logger.debug("Authentication failed: password does not match stored value");
            throw new BadCredentialsException(this.messages.getMessage("AbstractUserDetailsAuthenticationProvider.badCredentials", "Bad credentials"));
        }
    }
}
```

## æ€»ç»“

æ€»ä½“æ¥è¯´ï¼Œä»ç™»å½•ä¿¡æ¯çš„å°è£…åˆ°æœ€ç»ˆçš„è®¤è¯éƒ½æ¯”è¾ƒçš„è¿è´¯ï¼›æ—¢ç„¶æˆ‘ä»¬å·²ç»å¯¹```Spring Security```çš„è®¤è¯ä½“ç³»æœ‰äº†ä¸€å®šçš„äº†è§£ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ä¹Ÿæ¥å°è¯•å®šåˆ¶åŒ–å¼€å‘è‡ªå·±çš„è®¤è¯æ–¹å¼å§ï¼

æœ¬æ–‡ä¸ºä¸ªäººåœ¨å­¦ä¹ è¿‡ç¨‹ä¸­çš„å­¦ä¹ æ€»ç»“ï¼Œå¦‚æœ‰ä¸æ­£ç¡®ä¹‹å¤„ï¼Œæ„Ÿè°¢æŒ‡å‡º

----

> æ–‡ç« å¯ä»¥ç™½å«–ï¼Œå…¬ä¼—å·ä¸èƒ½ä¸å…³æ³¨ï¼Œæ‰‹åŠ¨æ»‘ç¨½ğŸ¤£ğŸ¤£ &nbsp;
>
> æ¬¢è¿å¤§å®¶å…³æ³¨ï¼š**æ­¦å“¥èŠç¼–ç¨‹**ã€**Javaå¼€å‘å®å…¸**ï¼Œæ‚¨çš„æ”¯æŒï¼Œæ˜¯æˆ‘åˆ›ä½œçš„æŒç»­åŠ¨åŠ›ï¼&nbsp;&nbsp;

![æ­¦å“¥èŠç¼–ç¨‹](https://img-blog.csdnimg.cn/202002150421550.jpg)![Javaå¼€å‘å®å…¸](https://img-blog.csdnimg.cn/20200608005630228.png)

----
