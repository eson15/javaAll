> æ–‡ç« å¯ä»¥ç™½å«–ï¼Œè€é“ä»¬é¡ºä¾¿å…³æ³¨ä¸€ä¸‹æˆ‘çš„å…¬ä¼—å·ï¼Œæ‰‹åŠ¨æ»‘ç¨½ğŸ¤£ğŸ¤£ &nbsp;
>
> æ¬¢è¿å¤§å®¶å…³æ³¨ï¼š**æ­¦å“¥èŠç¼–ç¨‹**ã€**Javaå¼€å‘å®å…¸**ã€**Javaç§ƒå¤´å“¥**ï¼Œæ‚¨çš„æ”¯æŒï¼Œæ˜¯æˆ‘åˆ›ä½œçš„æŒç»­åŠ¨åŠ›ï¼&nbsp;&nbsp;

![æ­¦å“¥èŠç¼–ç¨‹](https://img-blog.csdnimg.cn/202002150421550.jpg)![Javaå¼€å‘å®å…¸](https://img-blog.csdnimg.cn/20200608005630228.png)![Javaç§ƒå¤´å“¥](https://img-blog.csdnimg.cn/20201025170941235.png)

----



## rabbitMQåœ¨springbootä¸­çš„é…ç½®

è¿™éƒ¨åˆ†é…ç½®å…¶å®å¾ˆç®€å•ï¼Œspringbootå·²ç»åœ¨startä¸­å°è£…äº†å¾ˆå¤šåŸºç¡€é…ç½®å’Œapiï¼Œæˆ‘ä»¬ä¸»è¦é…ç½®å¦‚ä¸‹æ–¹é¢å³å¯ï¼š

1. pom.xmlå¼•å…¥rabbitMQ

2. application.yml/application.propertiesä¸­æ·»åŠ rabbitMQè¿æ¥ä¿¡æ¯

3. é…ç½®å¸¸ç”¨çš„äº¤æ¢æœºï¼Œé˜Ÿåˆ—ï¼Œå¹¶å°†é˜Ÿåˆ—ç»‘å®šè‡³äº¤æ¢æœº

4. å‘é€æ¶ˆæ¯è‡³æŒ‡å®šäº¤æ¢æœº

   

### 1. æ·»åŠ mavenä¾èµ–

```xml
<!-- springbootçš„starterä¸­å¸®æˆ‘ä»¬ç®¡ç†å¥½äº†jaråŒ…çš„ä¾èµ–ï¼Œåªéœ€è¦æ·»åŠ ä¸€ä¸ªstarterå³å¯ -->
<dependency>
  <groupId>org.springframework.boot</groupId>
  <artifactId>spring-boot-starter-amqp</artifactId>
</dependency>

<!-- é¡¹ç›®éœ€è¦ä»¥webæœåŠ¡å½¢å¼è¿è¡Œï¼Œå¯åŠ¨å¸¸å¼€çš„æ¶ˆè´¹è€…ç›‘å¬æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå› æ­¤åŠ å…¥webçš„starter -->
<dependency>
  <groupId>org.springframework.boot</groupId>
  <artifactId>spring-boot-starter-web</artifactId>
</dependency>

<!-- ä¸ºäº†æµ‹è¯•ï¼Œæˆ‘è¿˜æ·»åŠ äº†spring test å’Œjunit æ ¹æ®è‡ªå·±é¡¹ç›®éœ€è¦ï¼Œå¯ä»¥ä¸æ·»åŠ  -->
 <dependency>
   <groupId>org.springframework.boot</groupId>
   <artifactId>spring-boot-starter-logging</artifactId>
</dependency>

<dependency>
  <groupId>org.springframework.boot</groupId>
  <artifactId>spring-boot-starter-test</artifactId>
  <scope>test</scope>
  <exclusions>
    <exclusion>
      <groupId>org.junit.vintage</groupId>
      <artifactId>junit-vintage-engine</artifactId>
    </exclusion>
  </exclusions>
</dependency>

<dependency>
  <groupId>org.springframework.amqp</groupId>
  <artifactId>spring-rabbit-test</artifactId>
  <scope>test</scope>
</dependency>

<dependency>
  <groupId>junit</groupId>
  <artifactId>junit</artifactId>
  <version>4.13</version>
  <scope>test</scope>
</dependency>

```
### 2. æ·»åŠ rabbitMQè¿æ¥é…ç½®

```yaml
server:
  port: 3003
spring:
  application:
    name: rabbitmq-producer
  rabbitmq:
    host: 192.168.1.128
    port: 5672
    username: guest
    password: guest
    virtual-host: /
```



### 3.  åŸºç¡€beané…ç½®

```java
import org.springframework.amqp.core.*;
import org.springframework.beans.factory.annotation.Qualifier;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

/**
 * @author neotao
 */
@Configuration
public class RabbitMqConfig {

    public static final String CH03_DIRECT_EXCHANGE = "CH03_DIRECT_EXCHANGE";
    public static final String CH03_QUEUE_NAME = "CH03_QUEUE_NAME";
    public static final String CH03_ROUTING_KEY = "CH03_ROUTING_KEY";


    /**
     * å£°æ˜æ–°çš„ç›´è¿äº¤æ¢æœº
     *
     * @return
     */
    @Bean
    public Exchange directExchange() {
        //durable(true) æŒä¹…åŒ–ï¼Œmqé‡å¯ä¹‹åäº¤æ¢æœºè¿˜åœ¨
        return ExchangeBuilder.directExchange(CH03_DIRECT_EXCHANGE).durable(true).build();
    }

    /**
     * å£°æ˜æ–°çš„é˜Ÿåˆ—
     *
     * @return
     */
    @Bean
    public Queue directQueue() {
        return new Queue(CH03_QUEUE_NAME);
    }

    /**
     * å°†æ¶ˆæ¯é˜Ÿåˆ—å’Œäº¤æ¢æœºç»‘å®š
     *
     * @param queue
     * @param exchange
     * @return
     */
    @Bean
    public Binding defaultExchangeQueueBind(@Qualifier(value = "directQueue") Queue queue,
                                            @Qualifier(value = "directExchange") Exchange exchange) {
        return BindingBuilder.bind(queue).to(exchange).with(CH03_ROUTING_KEY).noargs();
    }

}
```



æ¶ˆè´¹è€…çº¿ç¨‹ï¼ˆç›‘å¬æ¶ˆæ¯é˜Ÿåˆ—ï¼‰ï¼Œé€šè¿‡springæä¾›çš„`@RabbitListener`å¯ä»¥è®©springå®¹å™¨è‡ªåŠ¨ç›‘å¬æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå½“é˜Ÿåˆ—ä¸­æœ‰æ¶ˆæ¯æ—¶ï¼Œè‡ªåŠ¨è°ƒç”¨æˆ‘ä»¬çš„`handleDirectMsg()`æ–¹æ³•

```java
@Component
public class Consumer {
    @RabbitListener(queues = {RabbitMqConfig.CH03_QUEUE_NAME})
    public void handleDirectMsg(String msg, Message message, Channel channel) {
        System.out.println("æ”¶åˆ°æ¶ˆæ¯" + msg);
    }
}
```



ç”Ÿäº§è€…çº¿ç¨‹ï¼Œç”±äºç”Ÿäº§è€…å¯ä»¥æ˜¯ç³»ç»Ÿä¸­æ¥å£/æœåŠ¡ï¼Œä¹Ÿå¯ä»¥æ˜¯å…¶å®ƒé¡¹ç›®ä¸­æŸä¸ªæ¥å£ï¼Œå› æ­¤æˆ‘è¿™é‡Œä»¥å•å…ƒæµ‹è¯•è¿è¡Œï¼Œç”¨æ¥æ¨¡æ‹Ÿç”Ÿäº§è€…ä¸æ–­å‘æ¶ˆæ¯çš„è¿‡ç¨‹ã€‚æ¯æ¬¡éšæœºåœé¡¿0-1ç§’ï¼Œè¿ç»­å‘100æ¡ï¼Œä»¥ä¾¿äºåœ¨rabbitMQçš„webç®¡ç†ç•Œé¢çœ‹åˆ°ç”Ÿäº§å’Œæ¶ˆè´¹æŠ˜çº¿å›¾ã€‚

```java
@SpringBootTest
@RunWith(SpringRunner.class)
public class Producer {
    @Autowired
    RabbitTemplate rabbitTemplate;

    @Test
    public void testDirect() throws InterruptedException {
        String msg = "default msg send to direct exchange message";
        int i = 100;
        while (i > 0) {
            //routing key å¯¹åº” é˜Ÿåˆ—çš„åç§°
            rabbitTemplate.send(RabbitMqConfig.CH03_QUEUE_NAME, new Message(("[MSG]" + i + msg).getBytes(), new MessageProperties()));
            //å¤æ‚æ¶ˆæ¯å»ºè®®ä½¿ç”¨convertAndSendæ–¹æ³•ï¼Œé€šè¿‡MessagePropertiesé…ç½®æ¶ˆæ¯å‚æ•°æ¥å‘é€
            //rabbitTemplate.convertAndSend()
            i--;
            TimeUnit.MILLISECONDS.sleep(new Double(Math.random() * 1000).intValue());
        }
    }
}
```



### 4. ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…æµ‹è¯•

å…ˆå¯åŠ¨springbooté¡¹ç›®ï¼Œé¡¹ç›®ä¸­åŒ…å«ä¸€ä¸ª`@Component`æ³¨è§£è‡ªåŠ¨æ³¨å…¥çš„æ¶ˆè´¹è€…beanã€‚æ­¤æ—¶è¿˜æ²¡æœ‰æ¶ˆæ¯äº§ç”Ÿã€‚

ç„¶åå¯åŠ¨å•å…ƒæµ‹è¯•ï¼Œå•å…ƒæµ‹è¯•æ˜¯ä¸€ä¸ªç”Ÿäº§è€…ï¼Œè¿™ä¸ªç”Ÿäº§è€…ä¼šå‘é€å¤šæ¡æ¶ˆæ¯åˆ°mqæœåŠ¡å™¨ã€‚è¿™æ—¶ï¼Œç”±äºé¡¹ç›®ä¸­æ¶ˆè´¹è€…ç›‘å¬äº†æœåŠ¡å™¨é˜Ÿåˆ—ï¼Œäºæ˜¯ä¾¿å¯ä»¥ä¸æ–­æ”¶åˆ°æ¶ˆæ¯äº†ï¼Œé€šè¿‡mqçš„ç®¡ç†ç•Œé¢ä¹Ÿå¯ä»¥çœ‹åˆ°æ¶ˆæ¯çš„ç”Ÿäº§å’Œæ¶ˆè´¹æŠ˜çº¿å›¾ã€‚



## RabbitMQåœ¨xmlä¸­é…ç½®

è¿˜æ˜¯ä»ç®€å•çš„directäº¤æ¢æœºæ¥è¯´



1. å¯¼å…¥pomä¾èµ–
2. åˆ›å»ºç”Ÿäº§è€…
3. åˆ›å»ºæ¶ˆè´¹è€…
4. é…ç½®xmlä¸­ç”Ÿäº§è€…ã€æ¶ˆè´¹è€…ã€ç›´è¿äº¤æ¢æœºã€é˜Ÿåˆ—ï¼Œå¹¶å°†é˜Ÿåˆ—å’Œäº¤æ¢æœºç»‘å®š
5. å¯åŠ¨æµ‹è¯•

### 1. æ·»åŠ mavenä¾èµ–

```xml

    <properties>
        <!-- springç‰ˆæœ¬å· -->
        <spring.version>5.1.0.RELEASE</spring.version>
        <!-- log4jæ—¥å¿—æ–‡ä»¶ç®¡ç†åŒ…ç‰ˆæœ¬ -->
        <slf4j.version>1.6.6</slf4j.version>
        <log4j.version>1.2.12</log4j.version>
        <!-- junitç‰ˆæœ¬å· -->
        <junit.version>4.10</junit.version>
    </properties>

    <dependencies>
        <!-- spring è‚¯å®šæ˜¯å¿…é¡»çš„ -->
        <dependency>
            <groupId>org.springframework</groupId>
            <artifactId>spring-core</artifactId>
            <version>${spring.version}</version>
        </dependency>
        <dependency>
            <groupId>org.springframework</groupId>
            <artifactId>spring-context</artifactId>
            <version>${spring.version}</version>
        </dependency>
        <dependency>
            <groupId>org.springframework</groupId>
            <artifactId>spring-context-support</artifactId>
            <version>${spring.version}</version>
        </dependency>
        <dependency>
            <groupId>org.springframework</groupId>
            <artifactId>spring-aspects</artifactId>
            <version>${spring.version}</version>
        </dependency>

        <!--rabbitmqä¾èµ– -->
        <dependency>
            <groupId>org.springframework.amqp</groupId>
            <artifactId>spring-rabbit</artifactId>
            <version>1.3.5.RELEASE</version>
        </dependency>
        <!-- æ—¥å¿—æ–‡ä»¶ç®¡ç†åŒ… -->
        <dependency>
            <groupId>log4j</groupId>
            <artifactId>log4j</artifactId>
            <version>${log4j.version}</version>
        </dependency>
        <dependency>
            <groupId>org.slf4j</groupId>
            <artifactId>slf4j-api</artifactId>
            <version>${slf4j.version}</version>
        </dependency>
        <dependency>
            <groupId>org.slf4j</groupId>
            <artifactId>slf4j-log4j12</artifactId>
            <version>${slf4j.version}</version>
        </dependency>

        <!--å•å…ƒæµ‹è¯•ä¾èµ– -->
        <dependency>
            <groupId>junit</groupId>
            <artifactId>junit</artifactId>
            <version>${junit.version}</version>
            <scope>test</scope>
        </dependency>
    </dependencies>
```



### 2. åˆ›å»ºç”Ÿäº§è€…

```java
/**
 * directäº¤æ¢æœºå‘é€æ¶ˆæ¯
 */
@Service
public class Producer01 {
    private Logger logger = LoggerFactory.getLogger(Producer01.class);

    /**
     * amqpTemplate direct äº¤æ¢æœº
     */
    @Resource(name = "amqpTemplate")
    private AmqpTemplate amqpTemplate;

    /**
     * ä¸€ä¸ªdirectäº¤æ¢æœºæ¢æœºçš„å‘é€ä¾‹å­
     *
     * @param message
     */
    public void sendMessage(Object message) {
        logger.info("å‘é€æ¶ˆæ¯:" + message);

        // Exchange ä¸º direct æ¨¡å¼ï¼Œç›´æ¥æŒ‡å®šroutingKey
        amqpTemplate.convertAndSend("SAMPLE_CH03_XML_MSG_01_KEY", 
 					"[Directäº¤æ¢æœºï¼šSAMPLE_CH03_XML_MSG_01_KEY] " + message);
    }
}
```



### 3. åˆ›å»ºæ¶ˆè´¹è€…
```java
public class Consumer01 implements MessageListener {
    private Logger logger = LoggerFactory.getLogger(Consumer01.class);

    public void onMessage(Message message) {
        logger.info("æ¶ˆè´¹è€…01 æ¥æ”¶æ¶ˆæ¯ : " + new String(message.getBody()));
    }
}
```



### 4. é…ç½®ç”Ÿäº§è€…ã€æ¶ˆè´¹è€…ã€é˜Ÿåˆ—ã€äº¤æ¢æœºã€å¹¶ç»‘å®š

```xml
<!--é…ç½®connection-factoryï¼ŒæŒ‡å®šè¿æ¥rabbit serverå‚æ•° -->
<rabbit:connection-factory id="connectionFactory" virtual-host="/" 
username="guest" password="guest" host="127.0.0.1" port="5672"/>

<!--é€šè¿‡æŒ‡å®šä¸‹é¢çš„adminä¿¡æ¯ï¼Œè‡ªåŠ¨åˆ›å»ºexchangeå’Œqueue -->
<rabbit:admin id="connectAdmin" connection-factory="connectionFactory"/>

<!--  å¼€å§‹å®šä¹‰é˜Ÿåˆ—äº†ã€‚è¿™é‡Œçš„é˜Ÿåˆ—ä¸»è¦ç”¨äºå‘æ¶ˆæ¯ï¼Œåé¢çš„æ¶ˆè´¹è€…ä¹Ÿå¯ä»¥ç›‘å¬è¿™ä¸ªé˜Ÿåˆ—ï¼Œ
å®ç°æŒ‡å®šé˜Ÿåˆ—æ¶ˆæ¯çš„æ”¶ã€å‘ -->
<!--å®šä¹‰queue -->
<rabbit:queue name="XML_DEMO_QUEUE01" declared-by="connectAdmin"/>

<!--å®šä¹‰directäº¤æ¢æœº,01 02 éƒ½ç”¨è¿™ä¸ªäº¤æ¢æœº -->
<rabbit:direct-exchange name="DIRECT_EXCHANGE_01_02" declared-by="connectAdmin">
    <rabbit:bindings>
        <rabbit:binding queue="XML_DEMO_QUEUE01" key="SAMPLE_CH03_XML_MSG_01_KEY">
        </rabbit:binding>
    </rabbit:bindings>
</rabbit:direct-exchange>

<!--å®šä¹‰rabbitTemplateç”¨äºæ•°æ®çš„æ¥æ”¶å’Œå‘é€ -->
<rabbit:template id="amqpTemplate" connection-factory="connectionFactory" exchange="DIRECT_EXCHANGE_01_02"/>

<!--ç¬¬ä¸€ä¸ªæ¶ˆè´¹è€…,å¹¶ç›‘å¬ä¸Šé¢çš„ç›´è¿äº¤æ¢æœºå£°æ˜çš„é˜Ÿåˆ— -->
<bean id="consumer01" class="com.neotao.rabbitmq.samples.ch03.consumer.Consumer01"/>

<!-- å®šä¹‰ç›‘å¬å™¨ï¼Œç›‘è§†rabbitMQæœåŠ¡ç«¯é˜Ÿåˆ—queueï¼Œå½“æœ‰æ¶ˆæ¯åˆ°è¾¾æ—¶ä¼šé€šçŸ¥ç›‘å¬åœ¨å¯¹åº”çš„é˜Ÿåˆ—ä¸Šçš„ç›‘å¬å¯¹è±¡ -->
<rabbit:listener-container connection-factory="connectionFactory">
    <rabbit:listener queues="XML_DEMO_QUEUE01" ref="consumer01"/>
</rabbit:listener-container>
```



### 5. åˆ›å»ºå¯åŠ¨ç¨‹åºï¼ŒåŠ è½½/è¿è¡Œæ¶ˆè´¹è€…ã€ç”Ÿäº§è€…

```java
/**
 * å®¹å™¨å¯åŠ¨ç¨‹åºï¼Œç±»ä¼¼äºé¡¹ç›®ä¸­çš„tomcat
 * xml demoç”Ÿäº§è€…æµ‹è¯•
 *
 * @author neotao
 */
public class ApplicationCh03XmlTest {

    private static ApplicationContext context = null;

    public static void sendMessage() {
        context = new ClassPathXmlApplicationContext("applicationContext.xml");
        Producer01 producer01 = (Producer01) context.getBean("producer01");
        int k = 20;
        while (k > 0) {
            producer01.sendMessage("01ç”Ÿäº§è€…ã€‚ç¬¬" + k + "æ¬¡å‘é€çš„æ¶ˆæ¯");
            k--;
            try {
                Thread.sleep(100);
            } catch (Exception e) {
                e.printStackTrace();
            }
        }
    }

    public static void main(String[] args) {
        sendMessage();
    }
}
```



## ç»“æŸè¯­

è‡³æ­¤ springboot ã€xml é¡¹ç›®é…ç½®rabbitMQ ä¾¿å®Œæˆäº†ã€‚

å°†ä¸¤ç§æ–¹å¼ç»“åˆèµ·æ¥çœ‹ï¼Œè™½ç„¶å½¢å¼ä¸ä¸€æ ·ï¼Œä½†æ˜¯åšçš„äº‹æƒ…è¿˜æ˜¯ä¸€æ ·çš„ï¼š

1. é…ç½®è¿æ¥ä¿¡æ¯
2. åˆ›å»ºäº¤æ¢æœº
3. åˆ›å»ºé˜Ÿåˆ—
4. ç»‘å®šé˜Ÿåˆ—å’Œäº¤æ¢æœº
5. åˆ›å»ºç”Ÿäº§è€…ï¼Œ(æŒ‡å®šè·¯ç”±é”®/é˜Ÿåˆ—å)å‘é€æ¶ˆæ¯åˆ°æŒ‡å®šé˜Ÿåˆ—
6. åˆ›å»ºæ¶ˆè´¹è€…ï¼Œç›‘å¬é˜Ÿåˆ—ï¼Œæ”¶åˆ°é˜Ÿåˆ—ä¸­å‘æ¥çš„(ç‰¹å®šè·¯ç”±é”®çš„)æ¶ˆæ¯



ç›®å‰çš„ä¸‰ä¸ªdemoéƒ½è¿˜æ˜¯å¾ˆç®€å•çš„ç›´è¿äº¤æ¢æœºï¼Œéƒ½æ˜¯1-1 å¯¹åº”çš„æ¶ˆæ¯ï¼Œè¿˜æ²¡æœ‰æ­£å¼è¿›å…¥rabbitMQåŠŸèƒ½ä»‹ç»ã€‚ä¸‹ä¸€èŠ‚è®²ä¸€ä¸‹RabbitMQä¸åŒäº¤æ¢æœºç±»å‹çš„æ¶ˆæ¯å‘é€ä¸æ¥æ”¶ï¼Œå¹¶é€šè¿‡å®ƒä»¬çš„ç‰¹ç‚¹åˆ†æä¸€äº›å¸¸è§åœºæ™¯ã€‚

----

> æ–‡ç« å¯ä»¥ç™½å«–ï¼Œè€é“ä»¬é¡ºä¾¿å…³æ³¨ä¸€ä¸‹æˆ‘çš„å…¬ä¼—å·ï¼Œæ‰‹åŠ¨æ»‘ç¨½ğŸ¤£ğŸ¤£ &nbsp;
>
> æ¬¢è¿å¤§å®¶å…³æ³¨ï¼š**æ­¦å“¥èŠç¼–ç¨‹**ã€**Javaå¼€å‘å®å…¸**ã€**Javaç§ƒå¤´å“¥**ï¼Œæ‚¨çš„æ”¯æŒï¼Œæ˜¯æˆ‘åˆ›ä½œçš„æŒç»­åŠ¨åŠ›ï¼&nbsp;&nbsp;

![æ­¦å“¥èŠç¼–ç¨‹](https://img-blog.csdnimg.cn/202002150421550.jpg)![Javaå¼€å‘å®å…¸](https://img-blog.csdnimg.cn/20200608005630228.png)![Javaç§ƒå¤´å“¥](https://img-blog.csdnimg.cn/20201025170941235.png)