> æ–‡ç« å¯ä»¥ç™½å«–ï¼Œè€é“ä»¬é¡ºä¾¿å…³æ³¨ä¸€ä¸‹æˆ‘çš„å…¬ä¼—å·ï¼Œæ‰‹åŠ¨æ»‘ç¨½ğŸ¤£ğŸ¤£ &nbsp;
>
> æ¬¢è¿å¤§å®¶å…³æ³¨ï¼š**æ­¦å“¥èŠç¼–ç¨‹**ã€**Javaå¼€å‘å®å…¸**ã€**Javaç§ƒå¤´å“¥**ï¼Œæ‚¨çš„æ”¯æŒï¼Œæ˜¯æˆ‘åˆ›ä½œçš„æŒç»­åŠ¨åŠ›ï¼&nbsp;&nbsp;

![æ­¦å“¥èŠç¼–ç¨‹](https://img-blog.csdnimg.cn/202002150421550.jpg)![Javaå¼€å‘å®å…¸](https://img-blog.csdnimg.cn/20200608005630228.png)![Javaç§ƒå¤´å“¥](https://img-blog.csdnimg.cn/20201025170941235.png)

----

å‡è®¾ç°åœ¨æœ‰ä¸ªå…¬å…±çš„å˜é‡ dataï¼Œæœ‰ä¸åŒçš„çº¿ç¨‹éƒ½å¯ä»¥å»æ“ä½œå®ƒï¼Œå¦‚æœåœ¨ä¸åŒçš„çº¿ç¨‹å¯¹ data æ“ä½œå®Œæˆåå†å»å–è¿™ä¸ª dataï¼Œé‚£ä¹ˆè‚¯å®šä¼šå‡ºç°çº¿ç¨‹é—´çš„æ•°æ®æ··ä¹±é—®é¢˜ï¼Œå› ä¸º A çº¿ç¨‹åœ¨å– data æ•°æ®å‰å¯èƒ½ B çº¿ç¨‹åˆå¯¹å…¶è¿›è¡Œäº†ä¿®æ”¹ï¼Œä¸‹é¢å†™ä¸ªç¨‹åºæ¥è¯´æ˜ä¸€ä¸‹è¯¥é—®é¢˜ï¼š

```java
public class ThreadScopeShareData {

	private static int data = 0;//å…¬å…±çš„æ•°æ®
	
	public static void main(String[] args) {
		for(int i = 0; i < 2; i ++) { //å¼€å¯ä¸¤ä¸ªçº¿ç¨‹
			new Thread(new Runnable() {
				
				@Override
				public void run() {
					int temp = new Random().nextInt();
					System.out.println(Thread.currentThread().getName() + " has put a data: " + temp); //æ‰“å°å‡ºæ¥ä¸ºäº†çœ‹æ•ˆæœ
					data = temp; //æ“ä½œæ•°æ®ï¼šèµ‹æ–°å€¼

					new TestA().getData();
					new TestB().getData();
				}
			}).start();
		}
	}
	
	static class TestA {
		public void getData() {
			System.out.println("A get data from " + Thread.currentThread().getName() + ": " + data);//å–å‡ºå…¬å…±æ•°æ®data
		}
	}
	
	static class TestB {
		public void getData() {
			System.out.println("B get data from " + Thread.currentThread().getName() + ": " + data);
		}
	}
}
```
æ¥çœ‹ä¸€ä¸‹æ‰“å°å‡ºæ¥çš„ç»“æœï¼š
>Thread-0 has put a data: -1885917900<br>
Thread-1 has put a data: -1743455464<br>
A get data from Thread-0: -1743455464<br>
A get data from Thread-1: -1743455464<br>
B get data from Thread-1: -1743455464<br>
B get data from Thread-0: -1743455464<br>

ä»ç»“æœä¸­å¯ä»¥çœ‹å‡ºï¼Œä¸¤æ¬¡å¯¹ data èµ‹çš„å€¼ç¡®å®ä¸ä¸€æ ·ï¼Œä½†æ˜¯ä¸¤ä¸ªçº¿ç¨‹æœ€åæ‰“å°å‡ºæ¥çš„éƒ½æ˜¯æœ€åèµ‹çš„é‚£ä¸ªå€¼ï¼Œè¯´æ˜ Thread-0 æ‹¿å‡ºçš„æ•°æ®å·²ç»ä¸å¯¹äº†ï¼Œè¿™å°±æ˜¯çº¿ç¨‹é—´å…±äº«æ•°æ®å¸¦æ¥çš„é—®é¢˜ã€‚

å½“ç„¶ï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥ä½¿ç”¨ synchronized å…³é”®å­—å°† `run()` æ–¹æ³•ä¸­çš„å‡ è¡Œä»£ç ç»™å¥—èµ·æ¥ï¼Œè¿™æ ·æ¯ä¸ªçº¿ç¨‹å„è‡ªæ‰§è¡Œå®Œï¼Œæ‰“å°å‡ºå„è‡ªçš„ä¿¡æ¯ï¼Œè¿™æ˜¯æ²¡é—®é¢˜çš„ï¼Œç¡®å®å¯ä»¥è§£å†³ä¸Šé¢çš„çº¿ç¨‹é—´å…±äº«æ•°æ®é—®é¢˜ã€‚ä½†æ˜¯ï¼Œè¿™æ˜¯ä»¥å…¶ä»–çº¿ç¨‹è¢«é˜»å¡ä¸ºä»£ä»·çš„ï¼Œå³ Thread-0 åœ¨æ‰§è¡Œçš„æ—¶å€™ï¼ŒThread-1 å°±è¢«é˜»å¡äº†ï¼Œå¿…é¡»ç­‰å¾… Thread-0 æ‰§è¡Œå®Œäº†æ‰èƒ½æ‰§è¡Œã€‚

é‚£ä¹ˆå¦‚æœæˆ‘æƒ³ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶è·‘ï¼Œå¹¶ä¸”äº’ä¸å½±å“å„è‡ªå–å‡ºçš„å€¼ï¼Œè¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿè¿™ä¹Ÿæ˜¯æœ¬æ–‡æ‰€è¦æ€»ç»“çš„é‡ç‚¹ï¼Œè§£å†³è¯¥é—®é¢˜çš„æ€æƒ³æ˜¯ï¼šè™½ç„¶ç°åœ¨éƒ½åœ¨æ“ä½œå…¬å…±æ•°æ® dataï¼Œä½†æ˜¯ä¸åŒçš„çº¿ç¨‹æœ¬èº«å¯¹è¿™ä¸ª data è¦ç»´æŠ¤ä¸€ä¸ªå‰¯æœ¬ï¼Œè¿™ä¸ªå‰¯æœ¬ä¸æ˜¯çº¿ç¨‹é—´æ‰€å…±äº«çš„ï¼Œè€Œæ˜¯æ¯ä¸ªçº¿ç¨‹æ‰€ç‹¬æœ‰çš„ï¼Œæ‰€ä»¥ä¸åŒçº¿ç¨‹ä¸­æ‰€ç»´æŠ¤çš„ data æ˜¯ä¸ä¸€æ ·çš„ï¼Œæœ€åå–çš„æ—¶å€™ï¼Œæ˜¯å“ªä¸ªçº¿ç¨‹ï¼Œæˆ‘å°±ä»å“ªä¸ªçº¿ç¨‹ä¸­å–è¯¥ dataã€‚

åŸºäºä¸Šé¢è¿™ä¸ªæ€è·¯ï¼Œæˆ‘å†æŠŠä¸Šé¢çš„ç¨‹åºåšä¸€ä¿®æ”¹ï¼Œå¦‚ä¸‹ï¼š

```java
public class ThreadScopeShareData {

	private static int data = 0;//å…¬å…±çš„æ•°æ®
	//å®šä¹‰ä¸€ä¸ªMapä»¥é”®å€¼å¯¹çš„æ–¹å¼å­˜å‚¨æ¯ä¸ªçº¿ç¨‹å’Œå®ƒå¯¹åº”çš„æ•°æ®ï¼Œå³Threadï¼šdata
	private static Map<Thread, Integer> threadData = Collections.synchronizedMap(new HashMap<Thread, Integer>());
	
	public static void main(String[] args) {
		for(int i = 0; i < 2; i ++) {
			new Thread(new Runnable() {
				
				@Override
				public void run() {
					int temp = new Random().nextInt();
					System.out.println(Thread.currentThread().getName() + " has put a data: " + temp); //æ‰“å°å‡ºæ¥ä¸ºäº†çœ‹æ•ˆæœ					
					threadData.put(Thread.currentThread(), temp); //å‘Mapä¸­å­˜å…¥æœ¬çº¿ç¨‹dataæ•°æ®çš„ä¸€ä¸ªå‰¯æœ¬
					data = temp; //æ“ä½œæ•°æ®ï¼šèµ‹æ–°å€¼
					new TestA().getData();
					new TestB().getData();
				}
			}).start();
		}
	}
	
	static class TestA {
		public void getData() {
			System.out.println("A get data from " + Thread.currentThread().getName() + ": " 
				+ threadData.get(Thread.currentThread())); //å–å‡ºå„çº¿ç¨‹ç»´æŠ¤çš„é‚£ä¸ªå‰¯æœ¬
		}
	}
	
	static class TestB {
		public void getData() {
			System.out.println("B get data from " + Thread.currentThread().getName() + ": " 
				+ threadData.get(Thread.currentThread()));
		}
	}
}
```
ä¸Šé¢ç¨‹åºä¸­ç»´æŠ¤äº†ä¸€ä¸ª Mapï¼Œé”®å€¼å¯¹åˆ†åˆ«æ˜¯çº¿ç¨‹å’Œå®ƒçš„æ•°æ®ï¼Œé‚£ä¹ˆåœ¨æ“ä½œ data çš„æ—¶å€™ï¼Œå…ˆæŠŠå„è‡ªçš„æ•°æ®ä¿å­˜åˆ°è¿™ä¸ª Map ä¸­ï¼Œè¿™æ ·æ¯ä¸ªçº¿ç¨‹ä¿å­˜çš„è‚¯å®šä¸åŒï¼Œå½“å†å–çš„æ—¶å€™ï¼Œæ ¹æ®å½“å‰çº¿ç¨‹å¯¹è±¡ä½œä¸º key æ¥å–å‡ºå¯¹åº”çš„ data å‰¯æœ¬ï¼Œè¿™æ ·ä¸åŒçš„çº¿ç¨‹ä¹‹é—´å°±ä¸ä¼šç›¸äº’å½±å“äº†ã€‚è¿™ä¸ª HashMap ä¹Ÿéœ€è¦åŒ…è£…ä¸€ä¸‹ï¼Œå› ä¸º HashMap æ˜¯éçº¿ç¨‹å®‰å…¨çš„ï¼Œä¸Šé¢çš„ç¨‹åºä¸­ï¼Œä¸åŒçš„çº¿ç¨‹æœ‰å¯¹ HashMap è¿›è¡Œå†™æ“ä½œï¼Œå°±æœ‰å¯èƒ½äº§ç”Ÿå¹¶å‘é—®é¢˜ï¼Œæ‰€ä»¥ä¹Ÿè¦åŒ…è£…ä¸€ä¸‹ã€‚æœ€åæ¥çœ‹ä¸€ä¸‹æ‰§è¡Œç»“æœï¼š
>Thread-0 has put a data: 1817494992<br>
Thread-1 has put a data: -1189758355<br>
A get data from Thread-0: 1817494992<br>
A get data from Thread-1: -1189758355<br>
B get data from Thread-0: 1817494992<br>
B get data from Thread-1: -1189758355<br>

å°±æ˜¯çº¿ç¨‹èŒƒå›´å†…å…±äº«æ•°æ®ï¼Œå³åŒä¸€ä¸ªçº¿ç¨‹é‡Œé¢è¿™ä¸ªæ•°æ®æ˜¯å…±äº«çš„ï¼Œçº¿ç¨‹é—´æ˜¯ä¸å…±äº«çš„ã€‚

è¿™è®©æˆ‘è”æƒ³åˆ°äº†å­¦ä¹ æ•°æ®åº“çš„æ—¶å€™ç”¨åˆ°çš„ ThreadLocalï¼Œæ“ä½œæ•°æ®åº“éœ€è¦ connectionï¼Œå¦‚æœå½“å‰çº¿ç¨‹ä¸­æœ‰å°±æ‹¿å½“å‰çº¿ç¨‹ä¸­å­˜çš„ connectionï¼Œå¦åˆ™å°±æ–°å»ºä¸€ä¸ªæ”¾åˆ°å½“å‰çº¿ç¨‹ä¸­ï¼Œè¿™æ ·å°±ä¸ä¼šå‡ºç°é—®é¢˜ï¼Œå› ä¸ºæ¯ä¸ªçº¿ç¨‹æœ¬èº«å…±äº«äº†ä¸€ä¸ª connectionï¼Œå®ƒä¸æ˜¯çº¿ç¨‹é—´å…±äº«çš„ã€‚è¿™ä¹Ÿå¾ˆå¥½ç†è§£ï¼Œè¿™ä¸ª connection è‚¯å®šä¸èƒ½å…±äº«ï¼Œå‡è®¾ A å’Œ B ç”¨æˆ·éƒ½æ‹¿åˆ°è¿™ä¸ª connection å¹¶å¼€å¯äº†äº‹åŠ¡ï¼Œç°åœ¨ A å¼€å§‹è½¬è´¦äº†ï¼Œä½†æ˜¯é’±è¿˜æ²¡è½¬å¥½ï¼ŒB è½¬å¥½äº†å…³é—­äº†äº‹åŠ¡ï¼Œé‚£ä¹ˆAé‚£è¾¹å°±å‡ºé—®é¢˜äº†ã€‚

çº¿ç¨‹èŒƒå›´å†…å…±äº«æ•°æ®çš„é—®é¢˜å°±æ€»ç»“è¿™ä¹ˆå¤šå§~å¦‚æœæœ‰é—®é¢˜ï¼Œæ¬¢è¿æŒ‡æ­£ï¼Œæˆ‘ä»¬ä¸€èµ·è¿›æ­¥ï¼

----

> æ–‡ç« å¯ä»¥ç™½å«–ï¼Œè€é“ä»¬é¡ºä¾¿å…³æ³¨ä¸€ä¸‹æˆ‘çš„å…¬ä¼—å·ï¼Œæ‰‹åŠ¨æ»‘ç¨½ğŸ¤£ğŸ¤£ &nbsp;
>
> æ¬¢è¿å¤§å®¶å…³æ³¨ï¼š**æ­¦å“¥èŠç¼–ç¨‹**ã€**Javaå¼€å‘å®å…¸**ã€**Javaç§ƒå¤´å“¥**ï¼Œæ‚¨çš„æ”¯æŒï¼Œæ˜¯æˆ‘åˆ›ä½œçš„æŒç»­åŠ¨åŠ›ï¼&nbsp;&nbsp;

![æ­¦å“¥èŠç¼–ç¨‹](https://img-blog.csdnimg.cn/202002150421550.jpg)![Javaå¼€å‘å®å…¸](https://img-blog.csdnimg.cn/20200608005630228.png)![Javaç§ƒå¤´å“¥](https://img-blog.csdnimg.cn/20201025170941235.png)

----