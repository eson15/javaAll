> æ–‡ç« å¯ä»¥ç™½å«–ï¼Œè€é“ä»¬é¡ºä¾¿å…³æ³¨ä¸€ä¸‹æˆ‘çš„å…¬ä¼—å·ï¼Œæ‰‹åŠ¨æ»‘ç¨½ğŸ¤£ğŸ¤£ &nbsp;
>
> æ¬¢è¿å¤§å®¶å…³æ³¨ï¼š**æ­¦å“¥èŠç¼–ç¨‹**ã€**Javaå¼€å‘å®å…¸**ã€**Javaç§ƒå¤´å“¥**ï¼Œæ‚¨çš„æ”¯æŒï¼Œæ˜¯æˆ‘åˆ›ä½œçš„æŒç»­åŠ¨åŠ›ï¼&nbsp;&nbsp;

![æ­¦å“¥èŠç¼–ç¨‹](https://img-blog.csdnimg.cn/202002150421550.jpg)![Javaå¼€å‘å®å…¸](https://img-blog.csdnimg.cn/20200608005630228.png)![Javaç§ƒå¤´å“¥](https://img-blog.csdnimg.cn/20201025170941235.png)

----

åœ¨å‰é¢æˆ‘çš„ä¸€ç¯‡æ€»ç»“çº¿ç¨‹èŒƒå›´å†…å…±äº«æ•°æ®d æ–‡ç« ä¸­æåˆ°ï¼Œä¸ºäº†æ•°æ®èƒ½åœ¨çº¿ç¨‹èŒƒå›´å†…ä½¿ç”¨ï¼Œæˆ‘ç”¨äº† HashMap æ¥å­˜å‚¨ä¸åŒçº¿ç¨‹ä¸­çš„æ•°æ®ï¼Œkey ä¸ºå½“å‰çº¿ç¨‹ï¼Œvalue ä¸ºå½“å‰çº¿ç¨‹ä¸­çš„æ•°æ®ã€‚æˆ‘å–çš„æ—¶å€™æ ¹æ®å½“å‰çº¿ç¨‹åä» HashMap ä¸­å–å³å¯ã€‚

å› ä¸ºå½“åˆå­¦ä¹  HashMap å’Œ HashTable æºç çš„æ—¶å€™ï¼ŒçŸ¥é“ HashTable æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå› ä¸ºé‡Œé¢çš„æ–¹æ³•ä½¿ç”¨äº† synchronized è¿›è¡ŒåŒæ­¥ï¼Œä½†æ˜¯ HashMap æ²¡æœ‰ï¼Œæ‰€ä»¥ HashMap æ˜¯éçº¿ç¨‹å®‰å…¨çš„ã€‚

åœ¨ä¸Šé¢æåˆ°çš„ä¾‹å­ä¸­ï¼Œæˆ‘æƒ³åæ­£ä¸ç”¨ä¿®æ”¹ HashMapï¼Œåªéœ€è¦ä»ä¸­å–å€¼å³å¯ï¼Œæ‰€ä»¥ä¸ä¼šæœ‰çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œä½†æ˜¯æˆ‘å¿½ç•¥äº†ä¸€ä¸ªæ­¥éª¤ï¼šæˆ‘å¾—å…ˆæŠŠä¸åŒçº¿ç¨‹çš„æ•°æ®å­˜åˆ° HashMap ä¸­å§ï¼Œè¿™ä¸ªå­˜å°±å¯èƒ½å‡ºç°é—®é¢˜ï¼Œè™½ç„¶æˆ‘å­˜çš„æ—¶å€™ key ä½¿ç”¨äº†ä¸åŒçš„çº¿ç¨‹åå­—ï¼Œç†è®ºä¸Šæ¥è¯´æ˜¯ä¸ä¼šå†²çªçš„ï¼Œä½†æ˜¯è¿™ç§è®¾è®¡æˆ–è€…æ€æƒ³æœ¬æ¥å°±ä¸å¤Ÿä¸¥è°¨ã€‚æˆ‘åæ¥ä»”ç»†æ¨æ•²äº†ä¸‹ï¼Œé‡æ–°æ¸©ä¹ äº†ä¸‹ HashMap çš„æºç ï¼Œå†åŠ ä¸Šç½‘ä¸ŠæŸ¥çš„ä¸€äº›èµ„æ–™ï¼Œåœ¨è¿™é‡Œæ€»ç»“ä¸€ä¸‹ HashMap åˆ°åº•ä»€ä¹ˆæ—¶å€™å¯èƒ½å‡ºç°çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚

æˆ‘ä»¬çŸ¥é“ HashMap åº•å±‚æ˜¯ä¸€ä¸ª Entry æ•°ç»„ï¼Œå½“å‘ç”Ÿ hash å†²çªçš„æ—¶å€™ï¼ŒHashMap æ˜¯é‡‡ç”¨é“¾è¡¨çš„æ–¹å¼æ¥è§£å†³çš„ï¼Œåœ¨å¯¹åº”çš„æ•°ç»„ä½ç½®å­˜æ”¾é“¾è¡¨çš„å¤´ç»“ç‚¹ã€‚å¯¹é“¾è¡¨è€Œè¨€ï¼Œæ–°åŠ å…¥çš„èŠ‚ç‚¹ä¼šä»å¤´ç»“ç‚¹åŠ å…¥ã€‚javadoc ä¸­æœ‰ä¸€æ®µå…³äº HashMap çš„æè¿°ï¼š

>æ­¤å®ç°ä¸æ˜¯åŒæ­¥çš„ã€‚å¦‚æœå¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®ä¸€ä¸ªå“ˆå¸Œæ˜ å°„ï¼Œè€Œå…¶ä¸­è‡³å°‘ä¸€ä¸ªçº¿ç¨‹ä»ç»“æ„ä¸Šä¿®æ”¹äº†è¯¥æ˜ å°„ï¼Œåˆ™å®ƒå¿…é¡»ä¿æŒå¤–éƒ¨åŒæ­¥ã€‚ï¼ˆç»“æ„ä¸Šçš„ä¿®æ”¹æ˜¯æŒ‡æ·»åŠ æˆ–åˆ é™¤ä¸€ä¸ªæˆ–å¤šä¸ªæ˜ å°„å…³ç³»çš„ä»»ä½•æ“ä½œï¼›ä»…æ”¹å˜ä¸å®ä¾‹å·²ç»åŒ…å«çš„é”®å…³è”çš„å€¼ä¸æ˜¯ç»“æ„ä¸Šçš„ä¿®æ”¹ã€‚ï¼‰è¿™ä¸€èˆ¬é€šè¿‡å¯¹è‡ªç„¶å°è£…è¯¥æ˜ å°„çš„å¯¹è±¡è¿›è¡ŒåŒæ­¥æ“ä½œæ¥å®Œæˆã€‚å¦‚æœä¸å­˜åœ¨è¿™æ ·çš„å¯¹è±¡ï¼Œåˆ™åº”è¯¥ä½¿ç”¨ Collections.synchronizedMap æ–¹æ³•æ¥â€œåŒ…è£…â€è¯¥æ˜ å°„ã€‚æœ€å¥½åœ¨åˆ›å»ºæ—¶å®Œæˆè¿™ä¸€æ“ä½œï¼Œä»¥é˜²æ­¢å¯¹æ˜ å°„è¿›è¡Œæ„å¤–çš„éåŒæ­¥è®¿é—®ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š
`Map m = Collections.synchronizedMap(new HashMap(...));`

å¯ä»¥çœ‹å‡ºï¼Œè§£å†³ HashMap çº¿ç¨‹å®‰å…¨é—®é¢˜çš„æ–¹æ³•å¾ˆç®€å•ï¼Œä¸‹é¢æˆ‘ç®€å•åˆ†æä¸€ä¸‹å¯èƒ½ä¼šå‡ºç°çº¿ç¨‹é—®é¢˜çš„ä¸€äº›åœ°æ–¹ã€‚

## 1. å‘HashMapä¸­æ’å…¥æ•°æ®çš„æ—¶å€™

åœ¨ HashMap åš put æ“ä½œçš„æ—¶å€™ä¼šè°ƒç”¨åˆ°ä»¥ä¸‹çš„æ–¹æ³•ï¼š

```java
//å‘HashMapä¸­æ·»åŠ Entry
void addEntry(int hash, K key, V value, int bucketIndex) {
	if ((size >= threshold) && (null != table[bucketIndex])) {
		resize(2 * table.length); //æ‰©å®¹2å€
		hash = (null != key) ? hash(key) : 0;
		bucketIndex = indexFor(hash, table.length);
	}

	createEntry(hash, key, value, bucketIndex);
}
//åˆ›å»ºä¸€ä¸ªEntry
void createEntry(int hash, K key, V value, int bucketIndex) {
	Entry<K,V> e = table[bucketIndex];//å…ˆæŠŠtableä¸­è¯¥ä½ç½®åŸæ¥çš„Entryä¿å­˜
	//åœ¨tableä¸­è¯¥ä½ç½®æ–°å»ºä¸€ä¸ªEntryï¼Œå°†åŸæ¥çš„EntryæŒ‚åˆ°è¯¥Entryçš„next
	table[bucketIndex] = new Entry<>(hash, key, value, e);
	//æ‰€ä»¥tableä¸­çš„æ¯ä¸ªä½ç½®æ°¸è¿œåªä¿å­˜ä¸€ä¸ªæœ€æ–°åŠ è¿›æ¥çš„Entryï¼Œå…¶ä»–Entryæ˜¯ä¸€ä¸ªæŒ‚ä¸€ä¸ªï¼Œè¿™æ ·æŒ‚ä¸Šå»çš„
	size++;
}
```
ç°åœ¨å‡å¦‚ A çº¿ç¨‹å’Œ B çº¿ç¨‹åŒæ—¶è¿›å…¥ addEntryï¼Œç„¶åè®¡ç®—å‡ºäº†ç›¸åŒçš„å“ˆå¸Œå€¼å¯¹åº”äº†ç›¸åŒçš„æ•°ç»„ä½ç½®ï¼Œå› ä¸ºæ­¤æ—¶è¯¥ä½ç½®è¿˜æ²¡æ•°æ®ï¼Œç„¶åå¯¹åŒä¸€ä¸ªæ•°ç»„ä½ç½®è°ƒç”¨ createEntryï¼Œä¸¤ä¸ªçº¿ç¨‹ä¼šåŒæ—¶å¾—åˆ°ç°åœ¨çš„å¤´ç»“ç‚¹ï¼Œç„¶å A å†™å…¥æ–°çš„å¤´ç»“ç‚¹ä¹‹åï¼ŒB ä¹Ÿå†™å…¥æ–°çš„å¤´ç»“ç‚¹ï¼Œé‚£ B çš„å†™å…¥æ“ä½œå°±ä¼šè¦†ç›–Açš„å†™å…¥æ“ä½œé€ æˆ A çš„å†™å…¥æ“ä½œä¸¢å¤±ã€‚

## 2. HashMapæ‰©å®¹çš„æ—¶å€™

è¿˜æ˜¯ä¸Šé¢é‚£ä¸ª addEntry æ–¹æ³•ä¸­ï¼Œæœ‰ä¸ªæ‰©å®¹çš„æ“ä½œï¼Œè¿™ä¸ªæ“ä½œä¼šæ–°ç”Ÿæˆä¸€ä¸ªæ–°çš„å®¹é‡çš„æ•°ç»„ï¼Œç„¶åå¯¹åŸæ•°ç»„çš„æ‰€æœ‰é”®å€¼å¯¹é‡æ–°è¿›è¡Œè®¡ç®—å’Œå†™å…¥æ–°çš„æ•°ç»„ï¼Œä¹‹åæŒ‡å‘æ–°ç”Ÿæˆçš„æ•°ç»„ã€‚æ¥çœ‹ä¸€ä¸‹æ‰©å®¹çš„æºç ï¼š

```java
//ç”¨æ–°çš„å®¹é‡æ¥ç»™tableæ‰©å®¹  
void resize(int newCapacity) {  
    Entry[] oldTable = table; //ä¿å­˜old table  
    int oldCapacity = oldTable.length; //ä¿å­˜old capacity  
    // å¦‚æœæ—§çš„å®¹é‡å·²ç»æ˜¯ç³»ç»Ÿé»˜è®¤æœ€å¤§å®¹é‡äº†ï¼Œé‚£ä¹ˆå°†é˜ˆå€¼è®¾ç½®æˆæ•´å½¢çš„æœ€å¤§å€¼ï¼Œé€€å‡º    
    if (oldCapacity == MAXIMUM_CAPACITY) {  
        threshold = Integer.MAX_VALUE;  
        return;  
    }  
  
    //æ ¹æ®æ–°çš„å®¹é‡æ–°å»ºä¸€ä¸ªtable  
    Entry[] newTable = new Entry[newCapacity];  
    //å°†tableè½¬æ¢æˆnewTable  
    transfer(newTable, initHashSeedAsNeeded(newCapacity));  
    table = newTable;  
    //è®¾ç½®é˜ˆå€¼  
    threshold = (int)Math.min(newCapacity * loadFactor, MAXIMUM_CAPACITY + 1);  
} 
```
é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œå½“å¤šä¸ªçº¿ç¨‹åŒæ—¶è¿›æ¥ï¼Œæ£€æµ‹åˆ°æ€»æ•°é‡è¶…è¿‡é—¨é™å€¼çš„æ—¶å€™å°±ä¼šåŒæ—¶è°ƒç”¨ resizeæ“ä½œï¼Œå„è‡ªç”Ÿæˆæ–°çš„æ•°ç»„å¹¶ rehash åèµ‹ç»™è¯¥ map åº•å±‚çš„æ•°ç»„ tableï¼Œç»“æœæœ€ç»ˆåªæœ‰æœ€åä¸€ä¸ªçº¿ç¨‹ç”Ÿæˆçš„æ–°æ•°ç»„è¢«èµ‹ç»™ table å˜é‡ï¼Œå…¶ä»–çº¿ç¨‹çš„å‡ä¼šä¸¢å¤±ã€‚è€Œä¸”å½“æŸäº›çº¿ç¨‹å·²ç»å®Œæˆèµ‹å€¼è€Œå…¶ä»–çº¿ç¨‹åˆšå¼€å§‹çš„æ—¶å€™ï¼Œå°±ä¼šç”¨å·²ç»è¢«èµ‹å€¼çš„ table ä½œä¸ºåŸå§‹æ•°ç»„ï¼Œè¿™æ ·ä¹Ÿä¼šæœ‰é—®é¢˜ã€‚æ‰€ä»¥åœ¨æ‰©å®¹æ“ä½œçš„æ—¶å€™ä¹Ÿæœ‰å¯èƒ½ä¼šå¼•èµ·ä¸€äº›å¹¶å‘çš„é—®é¢˜ã€‚

## 3. åˆ é™¤HashMapä¸­æ•°æ®çš„æ—¶å€™

åˆ é™¤é”®å€¼å¯¹çš„æºä»£ç å¦‚ä¸‹ï¼š
```java
//æ ¹æ®æŒ‡å®šçš„keyåˆ é™¤Entryï¼Œè¿”å›å¯¹åº”çš„value  
public V remove(Object key) {  
    Entry<K,V> e = removeEntryForKey(key);  
    return (e == null ? null : e.value);  
}  
  
//æ ¹æ®æŒ‡å®šçš„keyï¼Œåˆ é™¤Entry,å¹¶è¿”å›å¯¹åº”çš„value  
final Entry<K,V> removeEntryForKey(Object key) {  
    if (size == 0) {  
        return null;  
    }  
    int hash = (key == null) ? 0 : hash(key);  
    int i = indexFor(hash, table.length);  
    Entry<K,V> prev = table[i];  
    Entry<K,V> e = prev;  
  
    while (e != null) {  
        Entry<K,V> next = e.next;  
        Object k;  
        if (e.hash == hash &&  
            ((k = e.key) == key || (key != null && key.equals(k)))) {  
            modCount++;  
            size--;  
            if (prev == e) //å¦‚æœåˆ é™¤çš„æ˜¯tableä¸­çš„ç¬¬ä¸€é¡¹çš„å¼•ç”¨  
                table[i] = next;//ç›´æ¥å°†ç¬¬ä¸€é¡¹ä¸­çš„nextçš„å¼•ç”¨å­˜å…¥table[i]ä¸­  
            else  
                prev.next = next; //å¦åˆ™å°†table[i]ä¸­å½“å‰Entryçš„å‰ä¸€ä¸ªEntryä¸­çš„nextç½®ä¸ºå½“å‰Entryçš„next  
            e.recordRemoval(this);  
            return e;  
        }  
        prev = e;  
        e = next;  
    }  
  
    return e;  
}
```
åˆ é™¤è¿™ä¸€å—å¯èƒ½ä¼šå‡ºç°ä¸¤ç§çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œç¬¬ä¸€ç§æ˜¯ä¸€ä¸ªçº¿ç¨‹åˆ¤æ–­å¾—åˆ°äº†æŒ‡å®šçš„æ•°ç»„ä½ç½®iå¹¶è¿›å…¥äº†å¾ªç¯ï¼Œæ­¤æ—¶ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹ä¹Ÿåœ¨åŒæ ·çš„ä½ç½®å·²ç»åˆ æ‰äº†iä½ç½®çš„é‚£ä¸ªæ•°æ®äº†ï¼Œç„¶åç¬¬ä¸€ä¸ªçº¿ç¨‹é‚£è¾¹å°±æ²¡äº†ã€‚ä½†æ˜¯åˆ é™¤çš„è¯ï¼Œæ²¡äº†å€’é—®é¢˜ä¸å¤§ã€‚

å†çœ‹å¦ä¸€ç§æƒ…å†µï¼Œå½“å¤šä¸ªçº¿ç¨‹åŒæ—¶æ“ä½œåŒä¸€ä¸ªæ•°ç»„ä½ç½®çš„æ—¶å€™ï¼Œä¹Ÿéƒ½ä¼šå…ˆå–å¾—ç°åœ¨çŠ¶æ€ä¸‹è¯¥ä½ç½®å­˜å‚¨çš„å¤´ç»“ç‚¹ï¼Œç„¶åå„è‡ªå»è¿›è¡Œè®¡ç®—æ“ä½œï¼Œä¹‹åå†æŠŠç»“æœå†™ä¼šåˆ°è¯¥æ•°ç»„ä½ç½®å»ï¼Œå…¶å®å†™å›çš„æ—¶å€™å¯èƒ½å…¶ä»–çš„çº¿ç¨‹å·²ç»å°±æŠŠè¿™ä¸ªä½ç½®ç»™ä¿®æ”¹è¿‡äº†ï¼Œå°±ä¼šè¦†ç›–å…¶ä»–çº¿ç¨‹çš„ä¿®æ”¹ã€‚

å…¶ä»–åœ°æ–¹è¿˜æœ‰å¾ˆå¤šå¯èƒ½ä¼šå‡ºç°çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œæˆ‘å°±ä¸ä¸€ä¸€åˆ—ä¸¾äº†ï¼Œæ€»ä¹‹ HashMap æ˜¯éçº¿ç¨‹å®‰å…¨çš„ï¼Œåœ¨é«˜å¹¶å‘çš„åœºåˆä½¿ç”¨çš„è¯ï¼Œè¦ç”¨ Collections.synchronizedMap è¿›è¡ŒåŒ…è£…ä¸€ä¸‹ï¼Œæˆ–è€…ç›´æ¥ä½¿ç”¨ ConcurrentHashMap éƒ½è¡Œã€‚

å…³äº HashMap çš„çº¿ç¨‹éå®‰å…¨æ€§ï¼Œå°±æ€»ç»“è¿™ä¹ˆå¤šï¼Œå¦‚æœ‰é—®é¢˜ï¼Œæ¬¢è¿äº¤æµï¼Œæˆ‘ä»¬ä¸€åŒè¿›æ­¥~


----

> æ–‡ç« å¯ä»¥ç™½å«–ï¼Œè€é“ä»¬é¡ºä¾¿å…³æ³¨ä¸€ä¸‹æˆ‘çš„å…¬ä¼—å·ï¼Œæ‰‹åŠ¨æ»‘ç¨½ğŸ¤£ğŸ¤£ &nbsp;
>
> æ¬¢è¿å¤§å®¶å…³æ³¨ï¼š**æ­¦å“¥èŠç¼–ç¨‹**ã€**Javaå¼€å‘å®å…¸**ã€**Javaç§ƒå¤´å“¥**ï¼Œæ‚¨çš„æ”¯æŒï¼Œæ˜¯æˆ‘åˆ›ä½œçš„æŒç»­åŠ¨åŠ›ï¼&nbsp;&nbsp;

![æ­¦å“¥èŠç¼–ç¨‹](https://img-blog.csdnimg.cn/202002150421550.jpg)![Javaå¼€å‘å®å…¸](https://img-blog.csdnimg.cn/20200608005630228.png)![Javaç§ƒå¤´å“¥](https://img-blog.csdnimg.cn/20201025170941235.png)

----