> æ–‡ç« å¯ä»¥ç™½å«–ï¼Œè€é“ä»¬é¡ºä¾¿å…³æ³¨ä¸€ä¸‹æˆ‘çš„å…¬ä¼—å·ï¼Œæ‰‹åŠ¨æ»‘ç¨½ğŸ¤£ğŸ¤£ &nbsp;
>
> æ¬¢è¿å¤§å®¶å…³æ³¨ï¼š**æ­¦å“¥èŠç¼–ç¨‹**ã€**Javaå¼€å‘å®å…¸**ã€**Javaç§ƒå¤´å“¥**ï¼Œæ‚¨çš„æ”¯æŒï¼Œæ˜¯æˆ‘åˆ›ä½œçš„æŒç»­åŠ¨åŠ›ï¼&nbsp;&nbsp;

![å…¬ä¼—å·äºŒç»´ç ](https://img-blog.csdnimg.cn/20201121225359995.png)

----

# HashMap

HashMapæ˜¯Javaç¨‹åºå‘˜ä½¿ç”¨é¢‘ç‡æœ€é«˜çš„ç”¨äºæ˜ å°„(é”®å€¼å¯¹)å¤„ç†çš„æ•°æ®ç±»å‹ã€‚éšç€JDKï¼ˆJava Developmet Kitï¼‰ç‰ˆæœ¬çš„æ›´æ–°ï¼Œ`jdk8` é’ˆå¯¹ `HashMap` çš„ `hashç¢°æ’` ä»¥åŠ `æŸ¥è¯¢æ•ˆç‡` é—®é¢˜è¿›è¡Œäº†ä¼˜åŒ–ï¼Œä¾‹å¦‚ï¼šå¼•å…¥çº¢é»‘æ ‘çš„æ•°æ®ç»“æ„å’Œæ‰©å®¹çš„ä¼˜åŒ–ç­‰ã€‚é‚£æˆ‘ä»¬ä¸€èµ·æ¥äº†è§£å®ƒ `come on baby`ã€‚

## æ•°æ®ç»“æ„

![image](http://note.youdao.com/yws/public/resource/07a596690165d28c75671b1363b80262/xmlnote/6F47D106A8FF41D492A53928BDEB32A7/12582)

> ç”±ä¸Šé¢ç»“æ„å›¾å¯çŸ¥ï¼Œä¸ºäº†è§£å†³å½“hashç¢°æ’è¿‡äºé¢‘ç¹ï¼Œè€Œé“¾è¡¨çš„æŸ¥è¯¢æ•ˆç‡(æ—¶é—´å¤æ‚åº¦ä¸ºO(n))è¿‡ä½æ—¶ï¼Œå½“ `é“¾è¡¨` çš„é•¿åº¦è¾¾åˆ°ä¸€å®šå€¼(é»˜è®¤æ˜¯8)æ—¶ï¼Œå°†é“¾è¡¨è½¬æ¢æˆ `çº¢é»‘æ ‘` (æ—¶é—´å¤æ‚åº¦ä¸ºO(lg n))ï¼Œæå¤§çš„æé«˜äº†æŸ¥è¯¢æ•ˆç‡ã€‚

- Node å®ä½“

> HashMapå°†hash, key, value, nextå°è£…åˆ°ä¸€ä¸ªé™æ€å†…éƒ¨ç±» `Node` ä¸Šã€‚å®ƒ `å®ç°äº†Map.Entry<K,V>` æ¥å£ã€‚

```java
static class Node<K,V> implements Map.Entry<K,V> {
	// hashå€¼
    final int hash;
    // é”®
    final K key;
    // å€¼
    V value;
    // é“¾è¡¨ä¸‹ä¸€ä¸ªèŠ‚ç‚¹
    Node<K,V> next;
    
    // æ„é€ æ–¹æ³•
    Node(int hash, K key, V value, Node<K,V> next) {
        this.hash = hash;
        this.key = key;
        this.value = value;
        this.next = next;
    }
    
    // è·å–é”®
    public final K getKey()        { return key; }
    // è·å–å€¼
    public final V getValue()      { return value; }
    // é‡å†™toStringæ–¹æ³•
    public final String toString() { return key + "=" + value; }
    // è®¡ç®—hashCodeå€¼
    public final int hashCode() {
        return Objects.hashCode(key) ^ Objects.hashCode(value);
    }
    // é‡æ–°è®¾ç½®å½“å‰çš„å€¼
    public final V setValue(V newValue) {
        V oldValue = value;
        value = newValue;
        return oldValue;
    }
    // æ¯”è¾ƒä¸¤ä¸ªentry
    public final boolean equals(Object o) {
        if (o == this)
            return true;
        if (o instanceof Map.Entry) {
            Map.Entry<?,?> e = (Map.Entry<?,?>)o;
            if (Objects.equals(key, e.getKey()) &&
                Objects.equals(value, e.getValue()))
                return true;
        }
        return false;
    }
}
```

**å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªNode<K,V>[]æ˜¯HashMapçš„ä¸€ä¸ªå†…éƒ¨ç±»ï¼Œä»–æ—¢æ˜¯HashMapåº•å±‚æ•°ç»„çš„ç»„æˆå…ƒç´ ï¼Œåˆæ˜¯æ¯ä¸ªå•å‘é“¾è¡¨çš„ç»„æˆå…ƒç´ ã€‚å®ƒå…¶ä¸­åŒ…å«äº†æ•°ç»„å…ƒç´ æ‰€éœ€è¦çš„keyä¸valueï¼Œä»¥åŠé“¾è¡¨æ‰€éœ€è¦çš„æŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„å¼•ç”¨åŸŸnextã€‚**

## æºç åˆ†æ

- æˆå‘˜å±æ€§

```java
    /**
     * é»˜è®¤åˆå§‹å¤§å°:
     *    1. é»˜è®¤åˆå§‹å¤§å°:16ã€‚
     *    2. å¤§å°å¿…é¡»ä¸º2çš„æŒ‡æ•°ã€‚
     *    3. è¿™é‡Œçš„16,é‡‡ç”¨çš„1å·¦ç§»4ä½å®ç°
     */
    static final int DEFAULT_INITIAL_CAPACITY = 1 << 4; // aka 16

    /**
     * æœ€å¤§å®¹é‡:
     *    1. æ„é€ å‡½æ•°çš„å‚æ•°éšå¼æŒ‡æ˜æ—¶ä½¿ç”¨è¯¥å€¼
     *    2. å¿…é¡»æ˜¯2çš„æŒ‡æ•°,ä¸”å°äºç­‰äº1<<30ï¼ˆå³2çš„30æ¬¡æ–¹ï¼‰
     */
    static final int MAXIMUM_CAPACITY = 1 << 30;

    /**
     * è´Ÿè½½å› å­ï¼š é»˜è®¤å€¼ä¸º0.75f
     *    1. 0.75 æ˜¯å¯¹æ—¶é—´å’Œç©ºé—´æ•ˆç‡çš„ä¸€ä¸ªå¹³è¡¡é€‰æ‹©ï¼Œå»ºè®®å¤§å®¶ä¸è¦ä¿®æ”¹ã€‚
     *    2. é™¤éåœ¨æ—¶é—´æˆ–è€…ç©ºé—´ä¸Šæ¯”è¾ƒç‰¹æ®Šçš„æƒ…å†µä¸‹ã€‚
     *    ä¾‹å¦‚ï¼š
     *       å¦‚æœå†…å­˜ç©ºé—´å¾ˆå¤šè€Œåˆå¯¹æ—¶é—´æ•ˆç‡è¦æ±‚å¾ˆé«˜ï¼Œå¯ä»¥é™ä½è´Ÿè½½å› å­              
     *       å¦‚æœå†…å­˜ç©ºé—´è¾ƒå°‘è€Œåˆå¯¹æ—¶é—´æ•ˆç‡è¦æ±‚ä¸é«˜ï¼Œå¯ä»¥å¢åŠ è´Ÿè½½å› å­
     *       æ³¨æ„ï¼šè¿™ä¸ªå€¼å¯ä»¥å¤§äº1
     */
    static final float DEFAULT_LOAD_FACTOR = 0.75f;
   
--- æ¥ä¸‹æ¥æ˜¯å’Œçº¢é»‘æ ‘ç›¸å…³çš„å‡ ä¸ªå¸¸é‡ã€‚åœ¨jdk1.8ä¸­ï¼Œå¦‚æœå“ˆå¸Œè¡¨ä¸­çš„é“¾è¡¨å¤ªé•¿ï¼Œå°±ä¼šè½¬åŒ–ä¸ºä¸€ä¸ªçº¢é»‘æ ‘ã€‚---

    /**
     * ä½¿ç”¨æ ‘è€Œä¸ä½¿ç”¨é“¾è¡¨çš„é˜ˆå€¼ï¼š
     *    è¡¨ç¤ºè¦è½¬ä¸ºçº¢é»‘æ ‘çš„æœ€å°å…ƒç´ ä¸ªæ•°, å³8 ã€‚
     */
    static final int TREEIFY_THRESHOLD = 8;

    /**
     * ä½¿ç”¨é“¾è¡¨è€Œä¸ä½¿ç”¨æ ‘çš„é˜ˆå€¼ï¼š
     *    çº¢é»‘æ ‘è½¬åŒ–ä¸ºé“¾è¡¨çš„é—¨é™ä¸ªæ•°æ˜¯ 6ã€‚
     */
    static final int UNTREEIFY_THRESHOLD = 6;

    /**
     * å¯è¢«æ ‘åŒ–çš„æœ€å°è¡¨å®¹é‡ï¼š64
     *    1. éœ€è¦æ»¡è¶³å“ˆå¸Œæ¡¶çš„æ•°é‡è¦è¾¾åˆ° 64ã€‚
     *    2. éœ€è¦æ˜¯TREEIFY_THRESHOLDæ•°é‡çš„4å€ä»¥ä¸Šã€‚
     */
    static final int MIN_TREEIFY_CAPACITY = 64;
```
> æˆ‘ä»¬ä¸»è¦æ¥çœ‹çœ‹loadFactorå±æ€§ï¼ŒloadFactorè¡¨ç¤ºHashè¡¨ä¸­å…ƒç´ çš„å¡«æ»¡ç¨‹åº¦ã€‚

- è‹¥åŠ è½½å› å­è®¾ç½®è¿‡å¤§ï¼Œåˆ™å¡«æ»¡çš„å…ƒç´ è¶Šå¤šï¼Œæ— ç–‘ç©ºé—´åˆ©ç”¨ç‡å˜é«˜äº†ï¼Œä½†æ˜¯å†²çªçš„æœºä¼šå¢åŠ äº†ï¼Œå†²çªçš„è¶Šå¤šï¼Œé“¾è¡¨å°±ä¼šå˜å¾—è¶Šé•¿ï¼Œé‚£ä¹ˆæŸ¥æ‰¾æ•ˆç‡å°±ä¼šå˜å¾—æ›´ä½ï¼›

- è‹¥åŠ è½½å› å­è®¾ç½®è¿‡å°ï¼Œåˆ™å¡«æ»¡çš„å…ƒç´ è¶Šå°‘ï¼Œé‚£ä¹ˆç©ºé—´åˆ©ç”¨ç‡å˜ä½äº†ï¼Œè¡¨ä¸­æ•°æ®å°†å˜å¾—æ›´åŠ ç¨€ç–ï¼Œä½†æ˜¯å†²çªçš„æœºä¼šå‡å°äº†ï¼Œè¿™æ ·é“¾è¡¨å°±ä¸ä¼šå¤ªé•¿ï¼ŒæŸ¥æ‰¾æ•ˆç‡å˜å¾—æ›´é«˜ã€‚

> ä¸¾ä¾‹è¯´æ˜

- å¦‚æœæ•°ç»„å®¹é‡ä¸º100ï¼ŒåŠ è½½å› å­è®¾ç½®ä¸º80ï¼Œå³è£…æ»¡äº†80ä¸ªæ‰å¼€å§‹æ‰©å®¹ï¼Œä½†æ˜¯åœ¨è£…çš„è¿‡ç¨‹ä¸­ï¼Œå¯èƒ½æœ‰å¾ˆå¤škeyå¯¹åº”ç›¸åŒçš„hashå€¼ï¼Œè¿™æ ·å°±ä¼šæ”¾åˆ°åŒä¸€ä¸ªé“¾è¡¨ä¸­ï¼ˆå› ä¸ºæ²¡åˆ°80ä¸ªä¸èƒ½æ‰©å®¹ï¼‰ï¼Œè¿™æ ·å°±ä¼šå¯¼è‡´å¾ˆå¤šé“¾è¡¨éƒ½å˜å¾—å¾ˆé•¿ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸åŒçš„keyå¯¹åº”ç›¸åŒçš„hashå€¼æ¯”æ•°ç»„å¡«æ»¡åˆ°80ä¸ªæ›´åŠ å®¹æ˜“å‡ºç°ã€‚

- ä½†æ˜¯å¦‚æœè®¾ç½®åŠ è½½å› å­ä¸º10ï¼Œé‚£ä¹ˆæ•°ç»„å¡«æ»¡10ä¸ªå°±å¼€å§‹æ‰©å®¹äº†ï¼Œ10ä¸ªç›¸å¯¹æ¥è¯´æ˜¯å¾ˆå®¹æ˜“å¡«æ»¡çš„ï¼Œè€Œä¸”åœ¨10ä¸ªå†…å‡ºç°ç›¸åŒçš„hashå€¼æ¦‚ç‡æ¯”ä¸Šé¢çš„æƒ…å†µè¦å°çš„å¤šï¼Œä¸€æ—¦æ‰©å®¹ä¹‹åï¼Œé‚£ä¹ˆè®¡ç®—hashå€¼åˆä¼šè·ŸåŸæ¥ä¸ä¸€æ ·ï¼Œå°±ä¸ä¼šå†å†²çªäº†ï¼Œè¿™æ ·ä¿è¯äº†é“¾è¡¨ä¸ä¼šå¾ˆé•¿ï¼Œç”šè‡³å°±ä¸€ä¸ªè¡¨å¤´éƒ½æœ‰å¯èƒ½ï¼Œä½†æ˜¯ç©ºé—´åˆ©ç”¨ç‡å¾ˆä½ï¼Œå› ä¸ºå§‹ç»ˆæœ‰å¾ˆå¤šç©ºé—´æ²¡åˆ©ç”¨å°±å¼€å§‹æ‰©å®¹ã€‚

**å› æ­¤ï¼Œå°±éœ€è¦åœ¨â€œå‡å°å†²çªâ€å’Œâ€œç©ºé—´åˆ©ç”¨ç‡â€ä¹‹é—´å¯»æ‰¾ä¸€ç§å¹³è¡¡ï¼Œè¿™ç§å¹³è¡¡å°±æ˜¯æ•°æ®ç»“æ„ä¸­æœ‰åçš„â€œæ—¶-ç©ºâ€çŸ›ç›¾çš„å¹³è¡¡ã€‚å¦‚æœæœºå™¨å†…å­˜è¶³å¤Ÿï¼Œå¹¶ä¸”æƒ³è¦æé«˜æŸ¥è¯¢é€Ÿåº¦çš„è¯å¯ä»¥å°†åŠ è½½å› å­è®¾ç½®å°ä¸€ç‚¹ï¼›ç›¸åå¦‚æœæœºå™¨å†…å­˜ç´§å¼ ï¼Œå¹¶ä¸”å¯¹æŸ¥è¯¢é€Ÿåº¦æ²¡ä»€ä¹ˆè¦æ±‚çš„è¯å¯ä»¥å°†åŠ è½½å› å­è®¾ç½®å¤§ä¸€ç‚¹ã€‚ä¸€èˆ¬æˆ‘ä»¬éƒ½ä½¿ç”¨å®ƒçš„é»˜è®¤å€¼ï¼Œå³0.75ã€‚**
- æ„é€ æ–¹æ³•

```java
/**
 *  æŒ‡å®šåˆå§‹å®¹é‡å’ŒåŠ è½½å› å­
 */
public HashMap(int initialCapacity, float loadFactor) {
    // æ ¡éªŒåˆå§‹å®¹é‡å‚æ•°åˆæ³•æ€§
    if (initialCapacity < 0)
        throw new IllegalArgumentException("Illegal initial capacity: " +
                                           initialCapacity);
    if (initialCapacity > MAXIMUM_CAPACITY)
        initialCapacity = MAXIMUM_CAPACITY;
    if (loadFactor <= 0 || Float.isNaN(loadFactor))
        throw new IllegalArgumentException("Illegal load factor: " +
                                           loadFactor);
    this.loadFactor = loadFactor;
    
    this.threshold = tableSizeFor(initialCapacity);
}

/**
 *  æŒ‡å®šåˆå§‹å®¹é‡ï¼ŒåŠ è½½å› å­ä¸ºé»˜è®¤çš„0.75
 */
public HashMap(int initialCapacity) {
    this(initialCapacity, DEFAULT_LOAD_FACTOR);
}

/**
 *  ä¸å¸¦å‚æ„é€ å‡½æ•°ï¼ŒåŠ è½½å› å­ä¸ºé»˜è®¤çš„0.75
 */
public HashMap() {
    this.loadFactor = DEFAULT_LOAD_FACTOR; // all other fields defaulted
}

/**
 *  å¦ä¸€ä¸ªmapå¯¹è±¡ï¼Œåˆå§‹åŒ–åï¼Œå°†å­˜æ”¾è¯¥mapå¯¹è±¡çš„å¼•ç”¨
 */
public HashMap(Map<? extends K, ? extends V> m) {
    this.loadFactor = DEFAULT_LOAD_FACTOR;
    putMapEntries(m, false);
}
```

> ç¬¬ä¸€ä¸ªæ„é€ å‡½æ•°ä¸­ï¼ŒæŒ‡å®šäº†åˆå§‹å®¹é‡å’ŒåŠ è½½å› å­ï¼Œéœ€è¦æ‰©å®¹çš„å®¹é‡threshold å€¼ç”±tableSizeForæ–¹æ³•å¾—å‡ºï¼š

```java
// è®¡ç®—æ‰©å®¹å®¹é‡çš„æ–¹æ³•
static final int tableSizeFor(int cap) {
    int n = cap - 1;
    n |= n >>> 1;
    n |= n >>> 2;
    n |= n >>> 4;
    n |= n >>> 8;
    n |= n >>> 16;
    return (n < 0) ? 1 : (n >= MAXIMUM_CAPACITY) ? MAXIMUM_CAPACITY : n + 1;
}
-----------------------------------tableSizeFor-------------------------------------
1. è¿™ä¸ªæ–¹æ³•æ˜¯å¾—å‡ºå¤§äºç­‰äº cap å€¼çš„æœ€å¤§çš„ 2 çš„å¹‚å€¼ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå‡å¦‚ cap æ˜¯ 17ï¼Œé‚£ä¹ˆè¿”å›çš„nå€¼æ˜¯ 32ã€‚
2. è€Œåç»­ HashMap éœ€è¦æ‰©å®¹æ—¶ï¼Œæ¯æ¬¡ table æ•°ç»„é•¿åº¦éƒ½æ‰©å±•ä¸ºåŸæ¥çš„ä¸¤å€ï¼Œæ‰€ä»¥ï¼Œtable æ•°ç»„é•¿åº¦æ€»æ˜¯ä¸º 2 çš„å¹‚å€¼ã€‚
```
**æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œåœ¨æ„é€  HashMap çš„æ—¶å€™ï¼Œå¦‚æœæˆ‘ä»¬æŒ‡å®šäº†åŠ è½½å› å­å’Œåˆå§‹å®¹é‡çš„è¯å°±è°ƒç”¨ç¬¬ä¸€ä¸ªæ„é€ æ–¹æ³•ï¼Œå¦åˆ™å°±ç”¨é»˜è®¤çš„ã€‚é»˜è®¤çš„åˆå§‹å®¹é‡ä¸º `16`ï¼Œ åŠ è½½å› å­ä¸º `0.75`ã€‚**

- å­˜å–æ–¹æ³•

1. putæ–¹æ³•

![image](http://note.youdao.com/yws/public/resource/07a596690165d28c75671b1363b80262/xmlnote/1723C1AC99FD49C9831A17EE52884BAC/12760)

> æºç åˆ†æ

```java
/**
 * å­˜å‚¨é”®å€¼å¯¹
 */
public V put(K key, V value) {
    return putVal(hash(key), key, value, false, true);
}

final V putVal(int hash, K key, V value, boolean onlyIfAbsent,
               boolean evict) {
    Node<K,V>[] tab; Node<K,V> p; int n, i;  // tab[]ä¸ºæ•°ç»„ï¼Œpæ˜¯æ¯ä¸ªæ¡¶
    if ((tab = table) == null || (n = tab.length) == 0) // ç¬¬ä¸€æ­¥ï¼štableä¸ºç©ºï¼Œåˆ™è°ƒç”¨resize()å‡½æ•°åˆ›å»ºä¸€ä¸ª
        n = (tab = resize()).length;
    if ((p = tab[i = (n - 1) & hash]) == null) // ç¬¬äºŒæ­¥ï¼šè®¡ç®—å…ƒç´ æ‰€è¦å‚¨å­˜çš„ä½ç½®index,å¹¶å¯¹nullåšå‡ºå¤„ç†
       // æ³¨æ„: å¦‚æœtab[i]==nullï¼Œè¯´æ˜è¿™ä¸ªä½ç½®ä¸Šæ²¡æœ‰å…ƒç´ ï¼Œè¿™ä¸ªæ—¶å€™å°±åˆ›å»ºä¸€ä¸ªNodeå…ƒç´ 
        tab[i] = newNode(hash, key, value, null);
    else { // else,å¦åˆ™,ä¹Ÿå°±æ˜¯,è¿™ä¸ªè¦æ·»åŠ çš„ä½ç½®ä¸Šé¢å·²ç»æœ‰å…ƒç´ äº†ï¼Œä¹Ÿå°±æ˜¯å‘ç”Ÿäº†ç¢°æ’ã€‚
       /**
        * è¿™ä¸ªæ—¶å€™å°±è¦å…·ä½“æƒ…å†µåˆ†ç±»è®¨è®ºï¼š
        *   1.keyå€¼ç›¸åŒï¼Œç›´æ¥è¦†ç›– 
        *   2.é“¾è¡¨å·²ç»è¶…è¿‡äº†8ä½ï¼Œå˜æˆäº†çº¢é»‘æ ‘ 
        *   3.é“¾è¡¨æ˜¯æ­£å¸¸çš„é“¾è¡¨
        */
        Node<K,V> e; K k;
        if (p.hash == hash && ((k = p.key) == key || (key != null && key.equals(k))))
            // å¦‚æœèŠ‚ç‚¹keyå­˜åœ¨ï¼Œåˆ™è¦†ç›–åŸæ¥ä½ç½®çš„key
            e = p;
        else if (p instanceof TreeNode) //ç¬¬ä¸‰æ­¥ï¼šåˆ¤æ–­è¯¥é“¾æ˜¯å¦ä¸ºçº¢é»‘æ ‘
            e = ((TreeNode<K,V>)p).putTreeVal(this, tab, hash, key, value);
        else {
            for (int binCount = 0; ; ++binCount) {
                if ((e = p.next) == null) {
                    p.next = newNode(hash, key, value, null);
                     // é“¾è¡¨é•¿åº¦å¤§äº8è½¬æ¢ä¸ºçº¢é»‘æ ‘
                    if (binCount >= TREEIFY_THRESHOLD - 1) // -1 for 1st
                        treeifyBin(tab, hash);
                    break;
                }
                // å¦‚æœèŠ‚ç‚¹keyå­˜åœ¨ï¼Œåˆ™è¦†ç›–åŸæ¥ä½ç½®çš„keyï¼ŒåŒæ—¶å°†åŸæ¥ä½ç½®çš„å…ƒç´ ï¼Œæ²¿ç€é“¾è¡¨å‘åç§»ä¸€ä½
                if (e.hash == hash &&
                    ((k = e.key) == key || (key != null && key.equals(k))))
                    break;
                p = e;
            }
        }
        if (e != null) { // existing mapping for key
            V oldValue = e.value;
            if (!onlyIfAbsent || oldValue == null)
                e.value = value;
            afterNodeAccess(e);
            return oldValue;
        }
    }
    ++modCount;
    if (++size > threshold) // ç¬¬å››æ­¥ï¼šè¶…è¿‡æœ€å¤§å®¹é‡é™åˆ¶ï¼Œæ‰©å®¹æ“ä½œ
        resize();
    afterNodeInsertion(evict);
    return null;
}
```

2. getæ–¹æ³•

```java
/**
 * è·å– valueå€¼
 */
public V get(Object key) {
    Node<K,V> e;
    // æ‰¾åˆ°èŠ‚ç‚¹ä¸ä¸ºnull,åˆ™è¿”å›valueå€¼ï¼›å¦åˆ™è¿”å›null
    return (e = getNode(hash(key), key)) == null ? null : e.value; 
}

final Node<K,V> getNode(int hash, Object key) {
    Node<K,V>[] tab; Node<K,V> first, e; int n; K k;
    // èŠ‚ç‚¹æ•°ç»„ä¸ä¸ºç©º
    if ((tab = table) != null && (n = tab.length) > 0 &&
        (first = tab[(n - 1) & hash]) != null) {
        // æ£€æŸ¥ç¬¬ä¸€ä¸ªèŠ‚ç‚¹æ˜¯ä¸æ˜¯æ»¡è¶³è¦æ±‚ï¼Œæ»¡è¶³åˆ™ç›´æ¥è¿”å›
        if (first.hash == hash && // always check first node
            ((k = first.key) == key || (key != null && key.equals(k))))
            return first;
        // ä¸æ»¡è¶³ï¼Œåˆ™ç»§ç»­æŸ¥çœ‹ä¸‹ä¸€ä¸ªèŠ‚ç‚¹
        if ((e = first.next) != null) {
            // åˆ¤æ–­èŠ‚ç‚¹ç±»å‹æ˜¯çº¢é»‘æ ‘ï¼Œåˆ™èµ°çº¢é»‘æ ‘çš„æŸ¥æ‰¾èŠ‚ç‚¹
            if (first instanceof TreeNode)
                return ((TreeNode<K,V>)first).getTreeNode(hash, key);
            // ä¸æ˜¯çº¢é»‘æ ‘ï¼Œåˆ™æ­£å¸¸çš„åˆ¤æ–­hashå€¼ä»¥åŠkeyæ˜¯å¦æ»¡è¶³ï¼Œæ»¡è¶³åˆ™è¿”å›
            do {
                if (e.hash == hash &&
                    ((k = e.key) == key || (key != null && key.equals(k))))
                    return e;
            } while ((e = e.next) != null);
        }
    }
    // èŠ‚ç‚¹æ•°ç»„ä¸ºç©ºï¼Œç›´æ¥è¿”å›null
    return null;
}
```

3. å…¶ä»–å¸¸ç”¨æ–¹æ³•

```java
/** è¿”å›å½“å‰mapçš„kvæ˜ å°„å¯¹æ•°é‡ */
public int size() {
    return size;
}

/** åˆ¤æ–­å½“å‰mapæ˜¯å¦æœ‰kvæ˜ å°„å¯¹ */
public boolean isEmpty() {
    return size == 0;
}

/** åˆ¤æ–­å½“å‰mapæ˜¯å¦åŒ…å«æŒ‡å®škeyçš„kvæ˜ å°„  */
public boolean containsKey(Object key) {
    return getNode(hash(key), key) != null;
}

/** æ ¹æ®æŒ‡å®šçš„keyåˆ é™¤æ˜ å°„å¯¹ï¼Œè¿”å›å¯¹åº”çš„value  */
public V remove(Object key) {
    Node<K,V> e;
    return (e = removeNode(hash(key), key, null, false, true)) == null ?
        null : e.value;
}

/** å½“å‰mapä¸­ä¸å­˜åœ¨keyæ‰€å¯¹åº”çš„æ˜ å°„å¯¹ï¼Œæ‰æ·»åŠ k-v  */
@Override
public V putIfAbsent(K key, V value) {
    return putVal(hash(key), key, value, true, true);
}

/** å°†æŒ‡å®šçš„Mapä¸­æ‰€æœ‰æ˜ å°„å¤åˆ¶åˆ°ç°æœ‰çš„HashMapä¸­ï¼Œkeyå€¼ç›¸åŒçš„åˆ™è¿›è¡Œè¦†ç›–æ“ä½œ  */
public void putAll(Map<? extends K, ? extends V> m) {
    putMapEntries(m, true);
}

/** åˆ¤æ–­å½“å‰mapä¸­æ˜¯å¦æœ‰keyæ˜ å°„çš„å€¼æ˜¯æŒ‡å®šçš„value */
public boolean containsValue(Object value) {
    Node<K,V>[] tab; V v;
    if ((tab = table) != null && size > 0) {
        for (int i = 0; i < tab.length; ++i) {
            for (Node<K,V> e = tab[i]; e != null; e = e.next) {
                if ((v = e.value) == value ||
                    (value != null && value.equals(v)))
                    return true;
            }
        }
    }
    return false;
}

/**  æ¸…ç©ºå½“å‰mapä¸­çš„æ‰€æœ‰æ˜ å°„å¯¹ */ 
public void clear() {
    Node<K,V>[] tab;
    modCount++;
    if ((tab = table) != null && size > 0) {
        size = 0;
        for (int i = 0; i < tab.length; ++i)
            tab[i] = null;
    }
}

/** 
 * è¿”å›æ­¤æ˜ å°„ä¸­æ‰€åŒ…å«çš„é”®çš„ Set è§†å›¾ã€‚ 
 * è¯¥ set å—æ˜ å°„çš„æ”¯æŒï¼Œæ‰€ä»¥å¯¹æ˜ å°„çš„æ›´æ”¹å°†åæ˜ åœ¨è¯¥ set ä¸­ï¼Œ 
 * åä¹‹äº¦ç„¶ã€‚å¦‚æœåœ¨å¯¹ set è¿›è¡Œè¿­ä»£çš„åŒæ—¶ä¿®æ”¹äº†æ˜ å°„ï¼ˆé€šè¿‡è¿­ä»£å™¨è‡ªå·±çš„ remove æ“ä½œé™¤å¤–ï¼‰ï¼Œ 
 * åˆ™è¿­ä»£ç»“æœæ˜¯ä¸ç¡®å®šçš„ã€‚è¯¥ set æ”¯æŒå…ƒç´ çš„ç§»é™¤ï¼Œé€šè¿‡  
 * Iterator.removeã€Set.removeã€removeAllã€retainAll å’Œ clear æ“ä½œ 
 * å¯ä»è¯¥æ˜ å°„ä¸­ç§»é™¤ç›¸åº”çš„æ˜ å°„å…³ç³»ã€‚å®ƒä¸æ”¯æŒ add æˆ– addAll æ“ä½œã€‚ 
 */ 
public Set<K> keySet() {
    Set<K> ks = keySet;
    if (ks == null) {
        ks = new KeySet();
        keySet = ks;
    }
    return ks;
}

/** 
 * è¿”å›æ­¤æ˜ å°„æ‰€åŒ…å«çš„å€¼çš„ Collection è§†å›¾ã€‚ 
 * è¯¥ collection å—æ˜ å°„çš„æ”¯æŒï¼Œæ‰€ä»¥å¯¹æ˜ å°„çš„æ›´æ”¹å°†åæ˜ åœ¨è¯¥ collection ä¸­ï¼Œ 
 * åä¹‹äº¦ç„¶ã€‚å¦‚æœåœ¨å¯¹ collection è¿›è¡Œè¿­ä»£çš„åŒæ—¶ä¿®æ”¹äº†æ˜ å°„ï¼ˆé€šè¿‡è¿­ä»£å™¨è‡ªå·±çš„ remove æ“ä½œé™¤å¤–ï¼‰ï¼Œ 
 * åˆ™è¿­ä»£ç»“æœæ˜¯ä¸ç¡®å®šçš„ã€‚è¯¥ collection æ”¯æŒå…ƒç´ çš„ç§»é™¤ï¼Œ 
 * é€šè¿‡ Iterator.removeã€Collection.removeã€removeAllã€retainAll å’Œ clear æ“ä½œ 
 * å¯ä»è¯¥æ˜ å°„ä¸­ç§»é™¤ç›¸åº”çš„æ˜ å°„å…³ç³»ã€‚å®ƒä¸æ”¯æŒ add æˆ– addAll æ“ä½œã€‚ 
 */ 
public Collection<V> values() {
    Collection<V> vs = values;
    if (vs == null) {
        vs = new Values();
        values = vs;
    }
    return vs;
}
```

- éå†æ–¹å¼

1. åˆ©ç”¨keyset

```java
// å‡è®¾mapæ˜¯HashMapå¯¹è±¡

Object value = null;
for ( String key : map.keySet() ) // å½“ç„¶å¯ä»¥ä½¿ç”¨è¿­ä»£å™¨
    value = map.get(key);
```

2.  åˆ©ç”¨values

```java
// å‡è®¾mapæ˜¯HashMapå¯¹è±¡

Stirng value = null;
for ( Object v : map.values() ) // å½“ç„¶å¯ä»¥ä½¿ç”¨è¿­ä»£å™¨
    value = (String) v;
```

3.  åˆ©ç”¨entry

```java
// å‡è®¾mapæ˜¯HashMapå¯¹è±¡

Object key = null;
Object value = null;
Iterator iterator = map.entrySet().iterator(); //è·å¾—Entryçš„Iterator
while(iterator.hasNext()) {
    Map.Entry entry = (Map.Entry)iterator.next();
    key = entry.getKey();
    value = entry.getValue();
}
```
> æ ¹æ®è‡ªå·±æ‰€éœ€ï¼Œé€‰å–åˆé€‚çš„éå†æ–¹å¼ï¼Œæé†’ä¸€ä¸‹éå†ä½¿ç”¨è¿­ä»£å™¨ï¼Œæ•ˆç‡é«˜ã€‚

**ç»¼ä¸Šæ‰€è¿°ï¼ŒJDK8ä¸‹çš„HashMapå°±å‘Šä¸€æ®µè½ï¼Œå½“ç„¶å†…å®¹è¿˜æœ‰å¾ˆå¤šï¼Œè¿™é‡Œåªä»‹ç»äº†ä¸»è¦ä»¥åŠå¸¸ç”¨çš„ï¼Œå¸Œæœ›å¯¹å¤§å®¶æœ‰æ‰€å¸®åŠ©ï¼ï¼ï¼**

----
> æ–‡ç« å¯ä»¥ç™½å«–ï¼Œè€é“ä»¬é¡ºä¾¿å…³æ³¨ä¸€ä¸‹æˆ‘çš„å…¬ä¼—å·ï¼Œæ‰‹åŠ¨æ»‘ç¨½ğŸ¤£ğŸ¤£ &nbsp;
>
> æ¬¢è¿å¤§å®¶å…³æ³¨ï¼š**æ­¦å“¥èŠç¼–ç¨‹**ã€**Javaå¼€å‘å®å…¸**ã€**Javaç§ƒå¤´å“¥**ï¼Œæ‚¨çš„æ”¯æŒï¼Œæ˜¯æˆ‘åˆ›ä½œçš„æŒç»­åŠ¨åŠ›ï¼&nbsp;&nbsp;

![å…¬ä¼—å·äºŒç»´ç ](https://img-blog.csdnimg.cn/20201121225359995.png)