> æ–‡ç« å¯ä»¥ç™½å«–ï¼Œå…¬ä¼—å·ä¸èƒ½ä¸å…³æ³¨ï¼Œæ‰‹åŠ¨æ»‘ç¨½ğŸ¤£ğŸ¤£ &nbsp;
>
> æ¬¢è¿å¤§å®¶å…³æ³¨ï¼š**æ­¦å“¥èŠç¼–ç¨‹**ã€**Javaå¼€å‘å®å…¸**ï¼Œæ‚¨çš„æ”¯æŒï¼Œæ˜¯æˆ‘ä»¬åˆ›ä½œçš„æŒç»­åŠ¨åŠ›ï¼&nbsp;&nbsp;

![æ­¦å“¥èŠç¼–ç¨‹](https://img-blog.csdnimg.cn/202002150421550.jpg)![Javaå¼€å‘å®å…¸](https://img-blog.csdnimg.cn/20200608005630228.png)![Javaç§ƒå¤´å“¥](https://img-blog.csdnimg.cn/20201025170941235.png)

----

å°ä¼™ä¼´å„¿ä»¬ï¼Œå¤§å®¶å¥½ï¼ä¸Šä¸€ç¯‡æˆ‘ä»¬å­¦ä¹ äº† Spring IoC ç›¸å…³çŸ¥è¯†ï¼›
ç°åœ¨æˆ‘ä»¬æ¥å­¦ä¹ ä¸€ä¸‹ Springä¸­ å¦ä¸€ä¸ªæ ¸å¿ƒ Spring AOPï¼Œä¹Ÿå°±æ˜¯é¢å‘åˆ‡é¢ç¼–ç¨‹ã€‚

![image-20201008210523727](https://gitee.com/Huke-123/PicCloud/raw/master/20201008210523.png)

æˆ‘ä»¬çŸ¥é“ï¼ŒSpring ä¸­ AOP æ˜¯ä¸€å¤§æ ¸å¿ƒæŠ€æœ¯ï¼Œä¹Ÿæ˜¯é¢è¯•ä¸­ç»å¸¸ä¼šè¢«é—®åˆ°çš„é—®é¢˜ï¼Œæœ€è¿‘æˆ‘åœ¨ç½‘ä¸Šä¹Ÿçœ‹åˆ°å¾ˆå¤šé¢è¯•é¢˜ï¼Œå…¶ä¸­å’Œ Spring AOP ç›¸å…³çš„å°±æœ‰ä¸å°‘ï¼Œè¿™ç¯‡æ–‡ç« ä¸»è¦æ¥æ€»ç»“ä¸‹ç›¸å…³çš„æŠ€æœ¯ç‚¹ï¼Œå¸Œæœ›å¯¹å¤§å®¶æœ‰ç”¨ã€‚

## 0. å‡ ä¸ªå¸¸è§çš„é—®é¢˜

é’ˆå¯¹è¿™ä¸€å—çš„ä¸œè¥¿ï¼Œä¸€èˆ¬ä¸‹é¢å‡ ä¸ªé—®é¢˜é¢è¯•å®˜é—®çš„æ¯”è¾ƒå¤šï¼š

* Spring AOPç”¨çš„æ˜¯å“ªç§è®¾è®¡æ¨¡å¼ï¼Ÿ
* è°ˆè°ˆä½ å¯¹ä»£ç†æ¨¡å¼çš„ç†è§£ï¼Ÿ
* é™æ€ä»£ç†å’ŒåŠ¨æ€ä»£ç†æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ
* å¦‚ä½•å®ç°åŠ¨æ€ä»£ç†ï¼Ÿ
* Spring AOPä¸­ç”¨çš„æ˜¯å“ªç§ä»£ç†æŠ€æœ¯ï¼Ÿ

å¦‚æœè¿™äº›é—®é¢˜éƒ½èƒ½å›ç­”çš„å¾ˆæµç•…çš„è¯ï¼Œè¯´æ˜å¯¹ä»£ç†è¿™ä¸€å—çš„åŸºæœ¬çŸ¥è¯†æœ‰ä¸€å®šçš„äº†è§£äº†ã€‚å› ä¸ºæˆ‘ä»¬åœ¨å®é™…å¼€å‘ä¸­ï¼Œå†™ä¸šåŠ¡ä»£ç ä¼šæ›´å¤šï¼Œæ‰€ä»¥è¿™ä¸€å—çš„ä¸œè¥¿ï¼Œå¤§éƒ¨åˆ†äººå¯èƒ½çŸ¥é“ä¸ªä¸€äºŒï¼Œä½†æ˜¯å¦‚æœè®©ä»–ä»¬å¾ˆæœ‰æ¡ç†çš„è¡¨è¾¾å‡ºæ¥ï¼Œå¯èƒ½å°±ä¸é‚£ä¹ˆå®¹æ˜“äº†ã€‚

## 1ã€ ä»€ä¹ˆæ˜¯ Spring  AOP

å¦‚æœè¯´ IoC æ˜¯ Spring çš„æ ¸å¿ƒï¼Œé‚£ä¹ˆAOPé¢å‘åˆ‡é¢ç¼–ç¨‹å°±æ˜¯ Spring æœ€ä¸ºé‡è¦çš„åŠŸèƒ½ä¹‹ä¸€äº†ï¼Œåœ¨æ•°æ®åº“äº‹åŠ¡ä¸­åˆ‡é¢ç¼–ç¨‹è¢«å¹¿æ³›ä½¿ç”¨ã€‚ä¸€èˆ¬é¢è¯•å®˜é—®åˆ°è¿™ä¸ªé—®é¢˜ï¼Œé¢è¯•è€…åŸºæœ¬ä¸Šéƒ½ä¼šå›ç­”ï¼šAOP å°±æ˜¯é¢å‘åˆ‡é¢ç¼–ç¨‹ã€‚å…¶å®è¿™çœŸçš„æ˜¯å¥åºŸè¯ï¼Œè¿™ä¹ˆå›ç­”çœŸçš„æ²¡æœ‰ä»»ä½•æ„ä¹‰ã€‚

### 1.1ï¼ŒAOPçš„æ¦‚å¿µ

æˆ–è®¸ä½ å¯ä»¥ç»™é¢è¯•å®˜ä¸¾ä¸ªä¾‹å­ï¼šæ­Œæ˜Ÿéƒ½æœ‰å¥½å¤šåŠ©ç†ï¼Œæ­Œæ˜Ÿæœ€é‡è¦çš„ä¸€ä»¶äº‹å°±æ˜¯å”±æ­Œï¼Œå…¶ä»–äº‹ä»–ä¸ç”¨å…³æ³¨ï¼Œæ¯”å¦‚å”±æ­Œå‰å¯èƒ½éœ€è¦å’Œå…¶ä»–äººè°ˆåˆä½œï¼Œè¿˜è¦å¸ƒç½®åœºåœ°ï¼Œå”±æ­Œåè¿˜è¦æ”¶é’±ç­‰ç­‰ï¼Œè¿™äº›ç»Ÿç»Ÿäº¤ç»™ä»–å¯¹åº”çš„åŠ©ç†å»åšã€‚ä¹Ÿè®¸å“ªä¸€å¤©ï¼Œè¿™ä¸ªæ­Œæ˜Ÿåšæ…ˆå–„ï¼Œå…è´¹å”±æ­Œäº†ï¼Œä¸æ”¶é’±äº†ï¼Œé‚£ä¹ˆå°±å¯ä»¥æŠŠæ”¶é’±è¿™ä¸ªåŠ©åŠ›ç»™è¾é€€äº†ã€‚è¿™å°±æ˜¯ AOPï¼Œæ¯ä¸ªäººå„å¸å…¶èŒï¼Œçµæ´»ç»„åˆï¼Œè¾¾åˆ°ä¸€ç§å¯é…ç½®çš„ã€å¯æ’æ‹”çš„ç¨‹åºç»“æ„ã€‚AOP çš„å®ç°åŸç†å°±æ˜¯ä»£ç†æ¨¡å¼ã€‚

åœ¨ç¨‹åºä¸­ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œé€šè¿‡ä»£ç†ï¼Œå¯ä»¥è¯¦ç»†æ§åˆ¶è®¿é—®æŸä¸ªæˆ–è€…æŸç±»å¯¹è±¡çš„æ–¹æ³•ï¼Œåœ¨è°ƒç”¨è¿™ä¸ªæ–¹æ³•å‰åšå‰ç½®å¤„ç†ï¼Œè°ƒç”¨è¿™ä¸ªæ–¹æ³•ååšåç½®å¤„ç†ã€‚

ç°å®ä¸­æœ‰ä¸€äº›å†…å®¹å¹¶ä¸æ˜¯é¢å‘å¯¹è±¡å¯ä»¥è§£å†³çš„ï¼Œæ¯”å¦‚è¯´æ•°æ®åº“äº‹åŠ¡ï¼Œç”µå•†ç½‘ç«™è´­ç‰©éœ€è¦ç»è¿‡äº¤æ˜“ç³»ç»Ÿã€è´¢åŠ¡ç³»ç»Ÿç­‰ã€‚å¯¹äºäº¤æ˜“ç³»ç»Ÿå­˜åœ¨äº¤æ˜“è®°å½•çš„å¯¹è±¡ï¼Œå¯¹äºè´¢åŠ¡ç³»ç»Ÿå­˜åœ¨è´¦æˆ·çš„ä¿¡æ¯å¯¹è±¡ï¼Œä»è¿™ä¸ªè§’åº¦æ¥çœ‹ï¼Œæˆ‘ä»¬éœ€è¦å¯¹äº¤æ˜“è®°å½•å’Œè´¦æˆ·æ“ä½œå½¢æˆä¸€ä¸ªç»Ÿä¸€çš„äº‹åŠ¡ç®¡ç†ã€‚äº¤æ˜“å’Œè´¦æˆ·çš„äº‹åŠ¡ï¼Œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼šå…¶ä¸­çš„äº¤æ˜“è®°å½•å’Œè´¦æˆ·è®°å½•éƒ½æ˜¯å¯¹è±¡ï¼Œè¿™ä¸¤ä¸ªå¯¹è±¡éœ€è¦åœ¨åŒä¸€ä¸ªäº‹åŠ¡ä¸­æ§åˆ¶ï¼Œè¿™å°±ä¸æ˜¯OOPå¯ä»¥è§£å†³çš„é—®é¢˜ï¼Œéœ€è¦ç”¨åˆ°é¢å‘åˆ‡é¢AOPï¼Œè¿™é‡Œçš„åˆ‡é¢ç¯å¢ƒå°±æ˜¯æ•°æ®åº“äº‹åŠ¡ã€‚

![image-20201008145454961](https://gitee.com/Huke-123/PicCloud/raw/master/20201008145455.png)

AOPå³ Aspect Oriented Program é¢å‘åˆ‡é¢ç¼–ç¨‹ï¼Œåœ¨ AOP æ€æƒ³é‡Œé¢ï¼Œä¸€èˆ¬éƒ½æŠŠåŠŸèƒ½ä¸šåŠ¡åˆ†ä¸ºæ ¸å¿ƒä¸šåŠ¡å’Œå‘¨è¾¹ä¸šåŠ¡ï¼›

æ ¸å¿ƒä¸šåŠ¡ï¼šç™»å½•ï¼Œå¢åˆ æ”¹æŸ¥ç­‰ï¼›
å‘¨è¾¹ä¸šåŠ¡ï¼šæ€§èƒ½ç»Ÿè®¡ï¼Œæ—¥å¿—ï¼Œäº‹åŠ¡ç®¡ç†ç­‰ç­‰ï¼›

### 1.2ï¼ŒAOPçš„ç›¸å…³æœ¯è¯­

**åˆ‡é¢ï¼š**åˆ‡é¢å°±æ˜¯åœ¨ä¸€ä¸ªæ€ä¹ˆæ ·çš„ç¯å¢ƒä¸­å·¥ä½œï¼Œ

**é€šçŸ¥ï¼š**é€šçŸ¥æ˜¯åˆ‡é¢å¼€å¯åï¼Œåˆ‡é¢çš„æ–¹æ³•ã€‚å®ƒæ ¹æ®åœ¨ä»£ç†å¯¹è±¡çœŸå®æ–¹æ³•è°ƒç”¨å‰ã€åçš„é¡ºåºå’Œé€»è¾‘åŒºåˆ†ã€‚

- å‰ç½®é€šçŸ¥ï¼šåœ¨åŠ¨æ€ä»£ç†åå°„åŸæœ‰å¯¹è±¡æ–¹æ³•æˆ–è€…æ‰§è¡Œç¯ç»•é€šçŸ¥**å‰**æ‰§è¡Œçš„é€šçŸ¥åŠŸèƒ½ã€‚
- åç½®é€šçŸ¥ï¼šåœ¨åŠ¨æ€ä»£ç†åå°„åŸæœ‰å¯¹è±¡æ–¹æ³•æˆ–è€…æ‰§è¡Œç¯ç»•é€šçŸ¥**å**æ‰§è¡Œçš„é€šçŸ¥åŠŸèƒ½ã€‚
- å¼‚å¸¸é€šçŸ¥ï¼šåœ¨åŠ¨æ€ä»£ç†åå°„åŸæœ‰å¯¹è±¡æ–¹æ³•æˆ–è€…æ‰§è¡Œç¯ç»•é€šçŸ¥**äº§ç”Ÿå¼‚å¸¸å**æ‰§è¡Œçš„é€šçŸ¥åŠŸèƒ½ã€‚
- ç¯ç»•é€šçŸ¥ï¼šåœ¨åŠ¨æ€ä»£ç†ä¸­ï¼Œå®ƒå¯ä»¥å–ä»£å½“å‰è¢«æ‹¦æˆªå¯¹è±¡çš„æ–¹æ³•ï¼Œæä¾›å›è°ƒåŸæœ‰è¢«æ‹¦æˆªå¯¹è±¡çš„æ–¹æ³•ã€‚

**å¼•å…¥ï¼š**å¼•å…¥å…è®¸æˆ‘ä»¬åœ¨å…ˆæœ‰çš„ç±»é‡Œæ·»åŠ è‡ªå®šä¹‰çš„ç±»å’Œæ–¹æ³•ã€‚

**åˆ‡ç‚¹ï¼š**åˆ‡ç‚¹å¯ä»¥å‘Šè¯‰AOPåœ¨ä»€ä¹ˆæ—¶å€™å¯åŠ¨æ‹¦æˆªå¹¶ç»‡å…¥å¯¹åº”çš„æµç¨‹ä¸­ï¼Œå› ä¸ºå¹¶ä¸æ˜¯æ‰€æœ‰çš„å¼€å‘éƒ½éœ€è¦å¯åŠ¨AOPçš„ï¼Œå®ƒå¾€å¾€é€šè¿‡æ­£åˆ™è¡¨è¾¾å¼è¿›è¡Œé™å®šã€‚

**è¿æ¥ç‚¹ï¼š**è¿æ¥ç‚¹å¯¹åº”çš„æ˜¯å…·ä½“éœ€è¦æ‹¦æˆªçš„ä¸œè¥¿ï¼Œæ¯”å¦‚é€šè¿‡åˆ‡ç‚¹çš„æ­£åˆ™è¡¨è¾¾å¼å»åˆ¤æ–­å“ªäº›æ–¹æ³•æ˜¯è¿æ¥ç‚¹ï¼Œä»è€Œç»‡å…¥å¯¹åº”çš„é€šçŸ¥ã€‚

**ç»‡å…¥ï¼š**ç»‡å…¥æ˜¯ä¸€ä¸ªç”Ÿæˆä»£ç†å¯¹è±¡å¹¶å°†åˆ‡é¢å†…å®¹æ”¾å…¥åˆ°æµç¨‹ä¸­çš„è¿‡ç¨‹ã€‚

### 1.3ï¼ŒAOPçš„ç›®çš„

ä¼ ç»Ÿçš„OOPå¼€å‘ä»£ç é€»è¾‘è‡ªä¸Šè€Œä¸‹ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­ä¼šäº§ç”Ÿä¸€äº›å‘¨è¾¹æ€§(æ¨ªåˆ‡æ€§)é—®é¢˜ï¼Œè¿™äº›é—®é¢˜ä¸æˆ‘ä»¬çš„ä¸»ä¸šåŠ¡é€»è¾‘å…³è”ä¸å¤§ï¼Œä½†æ˜¯æ¯”è¾ƒå‡Œä¹±ï¼Œéš¾ä»¥ç»´æŠ¤ã€‚AOPæ€æƒ³å°±æ˜¯æŠŠä¸šåŠ¡é€»è¾‘ä¸å‘¨è¾¹æ€§é—®é¢˜è¿›è¡Œåˆ†ç¦»ï¼Œè¾¾åˆ°è§£è€¦çš„ç›®çš„ï¼Œæé«˜ä»£ç å¼€å‘æ•ˆç‡ã€‚
ä¸‹é¢å°±æ˜¯ä¸€ä¸ªAOPæµç¨‹å›¾ï¼Œé»‘ç‚¹ä»£è¡¨ç±»æˆ–æ–¹æ³•ï¼Œå¯ä»¥æ›´ä¸ºæ¸…æ™°åœ°ç†è§£AOPæ¦‚å¿µã€‚

![image-20201008171230832](https://gitee.com/Huke-123/PicCloud/raw/master/20201008171230.png)

## 2. ä»€ä¹ˆæ˜¯ä»£ç†æ¨¡å¼ï¼Ÿ

ä»£ç†æ¨¡å¼çš„æ ¸å¿ƒä½œç”¨å°±æ˜¯é€šè¿‡ä»£ç†ï¼Œæ§åˆ¶å¯¹å¯¹è±¡çš„è®¿é—®ã€‚å®ƒçš„è®¾è®¡æ€è·¯æ˜¯ï¼šå®šä¹‰ä¸€ä¸ªæŠ½è±¡è§’è‰²ï¼Œè®©ä»£ç†è§’è‰²å’ŒçœŸå®è§’è‰²åˆ†åˆ«å»å®ç°å®ƒã€‚

çœŸå®è§’è‰²ï¼šå®ç°æŠ½è±¡è§’è‰²ï¼Œå®šä¹‰çœŸå®è§’è‰²æ‰€è¦å®ç°çš„ä¸šåŠ¡é€»è¾‘ï¼Œä¾›ä»£ç†è§’è‰²è°ƒç”¨ã€‚å®ƒåªå…³æ³¨çœŸæ­£çš„ä¸šåŠ¡é€»è¾‘ï¼Œæ¯”å¦‚æ­Œæ˜Ÿå”±æ­Œã€‚

ä»£ç†è§’è‰²ï¼šå®ç°æŠ½è±¡è§’è‰²ï¼Œæ˜¯çœŸå®è§’è‰²çš„ä»£ç†ï¼Œé€šè¿‡çœŸå®è§’è‰²çš„ä¸šåŠ¡é€»è¾‘æ–¹æ³•æ¥å®ç°æŠ½è±¡æ–¹æ³•ï¼Œå¹¶åœ¨å‰åå¯ä»¥é™„åŠ è‡ªå·±çš„æ“ä½œï¼Œæ¯”å¦‚è°ˆåˆåŒï¼Œå¸ƒç½®åœºåœ°ï¼Œæ”¶é’±ç­‰ç­‰ã€‚

è¿™å°±æ˜¯ä»£ç†æ¨¡å¼çš„è®¾è®¡æ€è·¯ã€‚ä»£ç†æ¨¡å¼åˆ†ä¸ºé™æ€ä»£ç†å’ŒåŠ¨æ€ä»£ç†ã€‚é™æ€ä»£ç†æ˜¯æˆ‘ä»¬è‡ªå·±åˆ›å»ºä¸€ä¸ªä»£ç†ç±»ï¼Œè€ŒåŠ¨æ€ä»£ç†æ˜¯ç¨‹åºè‡ªåŠ¨å¸®æˆ‘ä»¬ç”Ÿæˆä¸€ä¸ªä»£ç†ï¼Œæˆ‘ä»¬å°±ä¸ç”¨ç®¡äº†ã€‚ä¸‹é¢æˆ‘è¯¦ç»†ä»‹ç»ä¸€ä¸‹è¿™ä¸¤ç§ä»£ç†æ¨¡å¼ã€‚

### 2.1 é™æ€ä»£ç†æ¨¡å¼

å°±ä¸¾æ˜æ˜Ÿå”±æ­Œè¿™ä¸ªä¾‹å­ï¼Œæ ¹æ®ä¸Šé¢æä¾›çš„è®¾è®¡æ€è·¯ï¼Œé¦–å…ˆæˆ‘ä»¬éœ€è¦åˆ›å»ºæ˜æ˜Ÿè¿™ä¸ªæŠ½è±¡è§’è‰²

```java
/**
* æ˜æ˜Ÿæ¥å£ç±»
* @author shengwu ni
*/
public interface Star {

   /**
    * å”±æ­Œæ–¹æ³•
    */
   void sing();

}
```

é™æ€ä»£ç†éœ€è¦åˆ›å»ºçœŸå®è§’è‰²å’Œä»£ç†è§’è‰²ï¼Œåˆ†åˆ«å®ç°å”±æ­Œè¿™ä¸ªæ¥å£ï¼ŒçœŸå®è§’è‰²å¾ˆç®€å•ï¼Œç›´æ¥å®ç°å³å¯ï¼Œå› ä¸ºçœŸå®è§’è‰²çš„ä¸»è¦ä»»åŠ¡å°±æ˜¯å”±æ­Œã€‚

```java
/**
* çœŸå®æ˜æ˜Ÿç±»
* @author shengwu ni
*/
public class RealStar implements Star {

   @Override
   public void sing() {
       System.out.println("æ˜æ˜Ÿæœ¬äººå¼€å§‹å”±æ­Œâ€¦â€¦");
   }
}
```

ä»£ç†ç±»å°±éœ€è¦åšç‚¹å·¥ä½œäº†ï¼Œæˆ‘ä»¬æ€è€ƒä¸€ä¸‹ï¼Œä»£ç†åªæ˜¯åœ¨æ˜æ˜Ÿå”±æ­Œå‰ååšä¸€äº›å‡†å¤‡å’Œæ”¶å°¾çš„äº‹ï¼Œå”±æ­Œè¿™ä»¶äº‹è¿˜å¾—æ˜æ˜Ÿäº²è‡ªä¸Šé˜µï¼Œä»£ç†åšä¸äº†ã€‚æ‰€ä»¥**ä»£ç†ç±»é‡Œé¢æ˜¯è‚¯å®šè¦å°†çœŸå®çš„å¯¹è±¡ä¼ è¿›æ¥**ã€‚æœ‰äº†æ€è·¯ï¼Œæˆ‘ä»¬å°†ä»£ç†ç±»å†™å‡ºæ¥ã€‚

```java
/**
* æ˜æ˜Ÿçš„é™æ€ä»£ç†ç±»
*
* @author shengwu ni
*/
public class ProxyStar implements Star {

   /**
    * æ¥æ”¶çœŸå®çš„æ˜æ˜Ÿå¯¹è±¡
    */
   private Star star;

   /**
    * é€šè¿‡æ„é€ æ–¹æ³•ä¼ è¿›æ¥çœŸå®çš„æ˜æ˜Ÿå¯¹è±¡
    * @param star star
    */
   public ProxyStar(Star star) {
       this.star = star;
   }

   @Override
   public void sing() {
       System.out.println("ä»£ç†å…ˆè¿›è¡Œè°ˆåˆ¤â€¦â€¦");
       // å”±æ­Œåªèƒ½æ˜æ˜Ÿè‡ªå·±å”±
       this.star.sing();
       System.out.println("æ¼”å‡ºå®Œä»£ç†å»æ”¶é’±â€¦â€¦");
   }

}
```

è¿™æ ·çš„è¯ï¼Œé€»è¾‘å°±éå¸¸æ¸…æ™°äº†ã€‚åœ¨ä»£ç†ç±»ä¸­ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œç»´æŠ¤äº†ä¸€ä¸ªStarå¯¹è±¡ï¼Œé€šè¿‡æ„é€ æ–¹æ³•ä¼ è¿›æ¥ä¸€ä¸ªçœŸå®çš„Starå¯¹è±¡ç»™å…¶èµ‹å€¼ï¼Œç„¶ååœ¨å”±æ­Œè¿™ä¸ªæ–¹æ³•é‡Œï¼Œä½¿ç”¨çœŸå®å¯¹è±¡æ¥å”±æ­Œã€‚æ‰€ä»¥è¯´é¢è°ˆã€æ”¶é’±éƒ½æ˜¯ç”±ä»£ç†å¯¹è±¡æ¥å®ç°çš„ï¼Œå”±æ­Œæ˜¯ä»£ç†å¯¹è±¡è®©çœŸå®å¯¹è±¡æ¥åšã€‚ä¸‹é¢å†™ä¸ªå®¢æˆ·ç«¯æµ‹è¯•ä¸‹ã€‚

```java
/**
* æµ‹è¯•å®¢æˆ·ç«¯
* @author shengwu ni
*/
public class Client {

   /**
    * æµ‹è¯•é™æ€ä»£ç†ç»“æœ
    * @param args args
    */
   public static void main(String[] args) {
       Star realStar = new RealStar();
       Star proxy = new ProxyStar(realStar);

       proxy.sing();
   }
}
```

è¯»è€…å¯ä»¥è‡ªå·±è¿è¡Œä¸‹ç»“æœï¼Œé™æ€ä»£ç†æ¯”è¾ƒç®€å•ã€‚åŠ¨æ€ä»£ç†æ¯”é™æ€ä»£ç†ä½¿ç”¨çš„æ›´å¹¿æ³›ï¼ŒåŠ¨æ€ä»£ç†åœ¨æœ¬è´¨ä¸Šï¼Œä»£ç†ç±»ä¸ç”¨æˆ‘ä»¬æ¥ç®¡ï¼Œæˆ‘ä»¬å®Œå…¨äº¤ç»™å·¥å…·å»ç”Ÿæˆä»£ç†ç±»å³å¯ã€‚åŠ¨æ€ä»£ç†ä¸€èˆ¬æœ‰ä¸¤ç§æ–¹å¼ï¼šJDK åŠ¨æ€ä»£ç†å’Œ CGLIB åŠ¨æ€ä»£ç†ã€‚

### 2.2 JDK åŠ¨æ€ä»£ç†

æ—¢ç„¶åŠ¨æ€ä»£ç†ä¸éœ€è¦æˆ‘ä»¬å»åˆ›å»ºä»£ç†ç±»ï¼Œé‚£æˆ‘ä»¬åªéœ€è¦ç¼–å†™ä¸€ä¸ªåŠ¨æ€å¤„ç†å™¨å°±å¯ä»¥äº†ã€‚çœŸæ­£çš„ä»£ç†å¯¹è±¡ç”± JDK åœ¨è¿è¡Œæ—¶ä¸ºæˆ‘ä»¬åŠ¨æ€çš„æ¥åˆ›å»ºã€‚

```java
/**
* åŠ¨æ€ä»£ç†å¤„ç†ç±»
* @author shengwu ni
*/
public class JdkProxyHandler {

   /**
    * ç”¨æ¥æ¥æ”¶çœŸå®æ˜æ˜Ÿå¯¹è±¡
    */
   private Object realStar;

   /**
    * é€šè¿‡æ„é€ æ–¹æ³•ä¼ è¿›æ¥çœŸå®çš„æ˜æ˜Ÿå¯¹è±¡
    *
    * @param star star
    */
   public JdkProxyHandler(Star star) {
       super();
       this.realStar = star;
   }

   /**
    * ç»™çœŸå®å¯¹è±¡ç”Ÿæˆä¸€ä¸ªä»£ç†å¯¹è±¡å®ä¾‹
    *
    * @return Object
    */
   public Object getProxyInstance() {
       return Proxy.newProxyInstance(realStar.getClass().getClassLoader(),
               realStar.getClass().getInterfaces(), (proxy, method, args) -> {

                   System.out.println("ä»£ç†å…ˆè¿›è¡Œè°ˆåˆ¤â€¦â€¦");
                   // å”±æ­Œéœ€è¦æ˜æ˜Ÿè‡ªå·±æ¥å”±
                   Object object = method.invoke(realStar, args);
                   System.out.println("æ¼”å‡ºå®Œä»£ç†å»æ”¶é’±â€¦â€¦");

                   return object;
               });
   }
}
```

è¿™é‡Œè¯´ä¸€ä¸‹ Proxy.newProxyInstance() æ–¹æ³•ï¼Œè¯¥æ–¹æ³•æ¥æ”¶ä¸‰ä¸ªå‚æ•°ï¼šç¬¬ä¸€ä¸ªå‚æ•°æŒ‡å®šå½“å‰ç›®æ ‡å¯¹è±¡ä½¿ç”¨çš„ç±»åŠ è½½å™¨,è·å–åŠ è½½å™¨çš„æ–¹æ³•æ˜¯å›ºå®šçš„ï¼›ç¬¬äºŒä¸ªå‚æ•°æŒ‡å®šç›®æ ‡å¯¹è±¡å®ç°çš„æ¥å£çš„ç±»å‹ï¼›ç¬¬ä¸‰ä¸ªå‚æ•°æŒ‡å®šåŠ¨æ€å¤„ç†å™¨ï¼Œæ‰§è¡Œç›®æ ‡å¯¹è±¡çš„æ–¹æ³•æ—¶,ä¼šè§¦å‘äº‹ä»¶å¤„ç†å™¨çš„æ–¹æ³•ã€‚ç½‘ä¸Šé’ˆå¯¹ç¬¬ä¸‰ä¸ªå‚æ•°çš„å†™æ³•éƒ½æ˜¯ new ä¸€ä¸ªåŒ¿åç±»æ¥å¤„ç†ï¼Œæˆ‘è¿™ç›´æ¥ç”¨çš„ Java8 é‡Œé¢çš„ lamda è¡¨è¾¾å¼æ¥å†™çš„ï¼Œéƒ½ä¸€æ ·ã€‚åº•å±‚åŸç†ä½¿ç”¨çš„æ˜¯åå°„æœºåˆ¶ã€‚æ¥ä¸‹æ¥å†™ä¸€ä¸ªå®¢æˆ·ç«¯ç¨‹åºæ¥æµ‹è¯•ä¸‹ã€‚

```java
/**
* æµ‹è¯•å®¢æˆ·ç«¯
* @author shengwu ni
*/
public class Client {

   /**
    * æµ‹è¯•JDKåŠ¨æ€ä»£ç†ç»“æœ
    * @param args args
    */
   public static void main(String[] args) {
       Star realStar = new RealStar();
       // åˆ›å»ºä¸€ä¸ªä»£ç†å¯¹è±¡å®ä¾‹
       Star proxy = (Star) new JdkProxyHandler(realStar).getProxyInstance();

       proxy.sing();
   }
}
```

å¯ä»¥çœ‹å‡ºï¼Œåˆ›å»ºä¸€ä¸ªçœŸå®çš„å¯¹è±¡ï¼Œé€ç»™ JdkProxyHandler å°±å¯ä»¥åˆ›å»ºä¸€ä¸ªä»£ç†å¯¹è±¡äº†ã€‚

æˆ‘ä»¬å¯¹ JDK åŠ¨æ€ä»£ç†åšä¸€ä¸ªç®€å•çš„æ€»ç»“ï¼šç›¸å¯¹äºé™æ€ä»£ç†ï¼ŒJDK åŠ¨æ€ä»£ç†å¤§å¤§å‡å°‘äº†æˆ‘ä»¬çš„å¼€å‘ä»»åŠ¡ï¼ŒåŒæ—¶å‡å°‘äº†å¯¹ä¸šåŠ¡æ¥å£çš„ä¾èµ–ï¼Œé™ä½äº†è€¦åˆåº¦ã€‚**JDK åŠ¨æ€ä»£ç†æ˜¯åˆ©ç”¨åå°„æœºåˆ¶ç”Ÿæˆä¸€ä¸ªå®ç°ä»£ç†æ¥å£çš„åŒ¿åç±»**ï¼Œåœ¨è°ƒç”¨å…·ä½“æ–¹æ³•å‰è°ƒç”¨InvokeHandler æ¥å¤„ç†ã€‚ä½†æ˜¯ JDK åŠ¨æ€ä»£ç†æœ‰ä¸ªç¼ºæ†¾ï¼Œæˆ–è€…è¯´ç‰¹ç‚¹ï¼š**JDK å®ç°åŠ¨æ€ä»£ç†éœ€è¦å®ç°ç±»é€šè¿‡æ¥å£å®šä¹‰ä¸šåŠ¡æ–¹æ³•**ã€‚ä¹Ÿå°±æ˜¯è¯´å®ƒå§‹ç»ˆæ— æ³•æ‘†è„±ä»…æ”¯æŒ interface ä»£ç†çš„æ¡æ¢ï¼Œå› ä¸ºå®ƒçš„è®¾è®¡å°±æ³¨å®šäº†è¿™ä¸ªé—æ†¾ã€‚

### 2.3 CGLIB åŠ¨æ€ä»£ç†

ç”±ä¸Šé¢çš„åˆ†æå¯çŸ¥ï¼ŒJDK å®ç°åŠ¨æ€ä»£ç†éœ€è¦å®ç°ç±»é€šè¿‡æ¥å£å®šä¹‰ä¸šåŠ¡æ–¹æ³•ï¼Œé‚£å¯¹äºæ²¡æœ‰æ¥å£çš„ç±»ï¼Œå¦‚ä½•å®ç°åŠ¨æ€ä»£ç†å‘¢ï¼Œè¿™å°±éœ€è¦ CGLIB äº†ã€‚

CGLIB é‡‡ç”¨äº†éå¸¸åº•å±‚çš„å­—èŠ‚ç æŠ€æœ¯ï¼Œå…¶åŸç†æ˜¯**é€šè¿‡å­—èŠ‚ç æŠ€æœ¯ä¸ºä¸€ä¸ªç±»åˆ›å»ºå­ç±»ï¼Œå¹¶åœ¨å­ç±»ä¸­é‡‡ç”¨æ–¹æ³•æ‹¦æˆªçš„æŠ€æœ¯æ‹¦æˆªæ‰€æœ‰çˆ¶ç±»æ–¹æ³•çš„è°ƒç”¨ï¼Œé¡ºåŠ¿ç»‡å…¥æ¨ªåˆ‡é€»è¾‘**ã€‚ä½†å› ä¸ºé‡‡ç”¨çš„æ˜¯ç»§æ‰¿ï¼Œ**æ‰€ä»¥ä¸èƒ½å¯¹finalä¿®é¥°çš„ç±»è¿›è¡Œä»£ç†**ã€‚æˆ‘ä»¬æ¥å†™ä¸€ä¸ª CBLIB ä»£ç†ç±»ã€‚

```java
/**
* cglibä»£ç†å¤„ç†ç±»
* @author shengwu ni
*/
public class CglibProxyHandler implements MethodInterceptor {

   /**
    * ç»´æŠ¤ç›®æ ‡å¯¹è±¡
    */
   private Object target;

   public Object getProxyInstance(final Object target) {
       this.target = target;
       // Enhancerç±»æ˜¯CGLIBä¸­çš„ä¸€ä¸ªå­—èŠ‚ç å¢å¼ºå™¨ï¼Œå®ƒå¯ä»¥æ–¹ä¾¿çš„å¯¹ä½ æƒ³è¦å¤„ç†çš„ç±»è¿›è¡Œæ‰©å±•
       Enhancer enhancer = new Enhancer();
       // å°†è¢«ä»£ç†çš„å¯¹è±¡è®¾ç½®æˆçˆ¶ç±»
       enhancer.setSuperclass(this.target.getClass());
       // å›è°ƒæ–¹æ³•ï¼Œè®¾ç½®æ‹¦æˆªå™¨
       enhancer.setCallback(this);
       // åŠ¨æ€åˆ›å»ºä¸€ä¸ªä»£ç†ç±»
       return enhancer.create();
   }

   @Override
   public Object intercept(Object object, Method method, Object[] args,
           MethodProxy methodProxy) throws Throwable {

       System.out.println("ä»£ç†å…ˆè¿›è¡Œè°ˆåˆ¤â€¦â€¦");
       // å”±æ­Œéœ€è¦æ˜æ˜Ÿè‡ªå·±æ¥å”±
       Object result = methodProxy.invokeSuper(object, args);
       System.out.println("æ¼”å‡ºå®Œä»£ç†å»æ”¶é’±â€¦â€¦");
       return result;
   }
}
```

ä½¿ç”¨ CGLIB éœ€è¦å®ç° MethodInterceptor æ¥å£ï¼Œå¹¶é‡å†™intercept æ–¹æ³•ï¼Œåœ¨è¯¥æ–¹æ³•ä¸­å¯¹åŸå§‹è¦æ‰§è¡Œçš„æ–¹æ³•å‰ååšå¢å¼ºå¤„ç†ã€‚è¯¥ç±»çš„ä»£ç†å¯¹è±¡å¯ä»¥ä½¿ç”¨ä»£ç ä¸­çš„å­—èŠ‚ç å¢å¼ºå™¨æ¥è·å–ã€‚æ¥ä¸‹æ¥å†™ä¸ªå®¢æˆ·ç«¯æµ‹è¯•ç¨‹åºã€‚

```java
/**
* æµ‹è¯•å®¢æˆ·ç«¯
* @author shengwu ni
*/
public class Client {

   /**
    * æµ‹è¯•CglibåŠ¨æ€ä»£ç†ç»“æœ
    * @param args args
    */
   public static void main(String[] args) {
       Star realStar = new RealStar();
       Star proxy = (Star) new CglibProxyHandler().getProxyInstance(realStar);

       proxy.sing();
   }
}
```

è¿™ä¸ªå®¢æˆ·ç«¯æµ‹è¯•ç¨‹åºå’Œ JDK åŠ¨æ€ä»£ç†çš„é€»è¾‘ä¸€æ¨¡ä¸€æ ·ï¼Œæ‰€ä»¥ä¹Ÿå¯ä»¥çœ‹å‡ºï¼Œä»£ç†æ¨¡å¼ä¸­çš„åŠ¨æ€ä»£ç†ï¼Œå…¶å®å¥—è·¯éƒ½æ˜¯ç›¸åŒçš„ï¼Œåªæ˜¯ä½¿ç”¨äº†ä¸åŒçš„æŠ€æœ¯è€Œå·²ã€‚

æˆ‘ä»¬ä¹Ÿå¯¹ CGLIB åŠ¨æ€ä»£ç†åšä¸€ä¸‹æ€»ç»“ï¼šCGLIB åˆ›å»ºçš„åŠ¨æ€ä»£ç†å¯¹è±¡æ¯” JDK åˆ›å»ºçš„åŠ¨æ€ä»£ç†å¯¹è±¡çš„æ€§èƒ½æ›´é«˜ï¼Œä½†æ˜¯ CGLIB åˆ›å»ºä»£ç†å¯¹è±¡æ—¶æ‰€èŠ±è´¹çš„æ—¶é—´å´æ¯” JDK å¤šå¾—å¤šã€‚æ‰€ä»¥å¯¹äºå•ä¾‹çš„å¯¹è±¡ï¼Œå› ä¸ºæ— éœ€é¢‘ç¹åˆ›å»ºå¯¹è±¡ï¼Œç”¨ CGLIB åˆé€‚ï¼Œåä¹‹ä½¿ç”¨JDKæ–¹å¼è¦æ›´ä¸ºåˆé€‚ä¸€äº›ã€‚åŒæ—¶ç”±äº CGLIB ç”±äºæ˜¯é‡‡ç”¨åŠ¨æ€åˆ›å»ºå­ç±»çš„æ–¹æ³•ï¼Œå¯¹äºfinalä¿®é¥°çš„æ–¹æ³•æ— æ³•è¿›è¡Œä»£ç†ã€‚

å½“ç„¶äº†ï¼Œä¸ç®¡æ˜¯å“ªç§åŠ¨æ€ä»£ç†æŠ€æœ¯ï¼Œåœ¨ä¸Šé¢çš„ä»£ç é‡Œï¼Œè¦ä»£ç†çš„ç±»ä¸­å¯èƒ½ä¸æ­¢ä¸€ç§æ–¹æ³•ï¼Œæœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦å¯¹ç‰¹å®šçš„æ–¹æ³•è¿›è¡Œå¢å¼ºå¤„ç†ï¼Œæ‰€ä»¥å¯ä»¥å¯¹ä¼ å…¥çš„ method å‚æ•°è¿›è¡Œæ–¹æ³•åçš„åˆ¤æ–­ï¼Œå†åšç›¸åº”çš„å¤„ç†ã€‚

### 2.4 Spring AOP é‡‡ç”¨å“ªç§ä»£ç†ï¼Ÿ

JDK åŠ¨æ€ä»£ç†å’Œ CGLIB åŠ¨æ€ä»£ç†å‡æ˜¯å®ç° Spring AOP çš„åŸºç¡€ã€‚å¯¹äºè¿™ä¸€å—å†…å®¹ï¼Œé¢è¯•å®˜é—®çš„æ¯”è¾ƒå¤šï¼Œä»–ä»¬å¾€å¾€æ›´æƒ³å¬å¬é¢è¯•è€…æ˜¯æ€ä¹ˆå›ç­”çš„ï¼Œæœ‰æ²¡æœ‰çœ‹è¿‡è¿™ä¸€å—çš„æºç ç­‰ç­‰ã€‚

é’ˆå¯¹äºè¿™ä¸€å—å†…å®¹ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹ Spring 5 ä¸­å¯¹åº”çš„æºç æ˜¯æ€ä¹ˆè¯´çš„ã€‚

```java
public class DefaultAopProxyFactory implements AopProxyFactory, Serializable {

 @Override
 public AopProxy createAopProxy(AdvisedSupport config) throws AopConfigException {
   if (config.isOptimize() || config.isProxyTargetClass() || hasNoUserSuppliedProxyInterfaces(config)) {
     Class<?> targetClass = config.getTargetClass();
     if (targetClass == null) {
       throw new AopConfigException("TargetSource cannot determine target class: " +
           "Either an interface or a target is required for proxy creation.");
     }
       // åˆ¤æ–­ç›®æ ‡ç±»æ˜¯å¦æ˜¯æ¥å£æˆ–è€…ç›®æ ‡ç±»æ˜¯å¦Proxyç±»å‹ï¼Œè‹¥æ˜¯åˆ™ä½¿ç”¨JDKåŠ¨æ€ä»£ç†
     if (targetClass.isInterface() || Proxy.isProxyClass(targetClass)) {
       return new JdkDynamicAopProxy(config);
     }
       // é…ç½®äº†ä½¿ç”¨CGLIBè¿›è¡ŒåŠ¨æ€ä»£ç†æˆ–è€…ç›®æ ‡ç±»æ²¡æœ‰æ¥å£ï¼Œé‚£ä¹ˆä½¿ç”¨CGLIBçš„æ–¹å¼åˆ›å»ºä»£ç†å¯¹è±¡
     return new ObjenesisCglibAopProxy(config);
   }
   else {
       // ä¸Šé¢çš„ä¸‰ä¸ªæ–¹æ³•æ²¡æœ‰ä¸€ä¸ªä¸ºtrueï¼Œé‚£ä½¿ç”¨JDKçš„æä¾›çš„ä»£ç†æ–¹å¼ç”Ÿæˆä»£ç†å¯¹è±¡
     return new JdkDynamicAopProxy(config);
   }
 }
   //å…¶ä»–æ–¹æ³•ç•¥â€¦â€¦
}
```

ä»ä¸Šè¿°æºç ç‰‡æ®µå¯ä»¥çœ‹å‡ºï¼Œæ˜¯å¦ä½¿ç”¨ CGLIB æ˜¯åœ¨ä»£ç ä¸­è¿›è¡Œåˆ¤æ–­çš„ï¼Œåˆ¤æ–­æ¡ä»¶æ˜¯ config.isOptimize()ã€config.isProxyTargetClass() å’Œ hasNoUserSuppliedProxyInterfaces(config)ã€‚

å…¶ä¸­ï¼Œconfig.isOptimize() ä¸ config.isProxyTargetClass()é»˜è®¤è¿”å›éƒ½æ˜¯ falseï¼Œè¿™ç§æƒ…å†µä¸‹åˆ¤æ–­ç»“æœå°±ç”±
hasNoUserSuppliedProxyInterfaces(config)çš„ç»“æœå†³å®šäº†ã€‚

ç®€å•æ¥è¯´ï¼Œ
hasNoUserSuppliedProxyInterfaces(config) å°±æ˜¯åœ¨åˆ¤æ–­ä»£ç†çš„å¯¹è±¡æ˜¯å¦æœ‰å®ç°æ¥å£ï¼Œæœ‰å®ç°æ¥å£çš„è¯ç›´æ¥èµ° JDK åˆ†æ”¯ï¼Œå³ä½¿ç”¨ JDK çš„åŠ¨æ€ä»£ç†ã€‚

æ‰€ä»¥åŸºæœ¬ä¸Šå¯ä»¥æ€»ç»“å‡º Spring AOP ä¸­çš„ä»£ç†ä½¿ç”¨é€»è¾‘äº†ï¼šå¦‚æœç›®æ ‡å¯¹è±¡å®ç°äº†æ¥å£ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¼šé‡‡ç”¨ JDK çš„åŠ¨æ€ä»£ç†å®ç° AOPï¼›å¦‚æœç›®æ ‡å¯¹è±¡æ²¡æœ‰å®ç°äº†æ¥å£ï¼Œåˆ™é‡‡ç”¨ CGLIB åº“ï¼ŒSpring ä¼šè‡ªåŠ¨åœ¨ JDK åŠ¨æ€ä»£ç†å’Œ CGLIB åŠ¨æ€ä»£ç†ä¹‹é—´è½¬æ¢ã€‚

å½“ç„¶ï¼Œæºç æˆ‘ä¹Ÿæ²¡è¯»é‚£ä¹ˆæ·±ï¼Œæš‚ä¸”å°±åªèƒ½å†™åˆ°è¿™ï¼Œåé¢æ·±å…¥äº†ï¼Œæœ‰æ–°çš„è§è§£å†ç»™å¤§å®¶åˆ†äº«ã€‚è¿˜è®°å¾—æ–‡ç« å¼€å¤´çš„å‡ ä¸ªé—®é¢˜å—ï¼Ÿç›¸ä¿¡ä½ è¯»åˆ°è¿™é‡Œï¼Œå¿ƒä¸­åº”è¯¥å·²ç»æœ‰äº†ç­”æ¡ˆäº†ã€‚

OKï¼Œæ¥ä¸‹æ¥æ¥å®æˆ˜ä¸€ä¸‹å§ã€‚

## 3ã€AOPå®ç°æ–¹å¼

### 3.1ï¼Œå®šä¹‰ä¸€ä¸ªæ¥å£ï¼Œä»»ä½•æµ‹è¯•ç±»éƒ½å¯ä»¥å®ç°å®ƒã€‚

```java
package com.java.aopTest;

public interface Test {
    void printTest();

    void doPrint();
}

```

### 3.2ï¼Œå®šä¹‰ä¸¤ä¸ªæ¥å£å®ç°ç±»

```java
package com.java.aopTest;

public class Test1 implements Test{
    public void printTest() {
        System.out.println("å¯åŠ¨Test1.printTest()");
    }

    public void doPrint() {
        System.out.println("æ‰“å°TestImpl1");
        return ;
    }
}

```

```java
package com.java.aopTest;

public class Test2 implements Test{
    public void printTest() {
        System.out.println("å¯åŠ¨Test2.printTest()");
    }

    public void doPrint() {
        System.out.println("æ‰“å°TestImpl2");
        return ;
    }
}

```

### 3.3ï¼Œå‘¨è¾¹ä¸šåŠ¡ï¼Œå®ç°è§£è€¦æ“ä½œ

Testçš„ä¸¤ä¸ªå®ç°ç±»å…³æ³¨çš„æ˜¯ä¸šåŠ¡é€»è¾‘ï¼Œä½†åœ¨æ­¤ä¹‹å¤–è¿˜éœ€è¦å…¶ä»–çš„åŠŸèƒ½é€»è¾‘ç­‰ï¼Œå¦‚æ‰“å°æ—¶é—´ã€æ‰“å°æ—¥å¿—ç­‰ç­‰ã€‚è¿™é‡Œå¼€å§‹å°±éœ€è¦AOPæ›¿â€œTestImplâ€å®Œæˆï¼ä¹Ÿå°±æ˜¯è§£è€¦æ“ä½œã€‚é¦–å…ˆéœ€è¦ä¸€ä¸ªTimeHandlerç±»ã€‚å› ä¸ºä¸€ä¸ªæ˜¯åˆ‡å…¥ç‚¹å‰æ‰§è¡Œã€ä¸€ä¸ªæ˜¯åˆ‡å…¥ç‚¹ä¹‹åæ‰§è¡Œï¼Œæ‰€ä»¥å®ç°å¯¹åº”æ¥å£ã€‚æ¨ªåˆ‡å…³æ³¨ç‚¹ï¼Œè¿™é‡Œæ˜¯æ‰“å°æ—¶é—´ï¼š

```java
package com.java.aopTest;

import org.springframework.aop.AfterReturningAdvice;
import org.springframework.aop.MethodBeforeAdvice;

import java.lang.reflect.Method;

public class TimeHandler implements MethodBeforeAdvice , AfterReturningAdvice {
    public void before(Method method, Object[] args, Object target) throws Throwable {
        System.out.println("ä»£ç†----å‰----CurrentTime = " + System.currentTimeMillis());

    }

    public void afterReturning(Object returnValue, Method method, Object[] args, Object target) throws Throwable {
        System.out.println("ä»£ç†----å----CurrentTime = " + System.currentTimeMillis());
    }

}

```

### 3.4ï¼ŒSpringæ ¸å¿ƒé…ç½®æ–‡ä»¶applicationContext.xmlé…ç½®AOP

```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd">

    <!-- å®šä¹‰è¢«ä»£ç†è€… -->
    <bean id="h1" class="com.java.aopTest.Test1"></bean>
    <bean id="h2" class="com.java.aopTest.Test2"></bean>

    <!-- å®šä¹‰é€šçŸ¥å†…å®¹ï¼Œä¹Ÿå°±æ˜¯åˆ‡å…¥ç‚¹æ‰§è¡Œå‰åéœ€è¦åšçš„äº‹æƒ… -->
    <bean id="timeHandler" class="com.java.aopTest.TimeHandler"></bean>

    <!-- å®šä¹‰åˆ‡å…¥ç‚¹ä½ç½®ï¼Œè¿™é‡Œå®šä¹‰åˆ°äº†doPrintæ–¹æ³•ä¸Š -->
    <bean id="timePointcut" class="org.springframework.aop.support.JdkRegexpMethodPointcut">
        <property name="pattern" value=".*doPrint"></property>
    </bean>

    <!-- ä½¿åˆ‡å…¥ç‚¹ä¸é€šçŸ¥ç›¸å…³è”ï¼Œå®Œæˆåˆ‡é¢é…ç½® -->
    <bean id="timeHandlerAdvisor" class="org.springframework.aop.support.DefaultPointcutAdvisor">
        <property name="advice" ref="timeHandler"></property>
        <property name="pointcut" ref="timePointcut"></property>
    </bean>

    <!-- è®¾ç½®ä»£ç† -->
    <bean id="proxy" class="org.springframework.aop.framework.ProxyFactoryBean">
        <!-- ä»£ç†çš„å¯¹è±¡ï¼Œæœ‰æ‰“å°æ—¶é—´èƒ½åŠ› -->
        <property name="target" ref="h1"></property>
        <!-- ä½¿ç”¨åˆ‡é¢ -->
        <property name="interceptorNames" value="timeHandlerAdvisor"></property>
        <!-- ä»£ç†æ¥å£ï¼Œhwæ¥å£ -->
        <property name="proxyInterfaces" value="com.java.aopTest.Test"></property>
    </bean>
    <!-- è®¾ç½®ä»£ç† -->
    <bean id="proxy2" class="org.springframework.aop.framework.ProxyFactoryBean">
        <!-- ä»£ç†çš„å¯¹è±¡ï¼Œæœ‰æ‰“å°æ—¶é—´èƒ½åŠ› -->
        <property name="target" ref="h2"></property>
        <!-- ä½¿ç”¨åˆ‡é¢ -->
        <property name="interceptorNames" value="timeHandlerAdvisor"></property>
        <!-- ä»£ç†æ¥å£ï¼Œhwæ¥å£ -->
        <property name="proxyInterfaces" value="com.java.aopTest.Test"></property>
    </bean>

</beans>
```

### 3.5ï¼Œæµ‹è¯•ç±»Test

å…¶ä¸­é€šè¿‡AOPä»£ç†æ–¹æ³•æ‰§è¡Œh1ï¼Œh2ï¼Œå…¶ä¸­doPrint()æ–¹æ³•ä¼šæŠŠæ‰§è¡Œå‰ã€æ‰§è¡Œåçš„æ“ä½œæ‰§è¡Œï¼Œå®ç°äº†AOPçš„æ•ˆæœï¼

```java
package com.java.aopMain;

import com.java.aopTest.Test;
import org.springframework.context.ApplicationContext;
import org.springframework.context.support.ClassPathXmlApplicationContext;

public class AopMain {
    public static void main(String[] args) {
        ApplicationContext appCtx = new ClassPathXmlApplicationContext("applicationContext.xml");
        Test t1 = (Test) appCtx.getBean("proxy");
        Test t2 = (Test) appCtx.getBean("proxy2");
        t1.printTest();
        System.out.println();
        t1.doPrint();
        System.out.println();

        t2.printTest();
        System.out.println();
        t2.doPrint();
    }
}

```

è¿è¡Œç»“æœï¼šå¯ä»¥çœ‹åˆ°ï¼Œé…ç½®åœ¨h1ã€h2çš„doPrint()å‰åæ‰“å°æ—¶é—´çš„æ–¹æ³•éƒ½æ‰§è¡Œäº†ï¼›

![image-20201008204505899](https://gitee.com/Huke-123/PicCloud/raw/master/20201008204505.png)

## 4. ä½¿ç”¨æ³¨è§£æ–¹å¼å¼€å‘AOP

æˆ‘ä»¬åˆ—ä¸¾ä¸€ä¸‹Springä¸­çš„AspectJæ³¨è§£ï¼š

| æ³¨è§£            | é€šçŸ¥                                           | å¤‡æ³¨                                                         |
| --------------- | ---------------------------------------------- | ------------------------------------------------------------ |
| @Before         | åœ¨è¢«ä»£ç†å¯¹è±¡çš„æ–¹æ³•å‰å…ˆè°ƒç”¨                     | å‰ç½®é€šçŸ¥                                                     |
| @Around         | å°†è¢«ä»£ç†å¯¹è±¡çš„æ–¹æ³•å°è£…èµ·æ¥ï¼Œå¹¶ç”¨ç¯ç»•é€šçŸ¥å–ä»£å®ƒ | ç¯ç»•é€šçŸ¥ï¼Œå®ƒå°†è¦†ç›–åŸæœ‰æ–¹æ³•ï¼Œä½†æ˜¯å…è®¸ä½ é€šè¿‡åå°„è°ƒç”¨åŸæœ‰æ–¹æ³•ï¼Œ |
| @After          | åœ¨è¢«ä»£ç†å¯¹è±¡çš„æ–¹æ³•åè°ƒç”¨                       | åç½®é€šçŸ¥ï¼Œåœ¨è¿æ¥ç‚¹æ–¹æ³•åè°ƒç”¨                                 |
| @AfterReturning | åœ¨è¢«ä»£ç†å¯¹è±¡çš„æ–¹æ³•æ­£å¸¸è¿”å›åè°ƒç”¨               | è¿”å›é€šçŸ¥ï¼Œåœ¨è¿æ¥ç‚¹æ–¹æ³•æ‰§è¡Œå¹¶æ­£å¸¸è¿”å›åè°ƒç”¨ï¼Œè¦æ±‚è¿æ¥ç‚¹æ–¹æ³•åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­æ²¡æœ‰å‘ç”Ÿå¼‚å¸¸ |
| @AfterThrowing  | åœ¨è¢«ä»£ç†å¯¹è±¡çš„æ–¹æ³•æŠ›å‡ºå¼‚å¸¸åè°ƒç”¨               | å¼‚å¸¸é€šçŸ¥ï¼Œå½“è¿æ¥ç‚¹æ–¹æ³•å¼‚å¸¸æ—¶è°ƒç”¨                             |

æœ‰äº†ä¸Šè¡¨ï¼Œæˆ‘ä»¬å°±çŸ¥é“ before() æ–¹æ³•æ˜¯è¿æ¥ç‚¹æ–¹æ³•è°ƒç”¨å‰è°ƒç”¨çš„æ–¹æ³•ï¼Œè€Œ after() æ–¹æ³•åˆ™ç›¸åï¼Œè¿™äº›æ³¨è§£ä¸­é—´ä½¿ç”¨äº†å®šä¹‰åˆ‡ç‚¹çš„æ­£åˆ™å¼ï¼Œä¹Ÿå°±æ˜¯å‘Šè¯‰ Spring AOP éœ€è¦æ‹¦æˆªä»€ä¹ˆå¯¹è±¡çš„ä»€ä¹ˆæ–¹æ³•ã€‚

## å°ç»“ï¼š

è¿™èŠ‚æˆ‘ä»¬åˆå­¦äº†Spring AOPï¼Œäº†è§£äº†åŸºæœ¬æ¦‚å¿µä»¥åŠåŸºæœ¬çš„å®ç°æ–¹å¼ï¼Œè¿˜æœ‰å¸¸è§çš„æ³¨è§£æ–¹å¼è¯¦è§£ã€‚

----

> æ–‡ç« å¯ä»¥ç™½å«–ï¼Œå…¬ä¼—å·ä¸èƒ½ä¸å…³æ³¨ï¼Œæ‰‹åŠ¨æ»‘ç¨½ğŸ¤£ğŸ¤£ &nbsp;
>
> æ¬¢è¿å¤§å®¶å…³æ³¨ï¼š**æ­¦å“¥èŠç¼–ç¨‹**ã€**Javaå¼€å‘å®å…¸**ï¼Œæ‚¨çš„æ”¯æŒï¼Œæ˜¯æˆ‘ä»¬åˆ›ä½œçš„æŒç»­åŠ¨åŠ›ï¼&nbsp;&nbsp;

![æ­¦å“¥èŠç¼–ç¨‹](https://img-blog.csdnimg.cn/202002150421550.jpg)![Javaå¼€å‘å®å…¸](https://img-blog.csdnimg.cn/20200608005630228.png)![Javaç§ƒå¤´å“¥](https://img-blog.csdnimg.cn/20201025170941235.png)

----

