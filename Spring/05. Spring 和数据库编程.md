
> æ–‡ç« å¯ä»¥ç™½å«–ï¼Œå…¬ä¼—å·ä¸èƒ½ä¸å…³æ³¨ï¼Œæ‰‹åŠ¨æ»‘ç¨½ğŸ¤£ğŸ¤£ &nbsp;
>
> æ¬¢è¿å¤§å®¶å…³æ³¨ï¼š**æ­¦å“¥èŠç¼–ç¨‹**ã€**Javaå¼€å‘å®å…¸**ï¼Œæ‚¨çš„æ”¯æŒï¼Œæ˜¯æˆ‘ä»¬åˆ›ä½œçš„æŒç»­åŠ¨åŠ›ï¼&nbsp;&nbsp;

![æ­¦å“¥èŠç¼–ç¨‹](https://img-blog.csdnimg.cn/202002150421550.jpg)![Javaå¼€å‘å®å…¸](https://img-blog.csdnimg.cn/20200608005630228.png)![Javaç§ƒå¤´å“¥](https://img-blog.csdnimg.cn/20201025170941235.png)

----

å°ä¼™ä¼´å„¿ä»¬ï¼Œå¤§å®¶å¥½ï¼ä¸Šä¸€ç¯‡æˆ‘ä»¬å­¦ä¹ äº† Spring AOP ç›¸å…³çŸ¥è¯†ï¼›ç°åœ¨æˆ‘ä»¬æ¥å­¦ä¹ ä¸€ä¸‹Springä¸­çš„æ•°æ®åº“ç¼–ç¨‹ã€‚

![image-20201019211231936](https://gitee.com/Huke-123/PicCloud/raw/master/20201019211232.png)

## 1. ä¼ ç»Ÿçš„jdbcä»£ç 

æˆ‘ä»¬åˆšå¼€å§‹å­¦ä¹ jdbcè¿æ¥æ•°æ®åº“çš„æ—¶å€™ä¸€èˆ¬æ˜¯å°è£…æˆä¸€ä¸ªè¿æ¥æ•°æ®åº“çš„å·¥å…·ç±»ï¼Œå¦‚ä¸‹ï¼š

```java
package com.java.util;

import java.sql.Connection;
import java.sql.DriverManager;

/**
 * æ•°æ®åº“å·¥å…·ç±»
 * @author Administrator
 *
 */
public class DbUtil {

	private String dbUrl="jdbc:mysql://localhost:3306/db_book"; // æ•°æ®åº“è¿æ¥åœ°å€
	private String dbUserName="root"; // ç”¨æˆ·å
	private String dbPassword="123456"; // å¯†ç 
	private String jdbcName="com.mysql.jdbc.Driver"; // é©±åŠ¨åç§°
	
	/**
	 * è·å–æ•°æ®åº“è¿æ¥
	 * @return
	 * @throws Exception
	 */
	public Connection getCon()throws Exception{
		Class.forName(jdbcName);
		Connection con=DriverManager.getConnection(dbUrl, dbUserName, dbPassword);
		return con;
	}
	
	/**
	 * å…³é—­æ•°æ®åº“è¿æ¥
	 * @param con
	 * @throws Exception
	 */
	public void closeCon(Connection con)throws Exception{
		if(con!=null){
			con.close();
		}
	}
	
	public static void main(String[] args) {
		DbUtil dbUtil=new DbUtil();
		try {
			dbUtil.getCon();
			System.out.println("æ•°æ®åº“è¿æ¥æˆåŠŸï¼");
		} catch (Exception e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
			System.out.println("æ•°æ®åº“è¿æ¥å¤±è´¥ï¼");
		}
	}
	
}

```

è¿™ç§æ¨¡å¼ä¸€èˆ¬æ˜¯æˆ‘ä»¬ç»å¸¸ä½¿ç”¨çš„ï¼Œæ¯”è¾ƒæ–¹ä¾¿ã€‚å¦‚æœä½ ç”¨å¾—å¥½jdbcï¼Œå…¶æ€§èƒ½æ˜¯æœ€å¥½çš„ï¼Œä½†æ˜¯å¤ªå¤šçš„try...catchè¯­å¥éœ€è¦å¤„ç†ï¼Œæ•°æ®åº“èµ„æºçš„æ‰“å¼€ã€å…³é—­éƒ½æ˜¯å®šæ€§çš„ï¼Œç”šè‡³åœ¨å¤§éƒ¨åˆ†çš„æƒ…å†µä¸‹ï¼Œåªè¦å‘ç”Ÿå¼‚å¸¸æ•°æ®åº“çš„äº‹åŠ¡å°±ä¼šå›æ»šï¼Œå¦åˆ™å°±æäº¤ï¼ŒäºŒè€…éƒ½æ˜¯æ¯”è¾ƒå›ºå®šçš„æ¨¡å¼ã€‚å¤ªå¤šçš„try...catchè¯­å¥ä¼šå¯¼è‡´ä»£ç å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§æ€¥å‰§é™ä½ï¼Œä»è€Œå¼•å‘ä¿¡ä»»é—®é¢˜ã€‚ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ï¼ŒSpringæä¾›äº†è‡ªå·±çš„æ–¹æ¡ˆï¼Œé‚£å°±æ˜¯Jdbc Templateæ¨¡æ¿ã€‚ä¸è¿‡åœ¨è¿™ä¹‹å‰éœ€è¦äº†è§£Springä¸­æ˜¯å¦‚ä½•é…ç½®æ•°æ®åº“èµ„æºçš„ã€‚

## 2. é…ç½®æ•°æ®åº“èµ„æº

### 2.1 ä½¿ç”¨ç®€å•æ•°æ®åº“é…ç½®

é¦–å…ˆè®¨è®ºä¸€ä¸ªç®€å•çš„æ•°æ®åº“é…ç½®ï¼Œå®ƒæ˜¯Springæä¾›çš„ä¸€ä¸ªç±»`org.springframework.jdbc.datasource.SimpleDriverDataSource`ï¼Œç”±äºä½¿ç”¨ç¬¬ä¸‰æ–¹çš„ç±»ï¼Œä¸€èˆ¬é‡‡ç”¨ XML æ–‡ä»¶é…ç½®çš„æ–¹å¼ï¼Œæˆ‘ä»¬è¿™é‡Œä¹Ÿä½¿ç”¨ XML æ–‡ä»¶é…ç½®çš„å½¢å¼ï¼š

```xml
<bean id="dateSource" class="org.springframework.jdbc.datasource.SimpleDriverDataSource">
    <property name="username" value="root"/>
    <property name="password" value="123456"/>
    <property name="driverClass" value="com.mysql.jdbc.Driver"/>
    <property name="url" value="jdbc://mysql://locolhost:3306/db_book"/>
</bean>
```

### 2.2. ä½¿ç”¨ç¬¬ä¸‰æ–¹æ•°æ®åº“è¿æ¥æ± 

ä¸Šé¢é…ç½®çš„è¿™ä¸ªç®€å•çš„æ•°æ®æºä¸€èˆ¬ç”¨äºæµ‹è¯•ï¼Œå› ä¸ºå®ƒä¸æ˜¯ä¸€ä¸ªæ•°æ®åº“è¿æ¥æ± ï¼Œåªæ˜¯ä¸€ä¸ªå¾ˆç®€å•çš„æ•°æ®åº“è¿æ¥çš„åº”ç”¨ã€‚åœ¨æ›´å¤šçš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ç¬¬ä¸‰æ–¹çš„æ•°æ®åº“è¿æ¥ï¼Œæ¯”å¦‚ä½¿ç”¨ C3P0æ•°æ®åº“è¿æ¥æ± ï¼š

```xml
<bean id="dataSource" class="com.mchange.v2.c3p0.ComboPooledDataSource">
    <property name="driverClass" value="com.mysql.jdbc.Driver"></property>
    <property name="jdbcUrl" value="jdbc:mysql:///hib_demo"></property>
    <property name="user" value="root"></property>
    <property name="password" value="root"></property>
    <property name="initialPoolSize" value="3"></property>
    <property name="maxPoolSize" value="10"></property>
    <property name="maxStatements" value="100"></property>
    <property name="acquireIncrement" value="2"></property>
</bean>
```

è·Ÿä¸Šé¢çš„æµ‹è¯•å·®ä¸å¤šï¼Œä¸åŒçš„æ˜¯éœ€è¦å¼•å…¥ç›¸å…³æ”¯æŒ C3P0 æ•°æ®åº“è¿æ¥æ± çš„ jar åŒ…è€Œå·²ã€‚

## 3. Jdbc Template

å®ƒæ˜¯  springæ¡†æ¶ä¸­æä¾›çš„ä¸€ä¸ªå¯¹è±¡ï¼Œæ˜¯å¯¹åŸå§‹  Jdbc APIå¯¹è±¡çš„ç®€å•å°è£…ã€‚springæ¡†æ¶ä¸ºæˆ‘ä»¬æä¾›äº†å¾ˆå¤šçš„æ“ä½œæ¨¡æ¿ç±»ã€‚ 
ä¾‹å¦‚æ“ä½œå…³ç³»å‹æ•°æ®çš„ï¼š `JdbcTemplate` 
æ“ä½œ nosqlæ•°æ®åº“çš„ï¼š `RedisTemplate` 
æ“ä½œæ¶ˆæ¯é˜Ÿåˆ—çš„ï¼š `JmsTemplate` 

æˆ‘ä»¬ä»Šå¤©çš„ä¸»è§’åœ¨   `spring-jdbc-5.0.2.RELEASE.jar` ä¸­ï¼Œæˆ‘ä»¬åœ¨å¯¼åŒ…çš„æ—¶å€™ï¼Œé™¤äº†è¦å¯¼å…¥è¿™ä¸ª jar åŒ… å¤–ï¼Œè¿˜éœ€è¦å¯¼å…¥ä¸€ä¸ª`spring-tx-5.0.2.RELEASE.jar`ï¼ˆå®ƒæ˜¯å’Œäº‹åŠ¡ç›¸å…³çš„ï¼‰ã€‚

### 3.1 Jdbc Templateå¯¹è±¡çš„åˆ›å»º

æ–°å»ºmavené¡¹ç›®ï¼Œä¾èµ–æ–‡ä»¶pom.xmlå¦‚ä¸‹ï¼š

```xml
<dependencies>
        <dependency>
            <groupId>org.springframework</groupId>
            <artifactId>spring-context</artifactId>
            <version>5.0.2.RELEASE</version>
        </dependency>

        <dependency>
            <groupId>org.springframework</groupId>
            <artifactId>spring-jdbc</artifactId>
            <version>5.0.2.RELEASE</version>
        </dependency>

        <dependency>
            <groupId>org.springframework</groupId>
            <artifactId>spring-tx</artifactId>
            <version>5.0.2.RELEASE</version>
        </dependency>

        <dependency>
            <groupId>mysql</groupId>
            <artifactId>mysql-connector-java</artifactId>
            <version>5.1.6</version>
        </dependency>
    </dependencies>
```

æˆ‘ä»¬å…ˆåœ¨æ•°æ®åº“ä¸­å»ºä¸€ä¸ªè¡¨t_accountï¼š

![image-20201019192252597](https://gitee.com/Huke-123/PicCloud/raw/master/20201019192252.png)

ç„¶ååœ¨é¡¹ç›®ä¸­æ–°å»ºä¸€ä¸ªå®ä½“ç±»Accountï¼š

```java
import java.io.Serializable;

public class Account implements Serializable {

    private int id;
    private int money;
    private String userName;

    public int getId() {
        return id;
    }

    public void setId(int id) {
        this.id = id;
    }

    public int getMoney() {
        return money;
    }

    public void setMoney(int money) {
        this.money = money;
    }

    public String getUserName() {
        return userName;
    }

    public void setUserName(String userName) {
        this.userName = userName;
    }

    @Override
    public String toString() {
        return "Account{" +
                "id=" + id +
                ", money=" + money +
                ", userName='" + userName + '\'' +
                '}';
    }
}

```

æµ‹è¯•æ–‡ä»¶ï¼š

```java
import org.springframework.jdbc.core.JdbcTemplate;
import org.springframework.jdbc.datasource.DriverManagerDataSource;
/**
 * @author å…¬ä¼—å·:ç¨‹åºå‘˜çš„æ—¶å…‰
 * @create 2020-10-19 19:08
 * @description
 */
public class JdbcTemplateTest1 {
    public static void main(String[] args) {
        //å‡†å¤‡æ•°æ®æºï¼šspringçš„å†…ç½®æ•°æ®æº
        DriverManagerDataSource ds = new DriverManagerDataSource();
        ds.setDriverClassName("com.mysql.jdbc.Driver");
        ds.setUrl("jdbc:mysql://localhost:3306/db_bank");
        ds.setUsername("root");
        ds.setPassword("123456");

        //1.åˆ›å»ºJdbcTemplateå¯¹è±¡
        JdbcTemplate jt = new JdbcTemplate();
        //ç»™jtè®¾ç½®æ•°æ®æº
        jt.setDataSource(ds);
        //2.æ‰§è¡Œæ“ä½œ
        jt.execute("insert into t_account(name,money)values('ccc',1000)");
    }
}

```

æœ€åæˆ‘ä»¬çœ‹æ•°æ®åº“ä¸­ï¼š

![image-20201019192555362](https://gitee.com/Huke-123/PicCloud/raw/master/20201019192555.png)

ä½†æ˜¯è¿™äº›é…ç½®ä¾æ—§å¾ˆç¹çï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•åœ¨Springåˆ©ç”¨IoCæ•´åˆè¿™äº›é…ç½®æ–‡ä»¶ã€‚

### 3.2 Jdbc Templateåœ¨Springçš„IoCä¸­ä½¿ç”¨

æˆ‘ä»¬åœ¨ä¸Šé¢çš„åŸºç¡€ä¸Šï¼Œæ¥é…ç½®bean.xmlæ–‡ä»¶ï¼š

```xml
<!--é…ç½®JdbcTemplate-->
    <bean id="jdbcTemplate" class="org.springframework.jdbc.core.JdbcTemplate">
        <property name="dataSource" ref="dataSource"></property>
    </bean>

    <!-- é…ç½®æ•°æ®æº-->
    <bean id="dataSource" class="org.springframework.jdbc.datasource.DriverManagerDataSource">
        <property name="driverClassName" value="com.mysql.jdbc.Driver"></property>
        <property name="url" value="jdbc:mysql://localhost:3306/db_bank"></property>
        <property name="username" value="root"></property>
        <property name="password" value="123456"></property>
    </bean>
```

å†æ¥çœ‹æµ‹è¯•æ–‡ä»¶ï¼š

```java
import org.springframework.context.ApplicationContext;
import org.springframework.context.support.ClassPathXmlApplicationContext;
import org.springframework.jdbc.core.JdbcTemplate;
import org.springframework.jdbc.datasource.DriverManagerDataSource;

public class JdbcTemplateTest2 {
    public static void main(String[] args) {
        //1.è·å–å®¹å™¨
        ApplicationContext ac = new ClassPathXmlApplicationContext("bean.xml");
        //2.è·å–å¯¹è±¡
        JdbcTemplate jt = ac.getBean("jdbcTemplate",JdbcTemplate.class);
        //3.æ‰§è¡Œæ“ä½œ
        jt.execute("insert into t_account(name,money)values('ddd',2222)");
    }
}

```

æœ€åæˆ‘ä»¬çœ‹æ•°æ®åº“ä¸­ï¼š

![image-20201019200854915](https://gitee.com/Huke-123/PicCloud/raw/master/20201019200854.png)

### 3.3 Jdbc Templateçš„CRUDæ“ä½œ

ä¸Šé¢å±•ç¤ºçš„æ˜¯Jdbc Templateæœ€åŸºæœ¬çš„æ“ä½œï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•åœ¨Jdbc Templateè¿›è¡ŒCRUDæ“ä½œ

#### 3.3.1 ä¿å­˜æ“ä½œ

```java
public class JdbcTemplateTest3 {
    public static void main(String[] args) {
        //1.è·å–å®¹å™¨
        ApplicationContext ac = new ClassPathXmlApplicationContext("bean.xml");
        //2.è·å–å¯¹è±¡
        JdbcTemplate jt = ac.getBean("jdbcTemplate",JdbcTemplate.class);
        //3.æ‰§è¡Œæ“ä½œ
        //jt.execute("insert into t_account(name,money)values('ddd',2222)");
        //ä¿å­˜
        jt.update("insert into t_account(name,money)values(?,?)","eee",3333);
    }
}
```

ç»“æœï¼š

![image-20201019202151278](https://gitee.com/Huke-123/PicCloud/raw/master/20201019202151.png)

#### 3.3.2 æ›´æ–°æ“ä½œ

```java
//æ›´æ–°
        jt.update("update t_account set name=?,money=? where id=?","test",4567,3);
```

ç»“æœï¼š

![image-20201019202425954](https://gitee.com/Huke-123/PicCloud/raw/master/20201019202426.png)

#### 3.3.3 åˆ é™¤æ“ä½œ

```java
//åˆ é™¤
        jt.update("delete from t_account where id=?",2);
```

ç»“æœï¼š

![image-20201019202628666](https://gitee.com/Huke-123/PicCloud/raw/master/20201019202628.png)

#### 3.3.4 æŸ¥è¯¢æ“ä½œ

##### 3.3.4.1 æŸ¥è¯¢æ‰€æœ‰ï¼š

```java
public class JdbcTemplateTest3 {
    public static void main(String[] args) {
        //1.è·å–å®¹å™¨
        ApplicationContext ac = new ClassPathXmlApplicationContext("bean.xml");
        //2.è·å–å¯¹è±¡
        JdbcTemplate jt = ac.getBean("jdbcTemplate",JdbcTemplate.class);
        /*3.æ‰§è¡Œæ“ä½œ
        jt.execute("insert into t_account(name,money)values('ddd',2222)");
        ä¿å­˜
        jt.update("insert into t_account(name,money)values(?,?)","eee",3333f);
        æ›´æ–°
        jt.update("update t_account set name=?,money=? where id=?","test",4567,3);
        åˆ é™¤
        jt.update("delete from t_account where id=?",2);*/
        //æŸ¥è¯¢æ‰€æœ‰
        List<Account> accounts = jt.query("select * from t_account where money > ?",new BeanPropertyRowMapper<Account>(Account.class),1000f);
        for(Account account : accounts){
            System.out.println(account);
        }
    }
}
```

ç»“æœï¼š

![image-20201019203815781](https://gitee.com/Huke-123/PicCloud/raw/master/20201019203815.png)

##### 3.3.4.2 æŸ¥è¯¢ä¸€ä¸ªï¼š

```java
//æŸ¥è¯¢ä¸€ä¸ª
        List<Account> accounts = jt.query("select * from t_account where id = ?",new BeanPropertyRowMapper<Account>(Account.class),1);
        System.out.println(accounts.isEmpty()?"æ²¡æœ‰å†…å®¹":accounts.get(0));
```

ç»“æœï¼š

![image-20201019210030675](https://gitee.com/Huke-123/PicCloud/raw/master/20201019210030.png)

##### æŸ¥è¯¢ä¸€è¡Œä¸€åˆ—ï¼š

```java
//æŸ¥è¯¢è¿”å›ä¸€è¡Œä¸€åˆ—ï¼ˆä½¿ç”¨èšåˆå‡½æ•°ï¼Œä½†ä¸åŠ group byå­å¥ï¼‰
        Integer count = jt.queryForObject("select count(*) from t_account where money > ?",Integer.class,1000f);
        System.out.println(count);
```

ç»“æœï¼š

![image-20201019210626453](https://gitee.com/Huke-123/PicCloud/raw/master/20201019210626.png)

ä»¥ä¸Šå°±æ˜¯å…³äºJdbc Templateçš„æ‰€æœ‰å¢åˆ æ”¹æŸ¥æ“ä½œã€‚

## å°ç»“ï¼š

è¿™èŠ‚æˆ‘ä»¬å­¦ä¹ äº†Springä¸­çš„æ•°æ®åº“ç¼–ç¨‹ï¼Œå¸¸è§çš„é…ç½®æ•°æ®åº“èµ„æºä»¥åŠJdbc Templateçš„è¿ç”¨ã€‚

