> æ–‡ç« å¯ä»¥ç™½å«–ï¼Œè€é“ä»¬é¡ºä¾¿å…³æ³¨ä¸€ä¸‹æˆ‘çš„å…¬ä¼—å·ï¼Œæ‰‹åŠ¨æ»‘ç¨½ğŸ¤£ğŸ¤£ &nbsp;
>
> æ¬¢è¿å¤§å®¶å…³æ³¨ï¼š**æ­¦å“¥èŠç¼–ç¨‹**ã€**Javaå¼€å‘å®å…¸**ã€**Javaç§ƒå¤´å“¥**ï¼Œæ‚¨çš„æ”¯æŒï¼Œæ˜¯æˆ‘åˆ›ä½œçš„æŒç»­åŠ¨åŠ›ï¼&nbsp;&nbsp;

![æ­¦å“¥èŠç¼–ç¨‹](https://img-blog.csdnimg.cn/202002150421550.jpg)![Javaå¼€å‘å®å…¸](https://img-blog.csdnimg.cn/20200608005630228.png)![Javaç§ƒå¤´å“¥](https://img-blog.csdnimg.cn/20201025170941235.png)

----

æˆ‘ä»¬å·²ç»ä»‹ç»äº† `é•œåƒçš„ç³»åˆ—æ“ä½œ` ä»¥åŠ `é•œåƒå°±æ˜¯å®¹å™¨é‡Œè·‘çš„æœ€ç»ˆç¨‹åº` ï¼Œé‚£è¿™ä¹ˆå¤šçš„é•œåƒå­˜æ”¾åœ¨å“ªé‡Œå‘¢ï¼Œè¿™å°±æ˜¯ä»Šå¤©æˆ‘ä»¬è¦ä»‹ç»çš„`é•œåƒä»“åº“` ã€‚è®©æˆ‘ä»¬ä¸€èµ· `æ­å¼€é•œåƒä»“åº“çš„ç¥ç§˜é¢çº±` å§ã€‚

## Dockeré•œåƒä»“åº“

ä»“åº“ï¼ˆRepositoryï¼‰æ˜¯é›†ä¸­å­˜æ”¾é•œåƒçš„åœ°æ–¹ï¼Œå›½å†…ä¹Ÿæœ‰å¾ˆå¤š, ä¾‹å¦‚ç½‘æ˜“, DaoCloud, é˜¿é‡Œäº‘ç­‰, ä¸Šä¼ é•œåƒå’Œæ‹‰å–é•œåƒçš„å§¿åŠ¿åŸºæœ¬ä¸€æ ·ã€‚

- ç™»å½•æ“ä½œ

```shelll
# xxx:ç”¨æˆ·å  yyyy:é•œåƒä¸­å¿ƒåœ°å€ï¼ˆå¯ä¸ºipï¼‰
[root@tudou tudou]# docker login --username=xxx yyyyy
```

- ç™»å½•ä¹‹åå°±æ˜¯æ­£å¸¸çš„é•œåƒæ“ä½œ


- ç™»å‡º 

```shelll
# é€€å‡ºå½“å‰ç™»å½•çš„é•œåƒä¸­å¿ƒ
[root@tudou tudou]# docker logout
```
## ç§æœ‰ä»“åº“

> å‡ºäºå®‰å…¨å’Œé€Ÿåº¦çš„è€ƒè™‘, å¾ˆå¤šä¼ä¸šä¼šé€‰æ‹©æ­å»ºç§æœ‰é•œåƒä»“åº“

### æ­å»ºç§æœ‰ä»“åº“

è¿™é‡Œé‡‡ç”¨çš„æ˜¯ `harbor` ,**å®˜æ–¹çš„å®šä¹‰**æ˜¯ä¼ä¸šçº§ç§æœ‰RegistryæœåŠ¡å™¨, å®é™…å†…éƒ¨ä¹Ÿæ˜¯ä¾é docker registryã€‚

> ä¼˜åŠ¿

- æä¾›è‰¯å¥½çš„Webç•Œé¢
- æä¾›è‰¯å¥½çš„å®‰å…¨æœºåˆ¶, åŒ…æ‹¬è§’è‰², æƒé™æ§åˆ¶, æ—¥å¿—ç­‰
- æ”¯æŒæ°´å¹³æ‰©å±•
- ä¼ è¾“ä¼˜åŒ–, å› ä¸ºé•œåƒçš„åˆ†å±‚æœºåˆ¶, æ‰€ä»¥æ¯æ¬¡ä¼ è¾“å¹¶éå…¨é‡, ä»è€Œæå‡é€Ÿåº¦ã€‚

1. ç¯å¢ƒä¾èµ–

**åœ¨å®‰è£…harborä¹‹å‰, éœ€è¦dockerç¯å¢ƒ, é™¤æ­¤è¿˜éœ€è¦docker-composeã€‚**

> dockerå·²ä»‹ç»ï¼Œè¿™é‡Œå°±ç•¥è¿‡ã€‚

> å®‰è£…docker-compose

```shell
# è·å–docker-compose
[root@tudou tudou]# curl -L https://github.com/docker/compose/releases/download/1.8.0/run.sh > /usr/local/bin/docker-compose
# æˆå¯æ‰§è¡Œæƒé™
[root@tudou tudou]# chmod +x /usr/local/bin/docker-compose
# æ£€æµ‹å®‰è£…ç»“æœ
[root@tudou tudou]# docker-compose --version
docker-compose version 1.8.0, build f3628c7
# å®‰è£…æˆåŠŸ
```

2. å®‰è£…harbor

- online: åœ¨çº¿æ–¹å¼ä¼šä¸‹è½½ä¸€ä¸ªå¾ˆå°çš„taråŒ…, é‡Œé¢åªæœ‰docker-compose.ymlå’Œå¯åŠ¨è„šæœ¬, ä¼šåœ¨å¯åŠ¨å®‰è£…æ—¶åœ¨çº¿æ‹‰å–é•œåƒã€‚
- offline: ä¸‹è½½ä¸€ä¸ªå¤§æ¦‚500å¤šMçš„taråŒ…, é‡Œé¢åŒ…æ‹¬äº†é•œåƒæ–‡ä»¶, æ‰€ä»¥å®‰è£…æ—¶ä¼šå¿«ã€‚
- è¿™é‡Œé‡‡ç”¨online

> è·å–å®‰è£…åŒ…

```shell
[root@tudou tudou]# mkdir -p harbor
[root@tudou tudou]# cd harbor
[root@tudou harbor]# wget https://github.com/vmware/harbor/releases/download/v1.1.2/harbor-online-installer-v1.1.2.tgz
# æŸ¥çœ‹ç»“æœ
[root@tudou harbor]# ls
harbor-online-installer-v1.1.2.tgz
```
> è§£å‹ç¨‹åºåŒ…

```shell
[root@tudou harbor]# tar -zxf harbor-online-installer-v1.1.2.tgz 
# æŸ¥çœ‹è§£å‹ç»“æœ è‹¥æ²¡æœ‰treeå‘½ä»¤ å¯å®‰è£…ä¹Ÿå¯ç”¨ll
[root@tudou harbor]# tree harbor
harbor
â”œâ”€â”€ common
â”‚Â Â  â”œâ”€â”€ config
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ adminserver
â”‚Â Â  â”‚Â Â  â”‚Â Â  â””â”€â”€ env
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ db
â”‚Â Â  â”‚Â Â  â”‚Â Â  â””â”€â”€ env
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ jobservice
â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ app.conf
â”‚Â Â  â”‚Â Â  â”‚Â Â  â””â”€â”€ env
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ nginx
â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ conf.d
â”‚Â Â  â”‚Â Â  â”‚Â Â  â””â”€â”€ nginx.conf
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ registry
â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ config.yml
â”‚Â Â  â”‚Â Â  â”‚Â Â  â””â”€â”€ root.crt
â”‚Â Â  â”‚Â Â  â””â”€â”€ ui
â”‚Â Â  â”‚Â Â      â”œâ”€â”€ app.conf
â”‚Â Â  â”‚Â Â      â”œâ”€â”€ env
â”‚Â Â  â”‚Â Â      â””â”€â”€ private_key.pem
â”‚Â Â  â””â”€â”€ templates
â”‚Â Â      â”œâ”€â”€ adminserver
â”‚Â Â      â”‚Â Â  â””â”€â”€ env
â”‚Â Â      â”œâ”€â”€ db
â”‚Â Â      â”‚Â Â  â””â”€â”€ env
â”‚Â Â      â”œâ”€â”€ jobservice
â”‚Â Â      â”‚Â Â  â”œâ”€â”€ app.conf
â”‚Â Â      â”‚Â Â  â””â”€â”€ env
â”‚Â Â      â”œâ”€â”€ nginx
â”‚Â Â      â”‚Â Â  â”œâ”€â”€ nginx.http.conf
â”‚Â Â      â”‚Â Â  â”œâ”€â”€ nginx.https.conf
â”‚Â Â      â”‚Â Â  â”œâ”€â”€ notary.server.conf
â”‚Â Â      â”‚Â Â  â””â”€â”€ notary.upstream.conf
â”‚Â Â      â”œâ”€â”€ notary
â”‚Â Â      â”‚Â Â  â”œâ”€â”€ mysql-initdb.d
â”‚Â Â      â”‚Â Â  â”‚Â Â  â”œâ”€â”€ initial-notaryserver.sql
â”‚Â Â      â”‚Â Â  â”‚Â Â  â””â”€â”€ initial-notarysigner.sql
â”‚Â Â      â”‚Â Â  â”œâ”€â”€ notary-signer-ca.crt
â”‚Â Â      â”‚Â Â  â”œâ”€â”€ notary-signer.crt
â”‚Â Â      â”‚Â Â  â”œâ”€â”€ notary-signer.key
â”‚Â Â      â”‚Â Â  â”œâ”€â”€ server-config.json
â”‚Â Â      â”‚Â Â  â”œâ”€â”€ signer-config.json
â”‚Â Â      â”‚Â Â  â””â”€â”€ signer_env
â”‚Â Â      â”œâ”€â”€ registry
â”‚Â Â      â”‚Â Â  â”œâ”€â”€ config.yml
â”‚Â Â      â”‚Â Â  â””â”€â”€ root.crt
â”‚Â Â      â””â”€â”€ ui
â”‚Â Â          â”œâ”€â”€ app.conf
â”‚Â Â          â”œâ”€â”€ env
â”‚Â Â          â””â”€â”€ private_key.pem
â”œâ”€â”€ docker-compose.notary.yml
â”œâ”€â”€ docker-compose.yml
â”œâ”€â”€ harbor_1_1_0_template
â”œâ”€â”€ harbor.cfg
â”œâ”€â”€ install.sh
â”œâ”€â”€ LICENSE
â”œâ”€â”€ NOTICE
â”œâ”€â”€ prepare
â””â”€â”€ upgrade

18 directories, 40 files
[root@tudou harbor]#
```
> ä¿®æ”¹é…ç½®

```
# æŸ¥çœ‹é…ç½®
[root@tudou harbor]# ll
total 396
drwxr-xr-x 4 root root   4096 Sep 19 16:14 common
-rw-r--r-- 1 root root   1988 Jun 12  2017 docker-compose.notary.yml
-rw-r--r-- 1 root root   3157 Sep 19 16:12 docker-compose.yml
-rw-r--r-- 1 root root   4304 Jun 12  2017 harbor_1_1_0_template
-rw-r--r-- 1 root root   4086 Sep 19 16:14 harbor.cfg
-rwxr-xr-x 1 root root   5169 Sep 19 16:28 install.sh
-rw-r--r-- 1 root root 337600 Jun 12  2017 LICENSE
-rw-r--r-- 1 root root    472 Jun 12  2017 NOTICE
-rwxr-xr-x 1 root root  16522 Jun 12  2017 prepare
-rwxr-xr-x 1 root root   4550 Jun 12  2017 upgrade

# ä¿®æ”¹é…ç½®harbor.cfg 
# å¯ä¿®æ”¹é•œåƒä¸­å¿ƒç™»å½•é»˜è®¤å¯†ç 
# é•œåƒä¸­å¿ƒç™»å½•ip/åŸŸå
[root@tudou harbor]# vi harbor.cfg
# æ³¨é‡Šä¸­ä¹Ÿè¯´äº†, ä¸è¦è®¾ç½®æˆlocalhostå’Œ127.0.0.1
# x.x.x.x åˆ‡è®°çœŸå®ipæˆ–è€…åŸŸå
# è‹¥ä¿®æ”¹ç™»å½•ç«¯å£å·ï¼Œæœ€å¥½å¸¦ä¸Šç«¯å£å·
# è¿™é‡Œæˆ‘ä¿®æ”¹æˆäº†8080
hostname = x.x.x.x:8080

# é•œåƒä¸­å¿ƒæ•°æ®rootç”¨æˆ·å¯†ç 
db_password = Harbor123456

# é‚®ç®±ç›¸å…³çš„è®¾ç½®
email_server = smtp.163.com
email_server_port = 25
email_username = coderthank@163.com
email_password = ******
email_from = thank <coderthank@163.com>

# adminé»˜è®¤çš„ç™»å½•å¯†ç 
harbor_admin_password = Harbor12345

# ä¿®æ”¹å¯¹å¤–è®¿é—®ç«¯å£ ( docker-compose.yml)
# æ‰¾åˆ°å¦‚ä¸‹é…ç½®åœ°æ–¹
# ä¿®æ”¹ 80:80  è¿™é‡Œä¿®æ”¹ä¸º8080 å³ä¿®æ”¹ä¸ºï¼ˆ 8080:80ï¼‰
[root@tudou harbor]# vi docker-compose.yml
jobservice:
    image: vmware/harbor-jobservice:v1.1.2
    container_name: harbor-jobservice
    env_file:
      - ./common/config/jobservice/env
    restart: always
    volumes:
      - /data/job_logs:/var/log/jobs:z
      - ./common/config/jobservice/app.conf:/etc/jobservice/app.conf:z
      - /data/secretkey:/etc/jobservice/key:z
    networks:
      - harbor
    depends_on:
      - ui
      - adminserver
    logging:
      driver: "syslog"
      options:  
        syslog-address: "tcp://127.0.0.1:1514"
        tag: "jobservice"
  proxy:
    image: vmware/nginx:1.11.5-patched
    container_name: nginx
    restart: always
    volumes:
      - ./common/config/nginx:/etc/nginx:z
    networks:
      - harbor
    ports:
      - 8080:80
      - 443:443
      - 4443:4443
      
```
> å®‰è£…

```shell
# æ‰§è¡Œinstallè„šæœ¬
[root@tudou harbor]# ./install.sh
[Step 0]: checking installation environment ...

Note: docker version: 1.13.1

Note: docker-compose version: 1.16.1

[Step 1]: loading Harbor images ...
...ç•¥

[Step 2]: preparing environment ...
...ç•¥

[Step 3]: checking existing instance of Harbor ...


[Step 4]: starting Harbor ...
...ç•¥

----Harbor has been installed and started successfully.----

âœ” ----Harbor has been installed and started successfully.----

Now you should be able to visit the admin portal at http://x.x.x.x:8080. 
For more details, please visit https://github.com/vmware/harbor .

```

> æŸ¥çœ‹harboré•œåƒä»¥åŠå®¹å™¨

```shell
# æŸ¥çœ‹harboré•œåƒ
[root@tudou harbor]# docker images --format "table {{.Repository}}\t{{.Size}}" | grep harbor
vmware/harbor-jobservice             163MB
vmware/harbor-ui                     183MB
vmware/harbor-adminserver            142MB
vmware/harbor-db                     329MB
vmware/harbor-log                    192MB

# æŸ¥çœ‹harboré•œåƒ
[root@tudou harbor]# docker ps -a | grep harbor
5a288cc7ccf8        vmware/harbor-jobservice:v1.1.2     "/harbor/harbor_jobsâ€¦"   7 days ago          Up 7 days   harbor-jobservice
e68f690dffcb        vmware/harbor-ui:v1.1.2              "/harbor/harbor_ui"      7 days ago          Up 7 days    harbor-ui
598057aa5047        vmware/harbor-adminserver:v1.1.2     "/harbor/harbor_admiâ€¦"   7 days ago          Up 7 days   harbor-adminserver
0f478d74e2bd        vmware/harbor-db:v1.1.2              "docker-entrypoint.sâ€¦"   7 days ago          Up 7 days    harbor-db            3306/tcp
a8cb36a3b42b        vmware/harbor-log:v1.1.2             "/bin/sh -c 'crond &â€¦"   7 days ago          Up 7 days   harbor-log            127.0.0.1:1514->514/tcp 
[root@tudou harbor]# 
```

> è®¿é—®harbor 

- æµè§ˆå™¨è¾“å…¥ï¼šhttp://x.x.x.x:8080

![image](http://note.youdao.com/yws/public/resource/86feadd8e5ad608ae81a32c1ddc4fc0b/xmlnote/76533D500D3E4859B8B33F12447E1B14/11421)

- è¾“å…¥ç”¨æˆ·å/å¯†ç ï¼ˆadmin/Harbor12345ï¼‰

![image](http://note.youdao.com/yws/public/resource/86feadd8e5ad608ae81a32c1ddc4fc0b/xmlnote/328BCD0EB64143C5B4D814BBF18CAFC7/11419)

**åˆ°æ­¤ï¼Œç§æœ‰é•œåƒä¸­å¿ƒçš„æ­å»ºå·²ç»å®Œæ¯•ï¼ï¼ï¼**

### ç§æœ‰ä»“åº“çš„ä½¿ç”¨

1. åˆ›å»ºä¸€ä¸ªé¡¹ç›®

> é€šè¿‡harborçš„webç•Œé¢åˆ›å»ºä¸€ä¸ªç§æœ‰é¡¹ç›®ï¼ˆå…¬å¼€é¡¹ç›®ä¹Ÿç±»ä¼¼ï¼‰ `tudou`

![image](http://note.youdao.com/yws/public/resource/86feadd8e5ad608ae81a32c1ddc4fc0b/xmlnote/D7A907A4F54A4F8A90AAC5B32F1C11D2/11437)

> ç™»å½•é•œåƒä¸­å¿ƒ

```shell
[root@tudou harbor]# docker login x.x.x.x:8080 -u admin -p Harbor12345
WARNING! Using --password via the CLI is insecure. Use --password-stdin.
WARNING! Your password will be stored unencrypted in /root/.docker/config.json.
Configure a credential helper to remove this warning. See
https://docs.docker.com/engine/reference/commandline/login/#credentials-store

Login Succeeded
[root@tudou harbor]#
```
> ç»™é•œåƒè‡ªå®šä¹‰tag

```shell
# æŸ¥æ‰¾æœ¬åœ°tomcat
[root@tudou harbor]# docker images | grep tomcat
tomcat   8.0   ef6a7c98d192  2 years ago   356MB
[root@tudou harbor]# 

# ç»™tomcatæ‰“ä¸Študouçš„æ ‡ç­¾
[root@tudou harbor]# 
[root@tudou harbor]# docker tag tomcat:8.0 x.x.x.x:8080/tudou/tomcat:tudou
# æŸ¥çœ‹ç»“æœ ä¸¤ä¸ªtagçš„tocmatè¿›è¡Œéƒ½å­˜åœ¨
[root@tudou harbor]# docker images | grep tomcat
tomcat                            8.0    ef6a7c98d192    2 years ago     356MB
x.x.x.x:8080/tudou/tomcat:tudou   tudou  ef6a7c98d192    2 years ago         356MB
```
**ä½ ä¼šå‘ç°ä¸¤ä¸ªtagçš„é•œåƒidä»¥åŠå¤§å°ä¸€ç›´ï¼Œè¿™å°±æ˜¯dockeré•œåƒçš„å¥½å¤„ï¼Œç›¸åŒå±‚åªæœ‰ä¸€ä»½**

> æ¨é€åˆ°ç§æœ‰ä»“åº“çš„tudoué¡¹ç›®ä¸‹

```shell
[root@tudou harbor]# docker push x.x.x.x:8080/tudou/tomcat:tudou
The push refers to repository [x.x.x.x:8080/tudou/tomcat]
d0f3f4011f28: Pushed 
583dc95d65c9: Pushed 
f26731984f9b: Pushed 
9f052711b40a: Pushed 
81242e1e644e: Pushed 
39a6e47c4ae6: Pushed 
fc6174f0df4a: Pushed 
425325c72d90: Pushed 
c596d5191368: Pushed 
daf45b2cad9a: Pushed 
8c466bf4ca6f: Pushed 
tudou: digest: sha256:47274bc304687e21217ca6a33e3244c43c6d5cfaceade76c4b478023f2aca3b2 size: 2625
[root@tudou harbor]# 
```

> æŸ¥çœ‹ç»“æœ

- ç§æœ‰é¡¹ç›®tudouï¼Œå‘ç°å·²å­˜åœ¨ä¸€ä¸ªé•œåƒ
![image](http://note.youdao.com/yws/public/resource/86feadd8e5ad608ae81a32c1ddc4fc0b/xmlnote/ED39B03FA9C64834863E321F66E490EF/11481)

- æŸ¥çœ‹é¡¹ç›®è¯¦æƒ…

![image](http://note.youdao.com/yws/public/resource/86feadd8e5ad608ae81a32c1ddc4fc0b/xmlnote/148C2F1A27424D33B846D66C0856F059/11484)

- æŸ¥çœ‹é•œåƒè¯¦æƒ…

![image](http://note.youdao.com/yws/public/resource/86feadd8e5ad608ae81a32c1ddc4fc0b/xmlnote/71F1E463EBD640D0B3071CDAB2329443/11498)

**ç»¼ä¸Šæ‰€è¿°ï¼Œæˆ‘ä»¬ä»‹ç»äº† `é•œåƒä»“åº“`ã€`ç§æœ‰é•œåƒä»“åº“æ­å»º` ä»¥åŠ `é•œåƒä»“åº“æ“ä½œ`ï¼Œå¼€å¯ä½ çš„é•œåƒä»“åº“ä¹‹æ—…å§ï¼ï¼ï¼ï¼**



----



> æ–‡ç« å¯ä»¥ç™½å«–ï¼Œè€é“ä»¬é¡ºä¾¿å…³æ³¨ä¸€ä¸‹æˆ‘çš„å…¬ä¼—å·ï¼Œæ‰‹åŠ¨æ»‘ç¨½ğŸ¤£ğŸ¤£ &nbsp;
>
> æ¬¢è¿å¤§å®¶å…³æ³¨ï¼š**æ­¦å“¥èŠç¼–ç¨‹**ã€**Javaå¼€å‘å®å…¸**ã€**Javaç§ƒå¤´å“¥**ï¼Œæ‚¨çš„æ”¯æŒï¼Œæ˜¯æˆ‘åˆ›ä½œçš„æŒç»­åŠ¨åŠ›ï¼&nbsp;&nbsp;

![æ­¦å“¥èŠç¼–ç¨‹](https://img-blog.csdnimg.cn/202002150421550.jpg)![Javaå¼€å‘å®å…¸](https://img-blog.csdnimg.cn/20200608005630228.png)![Javaç§ƒå¤´å“¥](https://img-blog.csdnimg.cn/20201025170941235.png)





