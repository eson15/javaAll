> æ–‡ç« å¯ä»¥ç™½å«–ï¼Œå…¬ä¼—å·ä¸èƒ½ä¸å…³æ³¨ï¼Œæ‰‹åŠ¨æ»‘ç¨½ğŸ¤£ğŸ¤£ &nbsp;
>
> æ¬¢è¿å¤§å®¶å…³æ³¨ï¼š**æ­¦å“¥èŠç¼–ç¨‹**ã€**Javaå­¦ä¹ æŒ‡å—**ï¼Œæ‚¨çš„æ”¯æŒï¼Œæ˜¯æˆ‘ä»¬åˆ›ä½œçš„æŒç»­åŠ¨åŠ›ï¼&nbsp;&nbsp;

![æ­¦å“¥èŠç¼–ç¨‹](https://img-blog.csdnimg.cn/202002150421550.jpg)![Javaå­¦ä¹ æŒ‡å—](https://img-blog.csdnimg.cn/20200601113720522.png)
----

æ‹¦æˆªå™¨çš„åŸç†å¾ˆç®€å•ï¼Œæ˜¯ AOP çš„ä¸€ç§å®ç°ï¼Œä¸“é—¨æ‹¦æˆªå¯¹åŠ¨æ€èµ„æºçš„åå°è¯·æ±‚ï¼Œå³æ‹¦æˆªå¯¹æ§åˆ¶å±‚çš„è¯·æ±‚ã€‚ä½¿ç”¨åœºæ™¯æ¯”è¾ƒå¤šçš„æ˜¯åˆ¤æ–­ç”¨æˆ·æ˜¯å¦æœ‰æƒé™è¯·æ±‚åå°ï¼Œæ›´æ‹”é«˜ä¸€å±‚çš„ä½¿ç”¨åœºæ™¯ä¹Ÿæœ‰ï¼Œæ¯”å¦‚æ‹¦æˆªå™¨å¯ä»¥ç»“åˆ websocket ä¸€èµ·ä½¿ç”¨ï¼Œç”¨æ¥æ‹¦æˆª websocket è¯·æ±‚ï¼Œç„¶ååšç›¸åº”çš„å¤„ç†ç­‰ç­‰ã€‚æ‹¦æˆªå™¨ä¸ä¼šæ‹¦æˆªé™æ€èµ„æºï¼ŒSpring Boot çš„é»˜è®¤é™æ€ç›®å½•ä¸º resources/staticï¼Œè¯¥ç›®å½•ä¸‹çš„é™æ€é¡µé¢ã€jsã€cssã€å›¾ç‰‡ç­‰ç­‰ï¼Œä¸ä¼šè¢«æ‹¦æˆªï¼ˆä¹Ÿè¦çœ‹å¦‚ä½•å®ç°ï¼Œæœ‰äº›æƒ…å†µä¹Ÿä¼šæ‹¦æˆªï¼Œæˆ‘åœ¨ä¸‹æ–‡ä¼šæŒ‡å‡ºï¼‰ã€‚

## 1. æ‹¦æˆªå™¨çš„å¿«é€Ÿä½¿ç”¨

ä½¿ç”¨æ‹¦æˆªå™¨å¾ˆç®€å•ï¼Œåªéœ€è¦ä¸¤æ­¥å³å¯ï¼šå®šä¹‰æ‹¦æˆªå™¨å’Œé…ç½®æ‹¦æˆªå™¨ã€‚åœ¨é…ç½®æ‹¦æˆªå™¨ä¸­ï¼ŒSpring Boot 2.0 ä»¥åçš„ç‰ˆæœ¬å’Œä¹‹å‰çš„ç‰ˆæœ¬æœ‰æ‰€ä¸åŒï¼Œæˆ‘ä¼šé‡ç‚¹è®²è§£ä¸€ä¸‹è¿™é‡Œå¯èƒ½å‡ºç°çš„å‘ã€‚

### 1.1 å®šä¹‰æ‹¦æˆªå™¨
å®šä¹‰æ‹¦æˆªå™¨ï¼Œåªéœ€è¦å®ç° `HandlerInterceptor` æ¥å£ï¼Œ`HandlerInterceptor` æ¥å£æ˜¯æ‰€æœ‰è‡ªå®šä¹‰æ‹¦æˆªå™¨æˆ–è€… Spring Boot æä¾›çš„æ‹¦æˆªå™¨çš„é¼»ç¥–ï¼Œæ‰€ä»¥ï¼Œé¦–å…ˆæ¥äº†è§£ä¸‹è¯¥æ¥å£ã€‚è¯¥æ¥å£ä¸­æœ‰ä¸‰ä¸ªæ–¹æ³•ï¼š `preHandle(â€¦â€¦)`ã€`postHandle(â€¦â€¦)` å’Œ `afterCompletion(â€¦â€¦)` ã€‚

> `preHandle(â€¦â€¦)` æ–¹æ³•ï¼šè¯¥æ–¹æ³•çš„æ‰§è¡Œæ—¶æœºæ˜¯ï¼Œå½“æŸä¸ª url å·²ç»åŒ¹é…åˆ°å¯¹åº”çš„ Controller ä¸­çš„æŸä¸ªæ–¹æ³•ï¼Œä¸”åœ¨è¿™ä¸ªæ–¹æ³•æ‰§è¡Œä¹‹å‰ã€‚æ‰€ä»¥ `preHandle(â€¦â€¦)` æ–¹æ³•å¯ä»¥å†³å®šæ˜¯å¦å°†è¯·æ±‚æ”¾è¡Œï¼Œè¿™æ˜¯é€šè¿‡è¿”å›å€¼æ¥å†³å®šçš„ï¼Œè¿”å› true åˆ™æ”¾è¡Œï¼Œè¿”å› false åˆ™ä¸ä¼šå‘åæ‰§è¡Œã€‚  
> `postHandle(â€¦â€¦)` æ–¹æ³•ï¼šè¯¥æ–¹æ³•çš„æ‰§è¡Œæ—¶æœºæ˜¯ï¼Œå½“æŸä¸ª url å·²ç»åŒ¹é…åˆ°å¯¹åº”çš„ Controller ä¸­çš„æŸä¸ªæ–¹æ³•ï¼Œä¸”åœ¨æ‰§è¡Œå®Œäº†è¯¥æ–¹æ³•ï¼Œä½†æ˜¯åœ¨ DispatcherServlet è§†å›¾æ¸²æŸ“ä¹‹å‰ã€‚æ‰€ä»¥åœ¨è¿™ä¸ªæ–¹æ³•ä¸­æœ‰ä¸ª ModelAndView å‚æ•°ï¼Œå¯ä»¥åœ¨æ­¤åšä¸€äº›ä¿®æ”¹åŠ¨ä½œã€‚  
> `afterCompletion(â€¦â€¦)` æ–¹æ³•ï¼šé¡¾åæ€ä¹‰ï¼Œè¯¥æ–¹æ³•æ˜¯åœ¨æ•´ä¸ªè¯·æ±‚å¤„ç†å®Œæˆåï¼ˆåŒ…æ‹¬è§†å›¾æ¸²æŸ“ï¼‰æ‰§è¡Œï¼Œè¿™æ—¶åšä¸€äº›èµ„æºçš„æ¸…ç†å·¥ä½œï¼Œè¿™ä¸ªæ–¹æ³•åªæœ‰åœ¨ `preHandle(â€¦â€¦)` è¢«æˆåŠŸæ‰§è¡Œåå¹¶ä¸”è¿”å› true æ‰ä¼šè¢«æ‰§è¡Œã€‚  

äº†è§£äº†è¯¥æ¥å£ï¼Œæ¥ä¸‹æ¥è‡ªå®šä¹‰ä¸€ä¸ªæ‹¦æˆªå™¨ã€‚
```java
/**
 * è‡ªå®šä¹‰æ‹¦æˆªå™¨
 * @author shengwu ni
 * @date 2018/08/03
 */
public class MyInterceptor implements HandlerInterceptor {

    private static final Logger logger = LoggerFactory.getLogger(MyInterceptor.class);

    @Override
    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception {

        HandlerMethod handlerMethod = (HandlerMethod) handler;
        Method method = handlerMethod.getMethod();
        String methodName = method.getName();
        logger.info("====æ‹¦æˆªåˆ°äº†æ–¹æ³•ï¼š{}ï¼Œåœ¨è¯¥æ–¹æ³•æ‰§è¡Œä¹‹å‰æ‰§è¡Œ====", methodName);
        // è¿”å›trueæ‰ä¼šç»§ç»­æ‰§è¡Œï¼Œè¿”å›falseåˆ™å–æ¶ˆå½“å‰è¯·æ±‚
        return true;
    }

    @Override
    public void postHandle(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView) throws Exception {
        logger.info("æ‰§è¡Œå®Œæ–¹æ³•ä¹‹åè¿›æ‰§è¡Œ(Controlleræ–¹æ³•è°ƒç”¨ä¹‹å)ï¼Œä½†æ˜¯æ­¤æ—¶è¿˜æ²¡è¿›è¡Œè§†å›¾æ¸²æŸ“");
    }

    @Override
    public void afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex) throws Exception {
        logger.info("æ•´ä¸ªè¯·æ±‚éƒ½å¤„ç†å®Œå’¯ï¼ŒDispatcherServletä¹Ÿæ¸²æŸ“äº†å¯¹åº”çš„è§†å›¾å’¯ï¼Œæ­¤æ—¶æˆ‘å¯ä»¥åšä¸€äº›æ¸…ç†çš„å·¥ä½œäº†");
    }
}
```
OKï¼Œåˆ°æ­¤ä¸ºæ­¢ï¼Œæ‹¦æˆªå™¨å·²ç»å®šä¹‰å®Œæˆï¼Œæ¥ä¸‹æ¥å°±æ˜¯å¯¹è¯¥æ‹¦æˆªå™¨è¿›è¡Œæ‹¦æˆªé…ç½®ã€‚

### 1.2 é…ç½®æ‹¦æˆªå™¨

åœ¨ Spring Boot 2.0 ä¹‹å‰ï¼Œæˆ‘ä»¬éƒ½æ˜¯ç›´æ¥ç»§æ‰¿ WebMvcConfigurerAdapter ç±»ï¼Œç„¶åé‡å†™ `addInterceptors` æ–¹æ³•æ¥å®ç°æ‹¦æˆªå™¨çš„é…ç½®ã€‚ä½†æ˜¯åœ¨ Spring Boot 2.0 ä¹‹åï¼Œè¯¥æ–¹æ³•å·²ç»è¢«åºŸå¼ƒäº†ï¼ˆå½“ç„¶ï¼Œä¹Ÿå¯ä»¥ç»§ç»­ç”¨ï¼‰ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯ WebMvcConfigurationSupport æ–¹æ³•ï¼Œå¦‚ä¸‹ï¼š

```java
@Configuration
public class MyInterceptorConfig extends WebMvcConfigurationSupport {

    @Override
    protected void addInterceptors(InterceptorRegistry registry) {
        registry.addInterceptor(new MyInterceptor()).addPathPatterns("/**");
        super.addInterceptors(registry);
    }
}
```
åœ¨è¯¥é…ç½®ä¸­é‡å†™ `addInterceptors` æ–¹æ³•ï¼Œå°†æˆ‘ä»¬ä¸Šé¢è‡ªå®šä¹‰çš„æ‹¦æˆªå™¨æ·»åŠ è¿›å»ï¼Œ`addPathPatterns` æ–¹æ³•æ˜¯æ·»åŠ è¦æ‹¦æˆªçš„è¯·æ±‚ï¼Œè¿™é‡Œæˆ‘ä»¬æ‹¦æˆªæ‰€æœ‰çš„è¯·æ±‚ã€‚è¿™æ ·å°±é…ç½®å¥½æ‹¦æˆªå™¨äº†ï¼Œæ¥ä¸‹æ¥å†™ä¸€ä¸ª Controller æµ‹è¯•ä¸€ä¸‹ï¼š
```java
@Controller
@RequestMapping("/interceptor")
public class InterceptorController {

    @RequestMapping("/test")
    public String test() {
        return "hello";
    }
}
```
è®©å…¶è·³è½¬åˆ° hello.html é¡µé¢ï¼Œç›´æ¥åœ¨ hello.html ä¸­è¾“å‡º `hello interceptor` å³å¯ã€‚å¯åŠ¨é¡¹ç›®ï¼Œåœ¨æµè§ˆå™¨ä¸­è¾“å…¥ `localhost:8080/interceptor/test` çœ‹ä¸€ä¸‹æ§åˆ¶å°çš„æ—¥å¿—ï¼š
```
====æ‹¦æˆªåˆ°äº†æ–¹æ³•ï¼štestï¼Œåœ¨è¯¥æ–¹æ³•æ‰§è¡Œä¹‹å‰æ‰§è¡Œ====  
æ‰§è¡Œå®Œæ–¹æ³•ä¹‹åè¿›æ‰§è¡Œ(Controlleræ–¹æ³•è°ƒç”¨ä¹‹å)ï¼Œä½†æ˜¯æ­¤æ—¶è¿˜æ²¡è¿›è¡Œè§†å›¾æ¸²æŸ“  
æ•´ä¸ªè¯·æ±‚éƒ½å¤„ç†å®Œå’¯ï¼ŒDispatcherServletä¹Ÿæ¸²æŸ“äº†å¯¹åº”çš„è§†å›¾å’¯ï¼Œæ­¤æ—¶æˆ‘å¯ä»¥åšä¸€äº›æ¸…ç†çš„å·¥ä½œäº†
```
å¯ä»¥çœ‹å‡ºæ‹¦æˆªå™¨å·²ç»ç”Ÿæ•ˆï¼Œå¹¶èƒ½çœ‹å‡ºå…¶æ‰§è¡Œé¡ºåºã€‚

### 1.3 è§£å†³é™æ€èµ„æºè¢«æ‹¦æˆªé—®é¢˜

ä¸Šæ–‡ä¸­å·²ç»ä»‹ç»äº†æ‹¦æˆªå™¨çš„å®šä¹‰å’Œé…ç½®ï¼Œä½†æ˜¯è¿™æ ·æ˜¯å¦å°±æ²¡é—®é¢˜äº†å‘¢ï¼Ÿå…¶å®ä¸ç„¶ï¼Œå¦‚æœä½¿ç”¨ä¸Šé¢è¿™ç§é…ç½®çš„è¯ï¼Œæˆ‘ä»¬ä¼šå‘ç°ä¸€ä¸ªç¼ºé™·ï¼Œé‚£å°±æ˜¯é™æ€èµ„æºè¢«æ‹¦æˆªäº†ã€‚å¯ä»¥åœ¨ resources/static/ ç›®å½•ä¸‹æ”¾ç½®ä¸€ä¸ªå›¾ç‰‡èµ„æºæˆ–è€… html æ–‡ä»¶ï¼Œç„¶åå¯åŠ¨é¡¹ç›®ç›´æ¥è®¿é—®ï¼Œå³å¯çœ‹åˆ°æ— æ³•è®¿é—®çš„ç°è±¡ã€‚

ä¹Ÿå°±æ˜¯è¯´ï¼Œè™½ç„¶ Spring Boot 2.0 åºŸå¼ƒäº†WebMvcConfigurerAdapterï¼Œä½†æ˜¯ WebMvcConfigurationSupport åˆä¼šå¯¼è‡´é»˜è®¤çš„é™æ€èµ„æºè¢«æ‹¦æˆªï¼Œè¿™å°±éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨å°†é™æ€èµ„æºæ”¾å¼€ã€‚

å¦‚ä½•æ”¾å¼€å‘¢ï¼Ÿé™¤äº†åœ¨ MyInterceptorConfig é…ç½®ç±»ä¸­é‡å†™ `addInterceptors` æ–¹æ³•å¤–ï¼Œè¿˜éœ€è¦å†é‡å†™ä¸€ä¸ªæ–¹æ³•ï¼š`addResourceHandlers`ï¼Œå°†é™æ€èµ„æºæ”¾å¼€ï¼š
```java
/**
 * ç”¨æ¥æŒ‡å®šé™æ€èµ„æºä¸è¢«æ‹¦æˆªï¼Œå¦åˆ™ç»§æ‰¿WebMvcConfigurationSupportè¿™ç§æ–¹å¼ä¼šå¯¼è‡´é™æ€èµ„æºæ— æ³•ç›´æ¥è®¿é—®
 * @param registry
 */
@Override
protected void addResourceHandlers(ResourceHandlerRegistry registry) {
    registry.addResourceHandler("/**").addResourceLocations("classpath:/static/");
    super.addResourceHandlers(registry);
}
```
è¿™æ ·é…ç½®å¥½ä¹‹åï¼Œé‡å¯é¡¹ç›®ï¼Œé™æ€èµ„æºä¹Ÿå¯ä»¥æ­£å¸¸è®¿é—®äº†ã€‚å¦‚æœä½ æ˜¯ä¸ªå–„äºå­¦ä¹ æˆ–è€…ç ”ç©¶çš„äººï¼Œé‚£è‚¯å®šä¸ä¼šæ­¢æ­¥äºæ­¤ï¼Œæ²¡é”™ï¼Œä¸Šé¢è¿™ç§æ–¹å¼çš„ç¡®èƒ½è§£å†³é™æ€èµ„æºæ— æ³•è®¿é—®çš„é—®é¢˜ï¼Œä½†æ˜¯ï¼Œè¿˜æœ‰æ›´æ–¹ä¾¿çš„æ–¹å¼æ¥é…ç½®ã€‚

æˆ‘ä»¬ä¸ç»§æ‰¿ WebMvcConfigurationSupport ç±»ï¼Œç›´æ¥å®ç° WebMvcConfigurer æ¥å£ï¼Œç„¶åé‡å†™ `addInterceptors` æ–¹æ³•ï¼Œå°†è‡ªå®šä¹‰çš„æ‹¦æˆªå™¨æ·»åŠ è¿›å»å³å¯ï¼Œå¦‚ä¸‹ï¼š
```java
@Configuration
public class MyInterceptorConfig implements WebMvcConfigurer {
    @Override
    public void addInterceptors(InterceptorRegistry registry) {
        // å®ç°WebMvcConfigurerä¸ä¼šå¯¼è‡´é™æ€èµ„æºè¢«æ‹¦æˆª
        registry.addInterceptor(new MyInterceptor()).addPathPatterns("/**");
    }
}
```
è¿™æ ·å°±éå¸¸æ–¹ä¾¿äº†ï¼Œå®ç° WebMvcConfigure æ¥å£çš„è¯ï¼Œä¸ä¼šæ‹¦æˆª Spring Boot é»˜è®¤çš„é™æ€èµ„æºã€‚

è¿™ä¸¤ç§æ–¹å¼éƒ½å¯ä»¥ï¼Œå…·ä½“ä»–ä»¬ä¹‹é—´çš„ç»†èŠ‚ï¼Œæ„Ÿå…´è¶£çš„è¯»è€…å¯ä»¥åšè¿›ä¸€æ­¥çš„ç ”ç©¶ï¼Œç”±äºè¿™ä¸¤ç§æ–¹å¼çš„ä¸åŒï¼Œç»§æ‰¿ WebMvcConfigurationSupport ç±»çš„æ–¹å¼å¯ä»¥ç”¨åœ¨å‰åç«¯åˆ†ç¦»çš„é¡¹ç›®ä¸­ï¼Œåå°ä¸éœ€è¦è®¿é—®é™æ€èµ„æºï¼ˆå°±ä¸éœ€è¦æ”¾å¼€é™æ€èµ„æºäº†ï¼‰ï¼›å®ç° WebMvcConfigure æ¥å£çš„æ–¹å¼å¯ä»¥ç”¨åœ¨éå‰åç«¯åˆ†ç¦»çš„é¡¹ç›®ä¸­ï¼Œå› ä¸ºéœ€è¦è¯»å–ä¸€äº›å›¾ç‰‡ã€cssã€jsæ–‡ä»¶ç­‰ç­‰ã€‚

## 2. æ‹¦æˆªå™¨ä½¿ç”¨å®ä¾‹

### 2.1 åˆ¤æ–­ç”¨æˆ·æœ‰æ²¡æœ‰ç™»å½•

ä¸€èˆ¬ç”¨æˆ·ç™»å½•åŠŸèƒ½æˆ‘ä»¬å¯ä»¥è¿™ä¹ˆåšï¼Œè¦ä¹ˆå¾€ session ä¸­å†™ä¸€ä¸ª userï¼Œè¦ä¹ˆé’ˆå¯¹æ¯ä¸ª user ç”Ÿæˆä¸€ä¸ª tokenï¼Œç¬¬äºŒç§è¦æ›´å¥½ä¸€ç‚¹ï¼Œé‚£ä¹ˆé’ˆå¯¹ç¬¬äºŒç§æ–¹å¼ï¼Œå¦‚æœç”¨æˆ·ç™»å½•æˆåŠŸäº†ï¼Œæ¯æ¬¡è¯·æ±‚çš„æ—¶å€™éƒ½ä¼šå¸¦ä¸Šè¯¥ç”¨æˆ·çš„ tokenï¼Œå¦‚æœæœªç™»å½•ï¼Œåˆ™æ²¡æœ‰è¯¥ tokenï¼ŒæœåŠ¡ç«¯å¯ä»¥æ£€æµ‹è¿™ä¸ª token å‚æ•°çš„æœ‰æ— æ¥åˆ¤æ–­ç”¨æˆ·æœ‰æ²¡æœ‰ç™»å½•ï¼Œä»è€Œå®ç°æ‹¦æˆªåŠŸèƒ½ã€‚æˆ‘ä»¬æ”¹é€ ä¸€ä¸‹ `preHandle` æ–¹æ³•ï¼Œå¦‚ä¸‹ï¼š
```java
@Override
public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception {

    HandlerMethod handlerMethod = (HandlerMethod) handler;
    Method method = handlerMethod.getMethod();
    String methodName = method.getName();
    logger.info("====æ‹¦æˆªåˆ°äº†æ–¹æ³•ï¼š{}ï¼Œåœ¨è¯¥æ–¹æ³•æ‰§è¡Œä¹‹å‰æ‰§è¡Œ====", methodName);

    // åˆ¤æ–­ç”¨æˆ·æœ‰æ²¡æœ‰ç™»é™†ï¼Œä¸€èˆ¬ç™»é™†ä¹‹åçš„ç”¨æˆ·éƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„token
    String token = request.getParameter("token");
    if (null == token || "".equals(token)) {
        logger.info("ç”¨æˆ·æœªç™»å½•ï¼Œæ²¡æœ‰æƒé™æ‰§è¡Œâ€¦â€¦è¯·ç™»å½•");
        return false;
    }

    // è¿”å›trueæ‰ä¼šç»§ç»­æ‰§è¡Œï¼Œè¿”å›falseåˆ™å–æ¶ˆå½“å‰è¯·æ±‚
    return true;
}
```
é‡å¯é¡¹ç›®ï¼Œåœ¨æµè§ˆå™¨ä¸­è¾“å…¥ `localhost:8080/interceptor/test` åæŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—ï¼Œå‘ç°è¢«æ‹¦æˆªï¼Œå¦‚æœåœ¨æµè§ˆå™¨ä¸­è¾“å…¥ `localhost:8080/interceptor/test?token=123` å³å¯æ­£å¸¸å¾€ä¸‹èµ°ã€‚

### 2.2 å–æ¶ˆæ‹¦æˆªæ“ä½œ
æ ¹æ®ä¸Šæ–‡ï¼Œå¦‚æœæˆ‘è¦æ‹¦æˆªæ‰€æœ‰ `/admin` å¼€å¤´çš„ url è¯·æ±‚çš„è¯ï¼Œéœ€è¦åœ¨æ‹¦æˆªå™¨é…ç½®ä¸­æ·»åŠ è¿™ä¸ªå‰ç¼€ï¼Œä½†æ˜¯åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œå¯èƒ½ä¼šæœ‰è¿™ç§åœºæ™¯å‡ºç°ï¼šæŸä¸ªè¯·æ±‚ä¹Ÿæ˜¯ `/admin` å¼€å¤´çš„ï¼Œä½†æ˜¯ä¸èƒ½æ‹¦æˆªï¼Œæ¯”å¦‚ `/admin/login` ç­‰ç­‰ï¼Œè¿™æ ·çš„è¯åˆéœ€è¦å»é…ç½®ã€‚é‚£ä¹ˆï¼Œå¯ä¸å¯ä»¥åšæˆä¸€ä¸ªç±»ä¼¼äºå¼€å…³çš„ä¸œè¥¿ï¼Œå“ªé‡Œä¸éœ€è¦æ‹¦æˆªï¼Œæˆ‘å°±åœ¨å“ªé‡Œå¼„ä¸ªå¼€å…³ä¸Šå»ï¼Œåšæˆè¿™ç§çµæ´»çš„å¯æ’æ‹”çš„æ•ˆæœå‘¢ï¼Ÿ

æ˜¯å¯ä»¥çš„ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ªæ³¨è§£ï¼Œè¯¥æ³¨è§£ä¸“é—¨ç”¨æ¥å–æ¶ˆæ‹¦æˆªæ“ä½œï¼Œå¦‚æœæŸä¸ª Controller ä¸­çš„æ–¹æ³•æˆ‘ä»¬ä¸éœ€è¦æ‹¦æˆªæ‰ï¼Œå³å¯åœ¨è¯¥æ–¹æ³•ä¸ŠåŠ ä¸Šæˆ‘ä»¬è‡ªå®šä¹‰çš„æ³¨è§£å³å¯ï¼Œä¸‹é¢å…ˆå®šä¹‰ä¸€ä¸ªæ³¨è§£ï¼š

```java
/**
 * è¯¥æ³¨è§£ç”¨æ¥æŒ‡å®šæŸä¸ªæ–¹æ³•ä¸ç”¨æ‹¦æˆª
 */
@Target(ElementType.METHOD)
@Retention(RetentionPolicy.RUNTIME)
public @interface UnInterception {
}
```
ç„¶ååœ¨ Controller ä¸­çš„æŸä¸ªæ–¹æ³•ä¸Šæ·»åŠ è¯¥æ³¨è§£ï¼Œåœ¨æ‹¦æˆªå™¨å¤„ç†æ–¹æ³•ä¸­æ·»åŠ è¯¥æ³¨è§£å–æ¶ˆæ‹¦æˆªçš„é€»è¾‘ï¼Œå¦‚ä¸‹ï¼š
```java
@Override
public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception {

    HandlerMethod handlerMethod = (HandlerMethod) handler;
    Method method = handlerMethod.getMethod();
    String methodName = method.getName();
    logger.info("====æ‹¦æˆªåˆ°äº†æ–¹æ³•ï¼š{}ï¼Œåœ¨è¯¥æ–¹æ³•æ‰§è¡Œä¹‹å‰æ‰§è¡Œ====", methodName);

    // é€šè¿‡æ–¹æ³•ï¼Œå¯ä»¥è·å–è¯¥æ–¹æ³•ä¸Šçš„è‡ªå®šä¹‰æ³¨è§£ï¼Œç„¶åé€šè¿‡æ³¨è§£æ¥åˆ¤æ–­è¯¥æ–¹æ³•æ˜¯å¦è¦è¢«æ‹¦æˆª
    // @UnInterception æ˜¯æˆ‘ä»¬è‡ªå®šä¹‰çš„æ³¨è§£
    UnInterception unInterception = method.getAnnotation(UnInterception.class);
    if (null != unInterception) {
        return true;
    }
    // è¿”å›trueæ‰ä¼šç»§ç»­æ‰§è¡Œï¼Œè¿”å›falseåˆ™å–æ¶ˆå½“å‰è¯·æ±‚
    return true;
}
```
Controller ä¸­çš„æ–¹æ³•ä»£ç å¯ä»¥å‚è§æºç ï¼Œé‡å¯é¡¹ç›®åœ¨æµè§ˆå™¨ä¸­è¾“å…¥ `http://localhost:8080/interceptor/test2?token=123` æµ‹è¯•ä¸€ä¸‹ï¼Œå¯ä»¥çœ‹å‡ºï¼ŒåŠ äº†è¯¥æ³¨è§£çš„æ–¹æ³•ä¸ä¼šè¢«æ‹¦æˆªã€‚

## 3. æ€»ç»“

æœ¬èŠ‚ä¸»è¦ä»‹ç»äº† Spring Boot ä¸­æ‹¦æˆªå™¨çš„ä½¿ç”¨ï¼Œä»æ‹¦æˆªå™¨çš„åˆ›å»ºã€é…ç½®ï¼Œåˆ°æ‹¦æˆªå™¨å¯¹é™æ€èµ„æºçš„å½±å“ï¼Œéƒ½åšäº†è¯¦ç»†çš„åˆ†æã€‚Spring Boot 2.0 ä¹‹åæ‹¦æˆªå™¨çš„é…ç½®æ”¯æŒä¸¤ç§æ–¹å¼ï¼Œå¯ä»¥æ ¹æ®å®é™…æƒ…å†µé€‰æ‹©ä¸åŒçš„é…ç½®æ–¹å¼ã€‚æœ€åç»“åˆå®é™…ä¸­çš„ä½¿ç”¨ï¼Œä¸¾äº†ä¸¤ä¸ªå¸¸ç”¨çš„åœºæ™¯ï¼Œå¸Œæœ›è¯»è€…èƒ½å¤Ÿè®¤çœŸæ¶ˆåŒ–ï¼ŒæŒæ¡æ‹¦æˆªå™¨çš„ä½¿ç”¨ã€‚
----

> æ–‡ç« å¯ä»¥ç™½å«–ï¼Œå…¬ä¼—å·ä¸èƒ½ä¸å…³æ³¨ï¼Œæ‰‹åŠ¨æ»‘ç¨½ğŸ¤£ğŸ¤£ &nbsp;
>
> æ¬¢è¿å¤§å®¶å…³æ³¨ï¼š**æ­¦å“¥èŠç¼–ç¨‹**ã€**Javaå­¦ä¹ æŒ‡å—**ï¼Œæ‚¨çš„æ”¯æŒï¼Œæ˜¯æˆ‘ä»¬åˆ›ä½œçš„æŒç»­åŠ¨åŠ›ï¼&nbsp;&nbsp;

![æ­¦å“¥èŠç¼–ç¨‹](https://img-blog.csdnimg.cn/202002150421550.jpg)![Javaå­¦ä¹ æŒ‡å—](https://img-blog.csdnimg.cn/20200601113720522.png)