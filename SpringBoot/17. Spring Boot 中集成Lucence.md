> æ–‡ç« å¯ä»¥ç™½å«–ï¼Œå…¬ä¼—å·ä¸èƒ½ä¸å…³æ³¨ï¼Œæ‰‹åŠ¨æ»‘ç¨½ğŸ¤£ğŸ¤£ &nbsp;
>
> æ¬¢è¿å¤§å®¶å…³æ³¨ï¼š**æ­¦å“¥èŠç¼–ç¨‹**ã€**Javaå­¦ä¹ æŒ‡å—**ï¼Œæ‚¨çš„æ”¯æŒï¼Œæ˜¯æˆ‘ä»¬åˆ›ä½œçš„æŒç»­åŠ¨åŠ›ï¼&nbsp;&nbsp;

![æ­¦å“¥èŠç¼–ç¨‹](https://img-blog.csdnimg.cn/202002150421550.jpg)![Javaå­¦ä¹ æŒ‡å—](https://img-blog.csdnimg.cn/20200601113720522.png)
----

## 1. Lucence å’Œå…¨æ–‡æ£€ç´¢

Lucene æ˜¯ä»€ä¹ˆï¼Ÿ Lucene ç›®å‰æ˜¯ Apache Jakarta å®¶æ—ä¸­çš„ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼Œå®ƒä¸æ˜¯ä¸€ä¸ªå®Œæ•´çš„æœç´¢åº”ç”¨ç¨‹åºï¼Œè€Œæ˜¯ä¸ºæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºæä¾›ç´¢å¼•å’Œæœç´¢åŠŸèƒ½ã€‚Lucene ä¹Ÿæ˜¯ç›®å‰æœ€ä¸ºæµè¡Œçš„åŸºäº Java å¼€æºå…¨æ–‡æ£€ç´¢å·¥å…·åŒ…ã€‚

ç›®å‰å·²ç»æœ‰å¾ˆå¤šåº”ç”¨ç¨‹åºçš„æœç´¢åŠŸèƒ½æ˜¯åŸºäº Lucene çš„ï¼Œæ¯”å¦‚ Eclipse å¸®åŠ©ç³»ç»Ÿçš„æœç´¢åŠŸèƒ½ã€‚Lucene èƒ½å¤Ÿä¸ºæ–‡æœ¬ç±»å‹çš„æ•°æ®å»ºç«‹ç´¢å¼•ï¼Œæ‰€ä»¥æˆ‘ä»¬åªè¦èƒ½æŠŠéœ€è¦ç´¢å¼•çš„æ•°æ®æ ¼å¼è½¬åŒ–çš„æ–‡æœ¬çš„ï¼ŒLucene å°±èƒ½å¯¹æˆ‘ä»¬çš„æ–‡æ¡£è¿›è¡Œç´¢å¼•å’Œæœç´¢ã€‚

### 1.1 å…¨æ–‡æ£€ç´¢
è¿™é‡Œæåˆ°äº†å…¨æ–‡æ£€ç´¢çš„æ¦‚å¿µï¼Œæˆ‘ä»¬å…ˆæ¥åˆ†æä¸€ä¸‹ä»€ä¹ˆæ˜¯å…¨æ–‡æ£€ç´¢ï¼Œç†è§£äº†å…¨æ–‡æ£€ç´¢ä¹‹åï¼Œå†ç†è§£ Lucene çš„åŸç†å°±éå¸¸ç®€å•äº†ã€‚  

ä½•ä¸ºå…¨æ–‡æ£€ç´¢ï¼Ÿä¸¾ä¸ªä¾‹å­ï¼Œæ¯”å¦‚ç°åœ¨è¦åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­æŸ¥æ‰¾æŸä¸ªå­—ç¬¦ä¸²ï¼Œæœ€ç›´æ¥çš„æƒ³æ³•å°±æ˜¯ä»å¤´å¼€å§‹æ£€ç´¢ï¼ŒæŸ¥åˆ°äº†å°±OKï¼Œè¿™ç§å¯¹äºå°æ•°æ®é‡çš„æ–‡ä»¶æ¥è¯´ï¼Œå¾ˆå®ç”¨ï¼Œä½†æ˜¯å¯¹äºå¤§æ•°æ®é‡çš„æ–‡ä»¶æ¥è¯´ï¼Œå°±æœ‰ç‚¹åƒåŠ›äº†ã€‚æˆ–è€…è¯´æ‰¾åŒ…å«æŸä¸ªå­—ç¬¦ä¸²çš„æ–‡ä»¶ï¼Œä¹Ÿæ˜¯è¿™æ ·ï¼Œå¦‚æœåœ¨ä¸€ä¸ªæ‹¥æœ‰å‡ åä¸ª G çš„ç¡¬ç›˜ä¸­æ‰¾é‚£æ•ˆç‡å¯æƒ³è€ŒçŸ¥ï¼Œæ˜¯å¾ˆä½çš„ã€‚   

æ–‡ä»¶ä¸­çš„æ•°æ®æ˜¯å±äºéç»“æ„åŒ–æ•°æ®ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒæ²¡æœ‰ä»€ä¹ˆç»“æ„å¯è¨€ï¼Œè¦è§£å†³ä¸Šé¢æåˆ°çš„æ•ˆç‡é—®é¢˜ï¼Œé¦–å…ˆæˆ‘ä»¬å¾—å°†éç»“æ„åŒ–æ•°æ®ä¸­çš„ä¸€éƒ¨åˆ†ä¿¡æ¯æå–å‡ºæ¥ï¼Œé‡æ–°ç»„ç»‡ï¼Œä½¿å…¶å˜å¾—æœ‰ä¸€å®šç»“æ„ï¼Œç„¶åå¯¹è¿™äº›æœ‰ä¸€å®šç»“æ„çš„æ•°æ®è¿›è¡Œæœç´¢ï¼Œä»è€Œè¾¾åˆ°æœç´¢ç›¸å¯¹è¾ƒå¿«çš„ç›®çš„ã€‚è¿™å°±å«å…¨æ–‡æœç´¢ã€‚å³å…ˆå»ºç«‹ç´¢å¼•ï¼Œå†å¯¹ç´¢å¼•è¿›è¡Œæœç´¢çš„è¿‡ç¨‹ã€‚ 

### 1.2 Lucene å»ºç«‹ç´¢å¼•çš„æ–¹å¼

é‚£ä¹ˆ Lucene ä¸­æ˜¯å¦‚ä½•å»ºç«‹ç´¢å¼•çš„å‘¢ï¼Ÿå‡è®¾ç°åœ¨æœ‰ä¸¤ç¯‡æ–‡ç« ï¼Œå†…å®¹å¦‚ä¸‹ï¼š
> æ–‡ç« 1çš„å†…å®¹ä¸ºï¼šTom lives in Guangzhou, I live in Guangzhou too.   
> æ–‡ç« 2çš„å†…å®¹ä¸ºï¼šHe once lived in Shanghai.

é¦–å…ˆç¬¬ä¸€æ­¥æ˜¯å°†æ–‡æ¡£ä¼ ç»™åˆ†è¯ç»„ä»¶ï¼ˆTokenizerï¼‰ï¼Œåˆ†è¯ç»„ä»¶ä¼šå°†æ–‡æ¡£åˆ†æˆä¸€ä¸ªä¸ªå•è¯ï¼Œå¹¶å»é™¤æ ‡ç‚¹ç¬¦å·å’Œåœè¯ã€‚æ‰€è°“çš„åœè¯æŒ‡çš„æ˜¯æ²¡æœ‰ç‰¹åˆ«æ„ä¹‰çš„è¯ï¼Œæ¯”å¦‚è‹±æ–‡ä¸­çš„ aï¼Œtheï¼Œtoo ç­‰ã€‚ç»è¿‡åˆ†è¯åï¼Œå¾—åˆ°è¯å…ƒï¼ˆTokenï¼‰ ã€‚å¦‚ä¸‹ï¼š
> æ–‡ç« 1ç»è¿‡åˆ†è¯åçš„ç»“æœï¼š`[Tom]` `[lives]` `[Guangzhou]` `[I]` `[live]` `[Guangzhou]`   
> æ–‡ç« 2ç»è¿‡åˆ†è¯åçš„ç»“æœï¼š`[He]` `[lives]` `[Shanghai]`

ç„¶åå°†è¯å…ƒä¼ ç»™è¯­è¨€å¤„ç†ç»„ä»¶ï¼ˆLinguistic Processorï¼‰ï¼Œå¯¹äºè‹±è¯­ï¼Œè¯­è¨€å¤„ç†ç»„ä»¶ä¸€èˆ¬ä¼šå°†å­—æ¯å˜ä¸ºå°å†™ï¼Œå°†å•è¯ç¼©å‡ä¸ºè¯æ ¹å½¢å¼ï¼Œå¦‚ â€livesâ€ åˆ° â€liveâ€ ç­‰ï¼Œå°†å•è¯è½¬å˜ä¸ºè¯æ ¹å½¢å¼ï¼Œå¦‚ â€droveâ€ åˆ° â€driveâ€ ç­‰ã€‚ç„¶åå¾—åˆ°è¯ï¼ˆTermï¼‰ã€‚å¦‚ä¸‹ï¼š
> æ–‡ç« 1ç»è¿‡å¤„ç†åçš„ç»“æœï¼š`[tom]` `[live]` `[guangzhou]` `[i]` `[live]` `[guangzhou]` 
> æ–‡ç« 2ç»è¿‡å¤„ç†åçš„ç»“æœï¼š`[he]` `[live]` `[shanghai]`

æœ€åå°†å¾—åˆ°çš„è¯ä¼ ç»™ç´¢å¼•ç»„ä»¶ï¼ˆIndexerï¼‰ï¼Œç´¢å¼•ç»„ä»¶ç»è¿‡å¤„ç†ï¼Œå¾—åˆ°ä¸‹é¢çš„ç´¢å¼•ç»“æ„ï¼š

|å…³é”®è¯|æ–‡ç« å·[å‡ºç°é¢‘ç‡]|å‡ºç°ä½ç½®|
|:--:|:--:|:--:|
|guangzhou|1[2]|3,6|
|he|2[1]|1|
|i|1[1]|4|
|live|1[2],2[1]|2,5,2|
|shanghai|2[1]|3|
|tom|1[1]|1|

ä»¥ä¸Šå°±æ˜¯Lucene ç´¢å¼•ç»“æ„ä¸­æœ€æ ¸å¿ƒçš„éƒ¨åˆ†ã€‚å®ƒçš„å…³é”®å­—æ˜¯æŒ‰å­—ç¬¦é¡ºåºæ’åˆ—çš„ï¼Œå› æ­¤ Lucene å¯ä»¥ç”¨äºŒå…ƒæœç´¢ç®—æ³•å¿«é€Ÿå®šä½å…³é”®è¯ã€‚å®ç°æ—¶ Lucene å°†ä¸Šé¢ä¸‰åˆ—åˆ†åˆ«ä½œä¸ºè¯å…¸æ–‡ä»¶ï¼ˆTerm Dictionaryï¼‰ã€é¢‘ç‡æ–‡ä»¶ï¼ˆfrequenciesï¼‰å’Œä½ç½®æ–‡ä»¶ï¼ˆpositionsï¼‰ä¿å­˜ã€‚å…¶ä¸­è¯å…¸æ–‡ä»¶ä¸ä»…ä¿å­˜æœ‰æ¯ä¸ªå…³é”®è¯ï¼Œè¿˜ä¿ç•™äº†æŒ‡å‘é¢‘ç‡æ–‡ä»¶å’Œä½ç½®æ–‡ä»¶çš„æŒ‡é’ˆï¼Œé€šè¿‡æŒ‡é’ˆå¯ä»¥æ‰¾åˆ°è¯¥å…³é”®å­—çš„é¢‘ç‡ä¿¡æ¯å’Œä½ç½®ä¿¡æ¯ã€‚ 
æœç´¢çš„è¿‡ç¨‹æ˜¯å…ˆå¯¹è¯å…¸äºŒå…ƒæŸ¥æ‰¾ã€æ‰¾åˆ°è¯¥è¯ï¼Œé€šè¿‡æŒ‡å‘é¢‘ç‡æ–‡ä»¶çš„æŒ‡é’ˆè¯»å‡ºæ‰€æœ‰æ–‡ç« å·ï¼Œç„¶åè¿”å›ç»“æœï¼Œç„¶åå°±å¯ä»¥åœ¨å…·ä½“çš„æ–‡ç« ä¸­æ ¹æ®å‡ºç°ä½ç½®æ‰¾åˆ°è¯¥è¯äº†ã€‚æ‰€ä»¥ Lucene åœ¨ç¬¬ä¸€æ¬¡å»ºç«‹ç´¢å¼•çš„æ—¶å€™å¯èƒ½ä¼šæ¯”è¾ƒæ…¢ï¼Œä½†æ˜¯ä»¥åå°±ä¸éœ€è¦æ¯æ¬¡éƒ½å»ºç«‹ç´¢å¼•äº†ï¼Œå°±å¿«äº†ã€‚

ç†è§£äº† Lucene çš„åˆ†è¯åŸç†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬åœ¨ Spring Boot ä¸­é›†æˆ Lucene å¹¶å®ç°ç´¢å¼•å’Œæœç´¢çš„åŠŸèƒ½ã€‚

## 2. Spring Boot ä¸­é›†æˆ Lucence

### 2.1 ä¾èµ–å¯¼å…¥

é¦–å…ˆéœ€è¦å¯¼å…¥ Lucene çš„ä¾èµ–ï¼Œå®ƒçš„ä¾èµ–æœ‰å¥½å‡ ä¸ªï¼Œå¦‚ä¸‹ï¼š

```xml
<!-- Lucenceæ ¸å¿ƒåŒ… -->
<dependency>
	<groupId>org.apache.lucene</groupId>
	<artifactId>lucene-core</artifactId>
	<version>5.3.1</version>
</dependency>

<!-- LuceneæŸ¥è¯¢è§£æåŒ… -->
<dependency>
	<groupId>org.apache.lucene</groupId>
	<artifactId>lucene-queryparser</artifactId>
	<version>5.3.1</version>
</dependency>

<!-- å¸¸è§„çš„åˆ†è¯ï¼ˆè‹±æ–‡ï¼‰ -->
<dependency>
	<groupId>org.apache.lucene</groupId>
	<artifactId>lucene-analyzers-common</artifactId>
	<version>5.3.1</version>
</dependency>

<!--æ”¯æŒåˆ†è¯é«˜äº®  -->
<dependency>
	<groupId>org.apache.lucene</groupId>
	<artifactId>lucene-highlighter</artifactId>
	<version>5.3.1</version>
</dependency>

<!--æ”¯æŒä¸­æ–‡åˆ†è¯  -->
<dependency>
	<groupId>org.apache.lucene</groupId>
	<artifactId>lucene-analyzers-smartcn</artifactId>
	<version>5.3.1</version>
</dependency>
```
æœ€åä¸€ä¸ªä¾èµ–æ˜¯ç”¨æ¥æ”¯æŒä¸­æ–‡åˆ†è¯çš„ï¼Œå› ä¸ºé»˜è®¤æ˜¯æ”¯æŒè‹±æ–‡çš„ã€‚é‚£ä¸ªé«˜äº®çš„åˆ†è¯ä¾èµ–æ˜¯æœ€åæˆ‘è¦åšä¸€ä¸ªæœç´¢ï¼Œç„¶åå°†æœåˆ°çš„å†…å®¹é«˜äº®æ˜¾ç¤ºï¼Œæ¨¡æ‹Ÿå½“å‰äº’è”ç½‘ä¸Šçš„åšæ³•ï¼Œå¤§å®¶å¯ä»¥è¿ç”¨åˆ°å®é™…é¡¹ç›®ä¸­å»ã€‚

### 2.2 å¿«é€Ÿå…¥é—¨

æ ¹æ®ä¸Šæ–‡çš„åˆ†æï¼Œå…¨æ–‡æ£€ç´¢æœ‰ä¸¤ä¸ªæ­¥éª¤ï¼Œå…ˆå»ºç«‹ç´¢å¼•ï¼Œå†æ£€ç´¢ã€‚æ‰€ä»¥ä¸ºäº†æµ‹è¯•è¿™ä¸ªè¿‡ç¨‹ï¼Œæˆ‘æ–°å»ºä¸¤ä¸ª java ç±»ï¼Œä¸€ä¸ªç”¨æ¥å»ºç«‹ç´¢å¼•çš„ï¼Œå¦ä¸€ä¸ªç”¨æ¥æ£€ç´¢ã€‚

#### 2.2.1 å»ºç«‹ç´¢å¼•
æˆ‘ä»¬è‡ªå·±å¼„å‡ ä¸ªæ–‡ä»¶ï¼Œæ”¾åˆ° `D:\lucene\data` ç›®å½•ä¸‹ï¼Œæ–°å»ºä¸€ä¸ª Indexer ç±»æ¥å®ç°å»ºç«‹ç´¢å¼•åŠŸèƒ½ã€‚é¦–å…ˆåœ¨æ„é€ æ–¹æ³•ä¸­åˆå§‹åŒ–æ ‡å‡†åˆ†è¯å™¨å’Œå†™ç´¢å¼•å®ä¾‹ã€‚

```java
public class Indexer {

    /**
     * å†™ç´¢å¼•å®ä¾‹
     */
    private IndexWriter writer;

    /**
     * æ„é€ æ–¹æ³•ï¼Œå®ä¾‹åŒ–IndexWriter
     * @param indexDir
     * @throws Exception
     */
    public Indexer(String indexDir) throws Exception {
        Directory dir = FSDirectory.open(Paths.get(indexDir));
        //æ ‡å‡†åˆ†è¯å™¨ï¼Œä¼šè‡ªåŠ¨å»æ‰ç©ºæ ¼å•Šï¼Œis a theç­‰å•è¯
        Analyzer analyzer = new StandardAnalyzer();
        //å°†æ ‡å‡†åˆ†è¯å™¨é…åˆ°å†™ç´¢å¼•çš„é…ç½®ä¸­
        IndexWriterConfig config = new IndexWriterConfig(analyzer);
        //å®ä¾‹åŒ–å†™ç´¢å¼•å¯¹è±¡
        writer = new IndexWriter(dir, config);
    }
}
```
åœ¨æ„é€ æ”¾å‘ä¸­ä¼ ä¸€ä¸ªå­˜æ”¾ç´¢å¼•çš„æ–‡ä»¶å¤¹è·¯å¾„ï¼Œç„¶åæ„å»ºæ ‡å‡†åˆ†è¯å™¨ï¼ˆè¿™æ˜¯è‹±æ–‡çš„ï¼‰ï¼Œå†ä½¿ç”¨æ ‡å‡†åˆ†è¯å™¨æ¥å®ä¾‹åŒ–å†™ç´¢å¼•å¯¹è±¡ã€‚æ¥ä¸‹æ¥å°±å¼€å§‹å»ºç«‹ç´¢å¼•äº†ï¼Œæˆ‘å°†è§£é‡Šæ”¾åˆ°ä»£ç æ³¨é‡Šé‡Œï¼Œæ–¹ä¾¿å¤§å®¶è·Ÿè¿›ã€‚

```java
/**
 * ç´¢å¼•æŒ‡å®šç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶
 * @param dataDir
 * @return
 * @throws Exception
 */
public int indexAll(String dataDir) throws Exception {
    // è·å–è¯¥è·¯å¾„ä¸‹çš„æ‰€æœ‰æ–‡ä»¶
    File[] files = new File(dataDir).listFiles();
    if (null != files) {
        for (File file : files) {
            //è°ƒç”¨ä¸‹é¢çš„indexFileæ–¹æ³•ï¼Œå¯¹æ¯ä¸ªæ–‡ä»¶è¿›è¡Œç´¢å¼•
            indexFile(file);
        }
    }
    //è¿”å›ç´¢å¼•çš„æ–‡ä»¶æ•°
    return writer.numDocs();
}

/**
 * ç´¢å¼•æŒ‡å®šçš„æ–‡ä»¶
 * @param file
 * @throws Exception
 */
private void indexFile(File file) throws Exception {
    System.out.println("ç´¢å¼•æ–‡ä»¶çš„è·¯å¾„ï¼š" + file.getCanonicalPath());
    //è°ƒç”¨ä¸‹é¢çš„getDocumentæ–¹æ³•ï¼Œè·å–è¯¥æ–‡ä»¶çš„document
    Document doc = getDocument(file);
    //å°†docæ·»åŠ åˆ°ç´¢å¼•ä¸­
    writer.addDocument(doc);
}

/**
 * è·å–æ–‡æ¡£ï¼Œæ–‡æ¡£é‡Œå†è®¾ç½®æ¯ä¸ªå­—æ®µï¼Œå°±ç±»ä¼¼äºæ•°æ®åº“ä¸­çš„ä¸€è¡Œè®°å½•
 * @param file
 * @return
 * @throws Exception
 */
private Document getDocument(File file) throws Exception {
    Document doc = new Document();
    //å¼€å§‹æ·»åŠ å­—æ®µ
    //æ·»åŠ å†…å®¹
    doc.add(new TextField("contents", new FileReader(file)));
    //æ·»åŠ æ–‡ä»¶åï¼Œå¹¶æŠŠè¿™ä¸ªå­—æ®µå­˜åˆ°ç´¢å¼•æ–‡ä»¶é‡Œ
    doc.add(new TextField("fileName", file.getName(), Field.Store.YES));
    //æ·»åŠ æ–‡ä»¶è·¯å¾„
    doc.add(new TextField("fullPath", file.getCanonicalPath(), Field.Store.YES));
    return doc;
}
```
è¿™æ ·å°±å»ºç«‹å¥½ç´¢å¼•äº†ï¼Œæˆ‘ä»¬åœ¨è¯¥ç±»ä¸­å†™ä¸€ä¸ª main æ–¹æ³•æµ‹è¯•ä¸€ä¸‹ï¼š
```java
public static void main(String[] args) {
        //ç´¢å¼•ä¿å­˜åˆ°çš„è·¯å¾„
        String indexDir = "D:\\lucene";
        //éœ€è¦ç´¢å¼•çš„æ–‡ä»¶æ•°æ®å­˜æ”¾çš„ç›®å½•
        String dataDir = "D:\\lucene\\data";
        Indexer indexer = null;
        int indexedNum = 0;
        //è®°å½•ç´¢å¼•å¼€å§‹æ—¶é—´
        long startTime = System.currentTimeMillis();
        try {
            // å¼€å§‹æ„å»ºç´¢å¼•
            indexer = new Indexer(indexDir);
            indexedNum = indexer.indexAll(dataDir);
        } catch (Exception e) {
            e.printStackTrace();
        } finally {
            try {
                if (null != indexer) {
                    indexer.close();
                }
            } catch (Exception e) {
                e.printStackTrace();
            }
        }
        //è®°å½•ç´¢å¼•ç»“æŸæ—¶é—´
        long endTime = System.currentTimeMillis();
        System.out.println("ç´¢å¼•è€—æ—¶" + (endTime - startTime) + "æ¯«ç§’");
        System.out.println("å…±ç´¢å¼•äº†" + indexedNum + "ä¸ªæ–‡ä»¶");
    }
```

æˆ‘æäº†ä¸¤ä¸ª tomcat ç›¸å…³çš„æ–‡ä»¶æ”¾åˆ° `D:\lucene\data` ä¸‹äº†ï¼Œæ–‡ä»¶åä¸º catalina.properties å’Œ logging.propertiesï¼Œæ–‡ä»¶å¯ä»¥åœ¨ tomcat çš„ conf ç›®å½•ä¸‹æ‹·è´ï¼Œä¹Ÿå¯ä»¥åœ¨æˆ‘çš„æºä»£ç ä¸­è·å–ï¼Œæˆ‘ä¹Ÿä¸Šä¼ äº†ã€‚æ‰§è¡Œå®Œä¹‹åï¼Œçœ‹åˆ°æ§åˆ¶å°è¾“å‡ºï¼š
```
ç´¢å¼•æ–‡ä»¶çš„è·¯å¾„ï¼šD:\lucene\data\catalina.properties
ç´¢å¼•æ–‡ä»¶çš„è·¯å¾„ï¼šD:\lucene\data\logging.properties
ç´¢å¼•è€—æ—¶882æ¯«ç§’
å…±ç´¢å¼•äº†2ä¸ªæ–‡ä»¶
```
ç„¶åæˆ‘ä»¬å» `D:\lucene\` ç›®å½•ä¸‹å¯ä»¥çœ‹åˆ°ä¸€äº›ç´¢å¼•æ–‡ä»¶ï¼Œè¿™äº›æ–‡ä»¶ä¸èƒ½åˆ é™¤ï¼Œåˆ é™¤äº†å°±éœ€è¦é‡æ–°æ„å»ºç´¢å¼•ï¼Œå¦åˆ™æ²¡äº†ç´¢å¼•ï¼Œå°±æ— æ³•å»æ£€ç´¢å†…å®¹äº†ã€‚

####2.2.2 æ£€ç´¢å†…å®¹

ä¸Šé¢æŠŠè¿™ä¸¤ä¸ªæ–‡ä»¶çš„ç´¢å¼•å»ºç«‹å¥½äº†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±å¯ä»¥å†™æ£€ç´¢ç¨‹åºäº†ï¼Œåœ¨è¿™ä¸¤ä¸ªæ–‡ä»¶ä¸­æŸ¥æ‰¾ç‰¹å®šçš„è¯ã€‚

```java
public class Searcher {

    public static void search(String indexDir, String q) throws Exception {

        //è·å–è¦æŸ¥è¯¢çš„è·¯å¾„ï¼Œä¹Ÿå°±æ˜¯ç´¢å¼•æ‰€åœ¨çš„ä½ç½®
        Directory dir = FSDirectory.open(Paths.get(indexDir));
        IndexReader reader = DirectoryReader.open(dir);
        //æ„å»ºIndexSearcher
        IndexSearcher searcher = new IndexSearcher(reader);
        //æ ‡å‡†åˆ†è¯å™¨ï¼Œä¼šè‡ªåŠ¨å»æ‰ç©ºæ ¼å•Šï¼Œis a theç­‰å•è¯
        Analyzer analyzer = new StandardAnalyzer();
        //æŸ¥è¯¢è§£æå™¨
        QueryParser parser = new QueryParser("contents", analyzer);
        //é€šè¿‡è§£æè¦æŸ¥è¯¢çš„Stringï¼Œè·å–æŸ¥è¯¢å¯¹è±¡ï¼Œqä¸ºä¼ è¿›æ¥çš„å¾…æŸ¥çš„å­—ç¬¦ä¸²
        Query query = parser.parse(q);

        //è®°å½•ç´¢å¼•å¼€å§‹æ—¶é—´
        long startTime = System.currentTimeMillis();
        //å¼€å§‹æŸ¥è¯¢ï¼ŒæŸ¥è¯¢å‰10æ¡æ•°æ®ï¼Œå°†è®°å½•ä¿å­˜åœ¨docsä¸­
        TopDocs docs = searcher.search(query, 10);
        //è®°å½•ç´¢å¼•ç»“æŸæ—¶é—´
        long endTime = System.currentTimeMillis();
        System.out.println("åŒ¹é…" + q + "å…±è€—æ—¶" + (endTime-startTime) + "æ¯«ç§’");
        System.out.println("æŸ¥è¯¢åˆ°" + docs.totalHits + "æ¡è®°å½•");

        //å–å‡ºæ¯æ¡æŸ¥è¯¢ç»“æœ
        for(ScoreDoc scoreDoc : docs.scoreDocs) {
            //scoreDoc.docç›¸å½“äºdocID,æ ¹æ®è¿™ä¸ªdocIDæ¥è·å–æ–‡æ¡£
            Document doc = searcher.doc(scoreDoc.doc);
            //fullPathæ˜¯åˆšåˆšå»ºç«‹ç´¢å¼•çš„æ—¶å€™æˆ‘ä»¬å®šä¹‰çš„ä¸€ä¸ªå­—æ®µï¼Œè¡¨ç¤ºè·¯å¾„ã€‚ä¹Ÿå¯ä»¥å–å…¶ä»–çš„å†…å®¹ï¼Œåªè¦æˆ‘ä»¬åœ¨å»ºç«‹ç´¢å¼•æ—¶æœ‰å®šä¹‰å³å¯ã€‚
            System.out.println(doc.get("fullPath"));
        }
        reader.close();
    }
}
```
okï¼Œè¿™æ ·æˆ‘ä»¬æ£€ç´¢çš„ä»£ç å°±å†™å®Œäº†ï¼Œæ¯ä¸€æ­¥è§£é‡Šæˆ‘å†™åœ¨ä»£ç ä¸­çš„æ³¨é‡Šä¸Šäº†ï¼Œä¸‹é¢å†™ä¸ª main æ–¹æ³•æ¥æµ‹è¯•ä¸€ä¸‹ï¼š
```java
public static void main(String[] args) {
    String indexDir = "D:\\lucene";
    //æŸ¥è¯¢è¿™ä¸ªå­—ç¬¦ä¸²
    String q = "security";
    try {
        search(indexDir, q);
    } catch (Exception e) {
        e.printStackTrace();
    }
}
```
æŸ¥ä¸€ä¸‹ `security` è¿™ä¸ªå­—ç¬¦ä¸²ï¼Œæ‰§è¡Œä¸€ä¸‹çœ‹æ§åˆ¶å°æ‰“å°çš„ç»“æœï¼š

```
åŒ¹é…securityå…±è€—æ—¶23æ¯«ç§’
æŸ¥è¯¢åˆ°1æ¡è®°å½•
D:\lucene\data\catalina.properties
```
å¯ä»¥çœ‹å‡ºï¼Œè€—æ—¶äº†23æ¯«ç§’åœ¨å…¶ä¸­ä¸€ä¸ªæ–‡ä»¶ä¸­æ‰¾åˆ°äº† security è¿™ä¸ªå­—ç¬¦ä¸²ï¼Œå¹¶è¾“å‡ºäº†æ–‡ä»¶çš„åç§°ã€‚ä¸Šé¢çš„ä»£ç æˆ‘å†™çš„å¾ˆè¯¦ç»†ï¼Œè¿™ä¸ªä»£ç å·²ç»æ¯”è¾ƒå…¨äº†ï¼Œå¯ä»¥ç”¨åœ¨ç”Ÿäº§ç¯å¢ƒä¸Šã€‚

### 2.3 ä¸­æ–‡åˆ†è¯æ£€ç´¢é«˜äº®å®æˆ˜

ä¸Šæ–‡å·²ç»å†™äº†å»ºç«‹ç´¢å¼•å’Œæ£€ç´¢çš„ä»£ç ï¼Œä½†æ˜¯åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬å¾€å¾€æ˜¯ç»“åˆé¡µé¢åšä¸€äº›æŸ¥è¯¢ç»“æœçš„å±•ç¤ºï¼Œæ¯”å¦‚æˆ‘è¦æŸ¥æŸä¸ªå…³é”®å­—ï¼ŒæŸ¥åˆ°äº†ä¹‹åï¼Œå°†ç›¸å…³çš„ä¿¡æ¯ç‚¹å±•ç¤ºå‡ºæ¥ï¼Œå¹¶å°†æŸ¥è¯¢çš„å…³é”®å­—é«˜äº®ç­‰ç­‰ã€‚è¿™ç§éœ€æ±‚åœ¨å®é™…é¡¹ç›®ä¸­éå¸¸å¸¸è§ï¼Œè€Œä¸”å¤§å¤šæ•°ç½‘ç«™ä¸­éƒ½ä¼šæœ‰è¿™ç§æ•ˆæœã€‚æ‰€ä»¥è¿™ä¸€å°èŠ‚æˆ‘ä»¬å°±ä½¿ç”¨ Lucene æ¥å®ç°è¿™ç§æ•ˆæœã€‚

#### 2.3.1 ä¸­æ–‡åˆ†è¯

æˆ‘ä»¬æ–°å»ºä¸€ä¸ª ChineseIndexer ç±»æ¥å»ºç«‹ä¸­æ–‡ç´¢å¼•ï¼Œå»ºç«‹è¿‡ç¨‹å’Œè‹±æ–‡ç´¢å¼•ä¸€æ ·çš„ï¼Œä¸åŒçš„åœ°æ–¹åœ¨äºä½¿ç”¨çš„æ˜¯ä¸­æ–‡åˆ†è¯å™¨ã€‚ä¸Šé¢æˆ‘ä»¬æ˜¯é€šè¿‡è¯»å–æ–‡ä»¶å»å»ºç«‹ç´¢å¼•ï¼Œè¿™é‡Œæˆ‘ä»¬ä¸è¯»å–æ–‡ä»¶ï¼Œç›´æ¥å¯¹ä¸€ä¸ªå­—ç¬¦ä¸²å»ºç«‹ç´¢å¼•ï¼Œå› ä¸ºåœ¨å®é™…é¡¹ç›®ä¸­ï¼Œç»å¤§éƒ¨åˆ†æƒ…å†µæ˜¯è·å–åˆ°ä¸€äº›æ–‡æœ¬å­—ç¬¦ä¸²ï¼ˆæ¯”å¦‚ä»è¡¨ä¸­æŸ¥è¯¢å‡ºæ¥çš„ç»“æœï¼‰ï¼Œç„¶åå¯¹è¯¥æ–‡æœ¬å­—ç¬¦ä¸²å»ºç«‹ç´¢å¼•ã€‚

ç´¢å¼•å»ºç«‹çš„è¿‡ç¨‹ï¼Œå…ˆè¦è·å– IndexWriter å¯¹è±¡ï¼Œç„¶åå°†ç›¸å…³çš„å†…å®¹ç”Ÿæˆç´¢å¼•ï¼Œç´¢å¼•çš„ key å¯ä»¥è‡ªå·±æ ¹æ®é¡¹ç›®ä¸­çš„æƒ…å†µæ¥è‡ªå®šä¹‰ï¼Œå†…å®¹æ˜¯è‡ªå·±å¤„ç†è¿‡çš„æ–‡æœ¬ï¼Œæˆ–è€…ä»æ•°æ®åº“ä¸­æŸ¥è¯¢å‡ºæ¥çš„æ–‡æœ¬ã€‚ç”Ÿæˆçš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ä¸­æ–‡åˆ†è¯å™¨ã€‚ä»£ç å¦‚ä¸‹ï¼š
```java
public class ChineseIndexer {

    /**
     * å­˜æ”¾ç´¢å¼•çš„ä½ç½®
     */
    private Directory dir;

    //å‡†å¤‡ä¸€ä¸‹ç”¨æ¥æµ‹è¯•çš„æ•°æ®
    //ç”¨æ¥æ ‡è¯†æ–‡æ¡£
    private Integer ids[] = {1, 2, 3};
    private String citys[] = {"ä¸Šæµ·", "å—äº¬", "é’å²›"};
    private String descs[] = {
            "ä¸Šæµ·æ˜¯ä¸ªç¹åçš„åŸå¸‚ã€‚",
            "å—äº¬æ˜¯ä¸€ä¸ªæ–‡åŒ–çš„åŸå¸‚å—äº¬ï¼Œç®€ç§°å®ï¼Œæ˜¯æ±Ÿè‹çœä¼šï¼Œåœ°å¤„ä¸­å›½ä¸œéƒ¨åœ°åŒºï¼Œé•¿æ±Ÿä¸‹æ¸¸ï¼Œæ¿’æ±Ÿè¿‘æµ·ã€‚å…¨å¸‚ä¸‹è¾–11ä¸ªåŒºï¼Œæ€»é¢ç§¯6597å¹³æ–¹å…¬é‡Œï¼Œ2013å¹´å»ºæˆåŒºé¢ç§¯752.83å¹³æ–¹å…¬é‡Œï¼Œå¸¸ä½äººå£818.78ä¸‡ï¼Œå…¶ä¸­åŸé•‡äººå£659.1ä¸‡äººã€‚[1-4] â€œæ±Ÿå—ä½³ä¸½åœ°ï¼Œé‡‘é™µå¸ç‹å·â€ï¼Œå—äº¬æ‹¥æœ‰ç€6000å¤šå¹´æ–‡æ˜å²ã€è¿‘2600å¹´å»ºåŸå²å’Œè¿‘500å¹´çš„å»ºéƒ½å²ï¼Œæ˜¯ä¸­å›½å››å¤§å¤éƒ½ä¹‹ä¸€ï¼Œæœ‰â€œå…­æœå¤éƒ½â€ã€â€œåæœéƒ½ä¼šâ€ä¹‹ç§°ï¼Œæ˜¯ä¸­åæ–‡æ˜çš„é‡è¦å‘ç¥¥åœ°ï¼Œå†å²ä¸Šæ›¾æ•°æ¬¡åº‡ä½‘åå¤ä¹‹æ­£æœ”ï¼Œé•¿æœŸæ˜¯ä¸­å›½å—æ–¹çš„æ”¿æ²»ã€ç»æµã€æ–‡åŒ–ä¸­å¿ƒï¼Œæ‹¥æœ‰åšé‡çš„æ–‡åŒ–åº•è•´å’Œä¸°å¯Œçš„å†å²é—å­˜ã€‚[5-7] å—äº¬æ˜¯å›½å®¶é‡è¦çš„ç§‘æ•™ä¸­å¿ƒï¼Œè‡ªå¤ä»¥æ¥å°±æ˜¯ä¸€åº§å´‡æ–‡é‡æ•™çš„åŸå¸‚ï¼Œæœ‰â€œå¤©ä¸‹æ–‡æ¢â€ã€â€œä¸œå—ç¬¬ä¸€å­¦â€çš„ç¾èª‰ã€‚æˆªè‡³2013å¹´ï¼Œå—äº¬æœ‰é«˜ç­‰é™¢æ ¡75æ‰€ï¼Œå…¶ä¸­211é«˜æ ¡8æ‰€ï¼Œä»…æ¬¡äºåŒ—äº¬ä¸Šæµ·ï¼›å›½å®¶é‡ç‚¹å®éªŒå®¤25æ‰€ã€å›½å®¶é‡ç‚¹å­¦ç§‘169ä¸ªã€ä¸¤é™¢é™¢å£«83äººï¼Œå‡å±…ä¸­å›½ç¬¬ä¸‰ã€‚[8-10] ã€‚",
            "é’å²›æ˜¯ä¸€ä¸ªç¾ä¸½çš„åŸå¸‚ã€‚"
    };

    /**
     * ç”Ÿæˆç´¢å¼•
     * @param indexDir
     * @throws Exception
     */
    public void index(String indexDir) throws Exception {
        dir = FSDirectory.open(Paths.get(indexDir));
        // å…ˆè°ƒç”¨ getWriter è·å–IndexWriterå¯¹è±¡
        IndexWriter writer = getWriter();
        for(int i = 0; i < ids.length; i++) {
            Document doc = new Document();
            // æŠŠä¸Šé¢çš„æ•°æ®éƒ½ç”Ÿæˆç´¢å¼•ï¼Œåˆ†åˆ«ç”¨idã€cityå’Œdescæ¥æ ‡è¯†
            doc.add(new IntField("id", ids[i], Field.Store.YES));
            doc.add(new StringField("city", citys[i], Field.Store.YES));
            doc.add(new TextField("desc", descs[i], Field.Store.YES));
            //æ·»åŠ æ–‡æ¡£
            writer.addDocument(doc);
        }
        //closeäº†æ‰çœŸæ­£å†™åˆ°æ–‡æ¡£ä¸­
        writer.close();
    }

    /**
     * è·å–IndexWriterå®ä¾‹
     * @return
     * @throws Exception
     */
    private IndexWriter getWriter() throws Exception {
        //ä½¿ç”¨ä¸­æ–‡åˆ†è¯å™¨
        SmartChineseAnalyzer analyzer = new SmartChineseAnalyzer();
        //å°†ä¸­æ–‡åˆ†è¯å™¨é…åˆ°å†™ç´¢å¼•çš„é…ç½®ä¸­
        IndexWriterConfig config = new IndexWriterConfig(analyzer);
        //å®ä¾‹åŒ–å†™ç´¢å¼•å¯¹è±¡
        IndexWriter writer = new IndexWriter(dir, config);
        return writer;
    }

    public static void main(String[] args) throws Exception {
        new ChineseIndexer().index("D:\\lucene2");
    }
}
```
è¿™é‡Œæˆ‘ä»¬ç”¨ idã€cityã€desc åˆ†åˆ«ä»£è¡¨ idã€åŸå¸‚åç§°å’ŒåŸå¸‚æè¿°ï¼Œç”¨ä»–ä»¬ä½œä¸ºå…³é”®å­—æ¥å»ºç«‹ç´¢å¼•ï¼Œåé¢æˆ‘ä»¬è·å–å†…å®¹çš„æ—¶å€™ï¼Œä¸»è¦æ¥è·å–åŸå¸‚æè¿°ã€‚å—äº¬çš„æè¿°æˆ‘æ•…æ„å†™çš„é•¿ä¸€ç‚¹ï¼Œå› ä¸ºä¸‹æ–‡æ£€ç´¢çš„æ—¶å€™ï¼Œæ ¹æ®ä¸åŒçš„å…³é”®å­—ä¼šæ£€ç´¢åˆ°ä¸åŒéƒ¨åˆ†çš„ä¿¡æ¯ï¼Œæœ‰ä¸ªæƒé‡çš„æ¦‚å¿µåœ¨é‡Œé¢ã€‚
ç„¶åæ‰§è¡Œä¸€ä¸‹ main æ–¹æ³•ï¼Œå°†ç´¢å¼•ä¿å­˜åˆ° `D:\lucene2\` ä¸­ã€‚ 

#### 2.3.2 ä¸­æ–‡åˆ†è¯æŸ¥è¯¢

ä¸­æ–‡åˆ†è¯æŸ¥è¯¢ä»£ç é€»è¾‘å’Œé»˜è®¤çš„æŸ¥è¯¢å·®ä¸å¤šï¼Œæœ‰ä¸€äº›åŒºåˆ«åœ¨äºï¼Œæˆ‘ä»¬éœ€è¦å°†æŸ¥è¯¢å‡ºæ¥çš„å…³é”®å­—æ ‡çº¢åŠ ç²—ç­‰éœ€è¦å¤„ç†ï¼Œéœ€è¦è®¡ç®—å‡ºä¸€ä¸ªå¾—åˆ†ç‰‡æ®µï¼Œè¿™æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿæ¯”å¦‚æˆ‘æœç´¢ â€œå—äº¬æ–‡åŒ–â€ è·Ÿæœç´¢ â€œå—äº¬æ–‡æ˜â€ï¼Œåº”è¯¥ä¼šè¿”å›ä¸åŒçš„ç»“æœï¼Œè¿™ä¸ªç»“æœæ˜¯æ ¹æ®è®¡ç®—å‡ºçš„å¾—åˆ†ç‰‡æ®µæ¥ç¡®å®šçš„ã€‚

ä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼Œæ¯”å¦‚æœ‰ä¸€æ®µæ–‡æœ¬ï¼šâ€œä½ å¥½ï¼Œæˆ‘çš„åå­—å«å€ªå‡æ­¦ï¼Œç§‘å¤§è®¯é£è½¯ä»¶å¼€å‘å·¥ç¨‹å¸ˆâ€¦â€¦ï¼Œæ±Ÿæ¹–äººéƒ½å«æˆ‘æ­¦å“¥ï¼Œæˆ‘ä¸€ç›´è§‰å¾—ï¼Œäººä¸äººä¹‹é—´è®²çš„æ˜¯çœŸè¯šï¼Œè€Œä¸æ˜¯å¥—è·¯ã€‚â€¦â€¦â€ã€‚
> å¦‚æœæˆ‘æœ â€œå€ªå‡æ­¦â€ï¼Œå¯èƒ½ä¼šç»™æˆ‘è¿”å›ç»“æœï¼šâ€œæˆ‘çš„åå­—å«å€ªå‡æ­¦ï¼Œç§‘å¤§è®¯é£è½¯ä»¶å¼€å‘å·¥ç¨‹å¸ˆâ€  
> å¦‚æœæˆ‘æœ â€æ­¦å“¥â€œï¼Œå¯èƒ½ä¼šç»™æˆ‘è¿”å›ç»“æœï¼šâ€æ±Ÿæ¹–äººéƒ½å«æˆ‘æ­¦å“¥ï¼Œæˆ‘ä¸€ç›´è§‰å¾—â€œ

Lucene ä¼šæ ¹æ®æœç´¢çš„å…³é”®å­—ï¼Œåœ¨å¾…æœç´¢æ–‡æœ¬ä¸­è®¡ç®—å…³é”®å­—å‡ºç°ç‰‡æ®µçš„å¾—åˆ†ï¼Œè¿”å›æœ€èƒ½åæ˜ å‡ºç”¨æˆ·æœç´¢æ„å›¾çš„ä¸€æ®µæ–‡æœ¬ä½œä¸ºç»“æœã€‚æ˜ç™½äº†åŸç†ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹ä»£ç å’Œæ³¨é‡Šï¼š
```java
public class ChineseSearch {

    private static final Logger logger = LoggerFactory.getLogger(ChineseSearch.class);

    public static List<String> search(String indexDir, String q) throws Exception {

        //è·å–è¦æŸ¥è¯¢çš„è·¯å¾„ï¼Œä¹Ÿå°±æ˜¯ç´¢å¼•æ‰€åœ¨çš„ä½ç½®
        Directory dir = FSDirectory.open(Paths.get(indexDir));
        IndexReader reader = DirectoryReader.open(dir);
        IndexSearcher searcher = new IndexSearcher(reader);
        //ä½¿ç”¨ä¸­æ–‡åˆ†è¯å™¨
        SmartChineseAnalyzer analyzer = new SmartChineseAnalyzer();
        //ç”±ä¸­æ–‡åˆ†è¯å™¨åˆå§‹åŒ–æŸ¥è¯¢è§£æå™¨
        QueryParser parser = new QueryParser("desc", analyzer);
        //é€šè¿‡è§£æè¦æŸ¥è¯¢çš„Stringï¼Œè·å–æŸ¥è¯¢å¯¹è±¡
        Query query = parser.parse(q);

        //è®°å½•ç´¢å¼•å¼€å§‹æ—¶é—´
        long startTime = System.currentTimeMillis();
        //å¼€å§‹æŸ¥è¯¢ï¼ŒæŸ¥è¯¢å‰10æ¡æ•°æ®ï¼Œå°†è®°å½•ä¿å­˜åœ¨docsä¸­
        TopDocs docs = searcher.search(query, 10);
        //è®°å½•ç´¢å¼•ç»“æŸæ—¶é—´
        long endTime = System.currentTimeMillis();
        logger.info("åŒ¹é…{}å…±è€—æ—¶{}æ¯«ç§’", q, (endTime - startTime));
        logger.info("æŸ¥è¯¢åˆ°{}æ¡è®°å½•", docs.totalHits);

        //å¦‚æœä¸æŒ‡å®šå‚æ•°çš„è¯ï¼Œé»˜è®¤æ˜¯åŠ ç²—ï¼Œå³<b><b/>
        SimpleHTMLFormatter simpleHTMLFormatter = new SimpleHTMLFormatter("<b><font color=red>","</font></b>");
        //æ ¹æ®æŸ¥è¯¢å¯¹è±¡è®¡ç®—å¾—åˆ†ï¼Œä¼šåˆå§‹åŒ–ä¸€ä¸ªæŸ¥è¯¢ç»“æœæœ€é«˜çš„å¾—åˆ†
        QueryScorer scorer = new QueryScorer(query);
        //æ ¹æ®è¿™ä¸ªå¾—åˆ†è®¡ç®—å‡ºä¸€ä¸ªç‰‡æ®µ
        Fragmenter fragmenter = new SimpleSpanFragmenter(scorer);
        //å°†è¿™ä¸ªç‰‡æ®µä¸­çš„å…³é”®å­—ç”¨ä¸Šé¢åˆå§‹åŒ–å¥½çš„é«˜äº®æ ¼å¼é«˜äº®
        Highlighter highlighter = new Highlighter(simpleHTMLFormatter, scorer);
        //è®¾ç½®ä¸€ä¸‹è¦æ˜¾ç¤ºçš„ç‰‡æ®µ
        highlighter.setTextFragmenter(fragmenter);

        //å–å‡ºæ¯æ¡æŸ¥è¯¢ç»“æœ
        List<String> list = new ArrayList<>();
        for(ScoreDoc scoreDoc : docs.scoreDocs) {
            //scoreDoc.docç›¸å½“äºdocID,æ ¹æ®è¿™ä¸ªdocIDæ¥è·å–æ–‡æ¡£
            Document doc = searcher.doc(scoreDoc.doc);
            logger.info("city:{}", doc.get("city"));
            logger.info("desc:{}", doc.get("desc"));
            String desc = doc.get("desc");

            //æ˜¾ç¤ºé«˜äº®
            if(desc != null) {
                TokenStream tokenStream = analyzer.tokenStream("desc", new StringReader(desc));
                String summary = highlighter.getBestFragment(tokenStream, desc);
                logger.info("é«˜äº®åçš„desc:{}", summary);
                list.add(summary);
            }
        }
        reader.close();
        return list;
    }
}
```
æ¯ä¸€æ­¥çš„æ³¨é‡Šæˆ‘å†™çš„å¾ˆè¯¦ç»†ï¼Œåœ¨è¿™å°±ä¸èµ˜è¿°äº†ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬æ¥æµ‹è¯•ä¸€ä¸‹æ•ˆæœã€‚

#### 2.3.3 æµ‹è¯•ä¸€ä¸‹

è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ thymeleaf æ¥å†™ä¸ªç®€å•çš„é¡µé¢æ¥å±•ç¤ºè·å–åˆ°çš„æ•°æ®ï¼Œå¹¶é«˜äº®å±•ç¤ºã€‚åœ¨ controller ä¸­æˆ‘ä»¬æŒ‡å®šç´¢å¼•çš„ç›®å½•å’Œéœ€è¦æŸ¥è¯¢çš„å­—ç¬¦ä¸²ï¼Œå¦‚ä¸‹ï¼š

```java
@Controller
@RequestMapping("/lucene")
public class IndexController {

    @GetMapping("/test")
    public String test(Model model) {
        // ç´¢å¼•æ‰€åœ¨çš„ç›®å½•
        String indexDir = "D:\\lucene2";
        // è¦æŸ¥è¯¢çš„å­—ç¬¦
//        String q = "å—äº¬æ–‡æ˜";
        String q = "å—äº¬æ–‡åŒ–";
        try {
            List<String> list = ChineseSearch.search(indexDir, q);
            model.addAttribute("list", list);
        } catch (Exception e) {
            e.printStackTrace();
        }
        return "result";
    }
}
```
ç›´æ¥è¿”å›åˆ° result.html é¡µé¢ï¼Œè¯¥é¡µé¢ä¸»è¦æ¥å±•ç¤ºä¸€ä¸‹ model ä¸­çš„æ•°æ®å³å¯ã€‚

```xml
<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<div th:each="desc : ${list}">
    <div th:utext="${desc}"></div>
</div>
</body>
</html>
```
è¿™é‡Œæ³¨æ„ä¸€ä¸‹ï¼Œä¸èƒ½ä½¿ç”¨ `th:test`ï¼Œå¦åˆ™å­—ç¬¦ä¸²ä¸­çš„ html æ ‡ç­¾éƒ½ä¼šè¢«è½¬ä¹‰ï¼Œä¸ä¼šè¢«æ¸²æŸ“åˆ°é¡µé¢ã€‚ä¸‹é¢å¯åŠ¨æœåŠ¡ï¼Œåœ¨æµè§ˆå™¨ä¸­è¾“å…¥ `http://localhost:8080/lucene/test`ï¼Œæµ‹è¯•ä¸€ä¸‹æ•ˆæœï¼Œæˆ‘ä»¬æœç´¢çš„æ˜¯ â€œå—äº¬æ–‡åŒ–â€ã€‚

![å—äº¬æ–‡åŒ–](https://images.gitbook.cn/83b3f810-b377-11e8-88bf-23cb78d1fb4f)

å†å°† controller ä¸­çš„æœç´¢å…³é”®å­—æ”¹æˆ â€œå—äº¬æ–‡æ˜â€ï¼Œçœ‹ä¸‹å‘½ä¸­çš„æ•ˆæœã€‚

![å—äº¬æ–‡æ˜](https://images.gitbook.cn/8ef8a4a0-b377-11e8-911d-27cc5f059829)

å¯ä»¥çœ‹å‡ºï¼Œä¸åŒçš„å…³é”®è¯ï¼Œå®ƒä¼šè®¡ç®—ä¸€ä¸ªå¾—åˆ†ç‰‡æ®µï¼Œä¹Ÿå°±æ˜¯è¯´ä¸åŒçš„å…³é”®å­—ä¼šå‘½ä¸­ä¸åŒä½ç½®çš„å†…å®¹ï¼Œç„¶åå°†å…³é”®å­—æ ¹æ®æˆ‘ä»¬è‡ªå·±è®¾å®šçš„å½¢å¼é«˜äº®æ˜¾ç¤ºã€‚ä»ç»“æœä¸­å¯ä»¥çœ‹å‡ºï¼ŒLucene ä¹Ÿå¯ä»¥å¾ˆæ™ºèƒ½çš„å°†å…³é”®å­—æ‹†åˆ†å‘½ä¸­ï¼Œè¿™åœ¨å®é™…é¡¹ç›®ä¸­ä¼šå¾ˆå¥½ç”¨ã€‚

## 3. æ€»ç»“

æœ¬èŠ‚è¯¾é¦–å…ˆè¯¦ç»†çš„åˆ†æäº†å…¨æ–‡æ£€ç´¢çš„ç†è®ºè§„åˆ™ï¼Œç„¶åç»“åˆ Luceneï¼Œç³»ç»Ÿçš„è®²è¿°äº†åœ¨ Spring Boot çš„é›†æˆæ­¥éª¤ï¼Œé¦–å…ˆå¿«é€Ÿå¸¦é¢†å¤§å®¶ä»ç›´è§‚ä¸Šæ„Ÿå— Lucene å¦‚ä½•å»ºç«‹ç´¢å¼•å·²ç»å¦‚æœæ£€ç´¢ï¼Œå…¶æ¬¡é€šè¿‡ä¸­æ–‡æ£€ç´¢çš„å…·ä½“å®ä¾‹ï¼Œå±•ç¤ºäº† Lucene åœ¨å…¨æ–‡æ£€ç´¢ä¸­çš„å¹¿æ³›åº”ç”¨ã€‚Lucene ä¸éš¾ï¼Œä¸»è¦å°±æ˜¯æ­¥éª¤æ¯”è¾ƒå¤šï¼Œä»£ç ä¸ç”¨æ­»è®°ç¡¬èƒŒï¼Œæ‹¿åˆ°é¡¹ç›®ä¸­æ ¹æ®å®é™…æƒ…å†µåšå¯¹åº”çš„ä¿®æ”¹å³å¯ã€‚

è¯¾ç¨‹æºä»£ç ä¸‹è½½åœ°å€ï¼š[æˆ³æˆ‘ä¸‹è½½](https://gitee.com/eson15/springboot_study)

----
> æ–‡ç« å¯ä»¥ç™½å«–ï¼Œå…¬ä¼—å·ä¸èƒ½ä¸å…³æ³¨ï¼Œæ‰‹åŠ¨æ»‘ç¨½ğŸ¤£ğŸ¤£ &nbsp;
>
> æ¬¢è¿å¤§å®¶å…³æ³¨ï¼š**æ­¦å“¥èŠç¼–ç¨‹**ã€**Javaå­¦ä¹ æŒ‡å—**ï¼Œæ‚¨çš„æ”¯æŒï¼Œæ˜¯æˆ‘ä»¬åˆ›ä½œçš„æŒç»­åŠ¨åŠ›ï¼&nbsp;&nbsp;

![æ­¦å“¥èŠç¼–ç¨‹](https://img-blog.csdnimg.cn/202002150421550.jpg)![Javaå­¦ä¹ æŒ‡å—](https://img-blog.csdnimg.cn/20200601113720522.png)