> æ–‡ç« å¯ä»¥ç™½å«–ï¼Œå…¬ä¼—å·ä¸èƒ½ä¸å…³æ³¨ï¼Œæ‰‹åŠ¨æ»‘ç¨½ğŸ¤£ğŸ¤£ &nbsp;
>
> æ¬¢è¿å¤§å®¶å…³æ³¨ï¼š**æ­¦å“¥èŠç¼–ç¨‹**ã€**Javaå¼€å‘å®å…¸**ï¼Œæ‚¨çš„æ”¯æŒï¼Œæ˜¯æˆ‘ä»¬åˆ›ä½œçš„æŒç»­åŠ¨åŠ›ï¼&nbsp;&nbsp;

![æ­¦å“¥èŠç¼–ç¨‹](https://img-blog.csdnimg.cn/202002150421550.jpg)![Javaå¼€å‘å®å…¸](https://img-blog.csdnimg.cn/20200608005630228.png)
----

## 1. MyBatis ä»‹ç»

å¤§å®¶éƒ½çŸ¥é“ï¼ŒMyBatis æ¡†æ¶æ˜¯ä¸€ä¸ªæŒä¹…å±‚æ¡†æ¶ï¼Œæ˜¯ Apache ä¸‹çš„é¡¶çº§é¡¹ç›®ã€‚Mybatis å¯ä»¥è®©å¼€å‘è€…çš„ä¸»è¦ç²¾åŠ›æ”¾åœ¨ sql ä¸Šï¼Œé€šè¿‡ Mybatis æä¾›çš„æ˜ å°„æ–¹å¼ï¼Œè‡ªç”±çµæ´»çš„ç”Ÿæˆæ»¡è¶³éœ€è¦çš„ sql è¯­å¥ã€‚ä½¿ç”¨ç®€å•çš„ XML æˆ–æ³¨è§£æ¥é…ç½®å’Œæ˜ å°„åŸç”Ÿä¿¡æ¯ï¼Œå°†æ¥å£å’Œ Java çš„ POJOs æ˜ å°„æˆæ•°æ®åº“ä¸­çš„è®°å½•ï¼Œåœ¨å›½å†…å¯è°“æ˜¯å æ®äº†åŠå£æ±Ÿå±±ã€‚æœ¬èŠ‚è¯¾ç¨‹ä¸»è¦é€šè¿‡ä¸¤ç§æ–¹å¼æ¥å¯¹ Spring Boot é›†æˆ MyBatis åšä¸€è®²è§£ã€‚é‡ç‚¹è®²è§£ä¸€ä¸‹åŸºäºæ³¨è§£çš„æ–¹å¼ã€‚å› ä¸ºå®é™…é¡¹ç›®ä¸­ä½¿ç”¨æ³¨è§£çš„æ–¹å¼æ›´å¤šä¸€ç‚¹ï¼Œæ›´ç®€æ´ä¸€ç‚¹ï¼Œçœå»äº†å¾ˆå¤š xml é…ç½®ï¼ˆè¿™ä¸æ˜¯ç»å¯¹çš„ï¼Œæœ‰äº›é¡¹ç›®ç»„ä¸­å¯èƒ½ä¹Ÿåœ¨ä½¿ç”¨ xml çš„æ–¹å¼ï¼‰ã€‚

## 2. MyBatis çš„é…ç½®

## 2.1 ä¾èµ–å¯¼å…¥

Spring Boot é›†æˆ MyBatisï¼Œéœ€è¦å¯¼å…¥ `mybatis-spring-boot-starter` å’Œ mysql çš„ä¾èµ–ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨çš„ç‰ˆæœ¬æ—¶ 1.3.2ï¼Œå¦‚ä¸‹ï¼š
```xml
<dependency>
	<groupId>org.mybatis.spring.boot</groupId>
	<artifactId>mybatis-spring-boot-starter</artifactId>
	<version>1.3.2</version>
</dependency>
<dependency>
	<groupId>mysql</groupId>
	<artifactId>mysql-connector-java</artifactId>
	<scope>runtime</scope>
</dependency>
```
æˆ‘ä»¬ç‚¹å¼€ `mybatis-spring-boot-starter` ä¾èµ–ï¼Œå¯ä»¥çœ‹åˆ°æˆ‘ä»¬ä¹‹å‰ä½¿ç”¨ Spring æ—¶å€™ç†Ÿæ‚‰çš„ä¾èµ–ï¼Œå°±åƒæˆ‘åœ¨è¯¾ç¨‹çš„ä¸€å¼€å§‹ä»‹ç»çš„é‚£æ ·ï¼ŒSpring Boot è‡´åŠ›äºç®€åŒ–ç¼–ç ï¼Œä½¿ç”¨ starter ç³»åˆ—å°†ç›¸å…³ä¾èµ–é›†æˆåœ¨ä¸€èµ·ï¼Œå¼€å‘è€…ä¸éœ€è¦å…³æ³¨ç¹ççš„é…ç½®ï¼Œéå¸¸æ–¹ä¾¿ã€‚
```xml
<!-- çœå»å…¶ä»– -->
<dependency>
    <groupId>org.mybatis</groupId>
    <artifactId>mybatis</artifactId>
</dependency>
<dependency>
    <groupId>org.mybatis</groupId>
    <artifactId>mybatis-spring</artifactId>
</dependency>
```

## 2.2 properties.ymlé…ç½®

æˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸‹ï¼Œé›†æˆ MyBatis æ—¶éœ€è¦åœ¨ properties.yml é…ç½®æ–‡ä»¶ä¸­åšå“ªäº›åŸºæœ¬é…ç½®å‘¢ï¼Ÿ

```xml
# æœåŠ¡ç«¯å£å·
server:
  port: 8080

# æ•°æ®åº“åœ°å€
datasource:
  url: localhost:3306/blog_test

spring:
  datasource: # æ•°æ®åº“é…ç½®
    driver-class-name: com.mysql.jdbc.Driver
    url: jdbc:mysql://${datasource.url}?useSSL=false&useUnicode=true&characterEncoding=utf-8&allowMultiQueries=true&autoReconnect=true&failOverReadOnly=false&maxReconnects=10
    username: root
    password: 123456
    hikari:
      maximum-pool-size: 10 # æœ€å¤§è¿æ¥æ± æ•°
      max-lifetime: 1770000

mybatis:
  # æŒ‡å®šåˆ«åè®¾ç½®çš„åŒ…ä¸ºæ‰€æœ‰entity
  type-aliases-package: com.itcodai.course10.entity
  configuration:
    map-underscore-to-camel-case: true # é©¼å³°å‘½åè§„èŒƒ
  mapper-locations: # mapperæ˜ å°„æ–‡ä»¶ä½ç½®
    - classpath:mapper/*.xml
```
æˆ‘ä»¬æ¥ç®€å•ä»‹ç»ä¸€ä¸‹ä¸Šé¢çš„è¿™äº›é…ç½®ï¼šå…³äºæ•°æ®åº“çš„ç›¸å…³é…ç½®ï¼Œæˆ‘å°±ä¸è¯¦ç»†çš„è§£è¯´äº†ï¼Œè¿™ç‚¹ç›¸ä¿¡å¤§å®¶å·²ç»éå¸¸ç†Ÿç»ƒäº†ï¼Œé…ç½®ä¸€ä¸‹ç”¨æˆ·åã€å¯†ç ã€æ•°æ®åº“è¿æ¥ç­‰ç­‰ï¼Œè¿™é‡Œä½¿ç”¨çš„è¿æ¥æ± æ˜¯ Spring Boot è‡ªå¸¦çš„ hikariï¼Œæ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥å»ç™¾åº¦æˆ–è€…è°·æ­Œæœä¸€æœï¼Œäº†è§£ä¸€ä¸‹ã€‚  

è¿™é‡Œè¯´æ˜ä¸€ä¸‹ `map-underscore-to-camel-case: true`ï¼Œ ç”¨æ¥å¼€å¯é©¼å³°å‘½åè§„èŒƒï¼Œè¿™ä¸ªæ¯”è¾ƒå¥½ç”¨ï¼Œæ¯”å¦‚æ•°æ®åº“ä¸­å­—æ®µåä¸ºï¼š`user_name`ï¼Œ é‚£ä¹ˆåœ¨å®ä½“ç±»ä¸­å¯ä»¥å®šä¹‰å±æ€§ä¸º `userName` ï¼ˆç”šè‡³å¯ä»¥å†™æˆ `username`ï¼Œä¹Ÿèƒ½æ˜ å°„ä¸Šï¼‰ï¼Œä¼šè‡ªåŠ¨åŒ¹é…åˆ°é©¼å³°å±æ€§ï¼Œå¦‚æœä¸è¿™æ ·é…ç½®çš„è¯ï¼Œé’ˆå¯¹å­—æ®µåå’Œå±æ€§åä¸åŒçš„æƒ…å†µï¼Œä¼šæ˜ å°„ä¸åˆ°ã€‚

## 3. åŸºäº xml çš„æ•´åˆ

ä½¿ç”¨åŸå§‹çš„ xml æ–¹å¼ï¼Œéœ€è¦æ–°å»º UserMapper.xml æ–‡ä»¶ï¼Œåœ¨ä¸Šé¢çš„ application.yml é…ç½®æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬å·²ç»å®šä¹‰äº† xml æ–‡ä»¶çš„è·¯å¾„ï¼š`classpath:mapper/*.xml`ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨ resources ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ª mapper æ–‡ä»¶å¤¹ï¼Œç„¶ååˆ›å»ºä¸€ä¸ª UserMapper.xml æ–‡ä»¶ã€‚
```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.itcodai.course10.dao.UserMapper">
  <resultMap id="BaseResultMap" type="com.itcodai.course10.entity.User">

    <id column="id" jdbcType="BIGINT" property="id" />
    <result column="user_name" jdbcType="VARCHAR" property="username" />
    <result column="password" jdbcType="VARCHAR" property="password" />
  </resultMap>
  
   <select id="getUserByName" resultType="User" parameterType="String">
       select * from user where user_name = #{username}
  </select>
</mapper>
```
è¿™å’Œæ•´åˆ Spring ä¸€æ ·çš„ï¼Œnamespace ä¸­æŒ‡å®šçš„æ˜¯å¯¹åº”çš„ Mapperï¼Œ `<resultMap>` ä¸­æŒ‡å®šå¯¹åº”çš„å®ä½“ç±»ï¼Œå³ Userã€‚ç„¶ååœ¨å†…éƒ¨æŒ‡å®šè¡¨çš„å­—æ®µå’Œå®ä½“çš„å±æ€§ç›¸å¯¹åº”å³å¯ã€‚è¿™é‡Œæˆ‘ä»¬å†™ä¸€ä¸ªæ ¹æ®ç”¨æˆ·åæŸ¥è¯¢ç”¨æˆ·çš„ sqlã€‚  

å®ä½“ç±»ä¸­æœ‰ idï¼Œusername å’Œ passwordï¼Œæˆ‘ä¸åœ¨è¿™è´´ä»£ç ï¼Œå¤§å®¶å¯ä»¥ä¸‹è½½æºç æŸ¥çœ‹ã€‚UserMapper.java æ–‡ä»¶ä¸­å†™ä¸€ä¸ªæ¥å£å³å¯ï¼š
```java
User getUserByName(String username);
```

ä¸­é—´çœç•¥ service çš„ä»£ç ï¼Œæˆ‘ä»¬å†™ä¸€ä¸ª Controller æ¥æµ‹è¯•ä¸€ä¸‹ï¼š
```java
@RestController
public class TestController {

    @Resource
    private UserService userService;
    
    @RequestMapping("/getUserByName/{name}")
    public User getUserByName(@PathVariable String name) {
        return userService.getUserByName(name);
    }
}
```
å¯åŠ¨é¡¹ç›®ï¼Œåœ¨æµè§ˆå™¨ä¸­è¾“å…¥ï¼š`http://localhost:8080/getUserByName/CSDN` å³å¯æŸ¥è¯¢åˆ°æ•°æ®åº“è¡¨ä¸­ç”¨æˆ·åä¸º CSDN çš„ç”¨æˆ·ä¿¡æ¯ï¼ˆäº‹å…ˆæä¸¤ä¸ªæ•°æ®è¿›å»å³å¯ï¼‰ï¼š
```json
{"id":2,"username":"CSDN","password":"123456"}
```
è¿™é‡Œéœ€è¦æ³¨æ„ä¸€ä¸‹ï¼šSpring Boot å¦‚ä½•çŸ¥é“è¿™ä¸ª Mapper å‘¢ï¼Ÿä¸€ç§æ–¹æ³•æ˜¯åœ¨ä¸Šé¢çš„ mapper å±‚å¯¹åº”çš„ç±»ä¸Šé¢æ·»åŠ  `@Mapper` æ³¨è§£å³å¯ï¼Œä½†æ˜¯è¿™ç§æ–¹æ³•æœ‰ä¸ªå¼Šç«¯ï¼Œå½“æˆ‘ä»¬æœ‰å¾ˆå¤šä¸ª mapper æ—¶ï¼Œé‚£ä¹ˆæ¯ä¸€ä¸ªç±»ä¸Šé¢éƒ½å¾—æ·»åŠ  `@Mapper` æ³¨è§£ã€‚å¦ä¸€ç§æ¯”è¾ƒç®€ä¾¿çš„æ–¹æ³•æ˜¯åœ¨ Spring Boot å¯åŠ¨ç±»ä¸Šæ·»åŠ `@MaperScan` æ³¨è§£ï¼Œæ¥æ‰«æä¸€ä¸ªåŒ…ä¸‹çš„æ‰€æœ‰ mapperã€‚å¦‚ä¸‹ï¼š
```java
@SpringBootApplication
@MapperScan("com.itcodai.course10.dao")
public class Course10Application {

	public static void main(String[] args) {
		SpringApplication.run(Course10Application.class, args);
	}
}
```
è¿™æ ·çš„è¯ï¼Œ`com.itcodai.course10.dao` åŒ…ä¸‹çš„æ‰€æœ‰ mapper éƒ½ä¼šè¢«æ‰«æåˆ°äº†ã€‚

## 4. åŸºäºæ³¨è§£çš„æ•´åˆ

åŸºäºæ³¨è§£çš„æ•´åˆå°±ä¸éœ€è¦ xml é…ç½®æ–‡ä»¶äº†ï¼ŒMyBatis ä¸»è¦æä¾›äº† `@Select`ï¼Œ `@Insert`ï¼Œ `@Update`ï¼Œ `Delete` å››ä¸ªæ³¨è§£ã€‚è¿™å››ä¸ªæ³¨è§£æ˜¯ç”¨çš„éå¸¸å¤šçš„ï¼Œä¹Ÿå¾ˆç®€å•ï¼Œæ³¨è§£åé¢è·Ÿä¸Šå¯¹åº”çš„ sql è¯­å¥å³å¯ï¼Œæˆ‘ä»¬ä¸¾ä¸ªä¾‹å­ï¼š
```java
@Select("select * from user where id = #{id}")
User getUser(Long id);
```
è¿™è·Ÿ xml æ–‡ä»¶ä¸­å†™ sql è¯­å¥æ˜¯ä¸€æ ·çš„ï¼Œè¿™æ ·å°±ä¸éœ€è¦ xml æ–‡ä»¶äº†ï¼Œä½†æ˜¯æœ‰ä¸ªé—®é¢˜ï¼Œæœ‰äººå¯èƒ½ä¼šé—®ï¼Œå¦‚æœæ˜¯ä¸¤ä¸ªå‚æ•°å‘¢ï¼Ÿå¦‚æœæ˜¯ä¸¤ä¸ªå‚æ•°ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ `@Param` æ³¨è§£æ¥æŒ‡å®šæ¯ä¸€ä¸ªå‚æ•°çš„å¯¹åº”å…³ç³»ï¼Œå¦‚ä¸‹ï¼š
```java
@Select("select * from user where id = #{id} and user_name=#{name}")
User getUserByIdAndName(@Param("id") Long id, @Param("name") String username);
```
å¯ä»¥çœ‹å‡ºï¼Œ`@Param` æŒ‡å®šçš„å‚æ•°åº”è¯¥è¦å’Œ sql ä¸­ `#{}` å–çš„å‚æ•°åç›¸åŒï¼Œä¸åŒåˆ™å–ä¸åˆ°ã€‚å¯ä»¥åœ¨ controller ä¸­è‡ªè¡Œæµ‹è¯•ä¸€ä¸‹ï¼Œæ¥å£éƒ½åœ¨æºç ä¸­ï¼Œæ–‡ç« ä¸­æˆ‘å°±ä¸è´´æµ‹è¯•ä»£ç å’Œç»“æœäº†ã€‚  

æœ‰ä¸ªé—®é¢˜éœ€è¦æ³¨æ„ä¸€ä¸‹ï¼Œä¸€èˆ¬æˆ‘ä»¬åœ¨è®¾è®¡è¡¨å­—æ®µåï¼Œéƒ½ä¼šæ ¹æ®è‡ªåŠ¨ç”Ÿæˆå·¥å…·ç”Ÿæˆå®ä½“ç±»ï¼Œè¿™æ ·çš„è¯ï¼ŒåŸºæœ¬ä¸Šå®ä½“ç±»æ˜¯èƒ½å’Œè¡¨å­—æ®µå¯¹åº”ä¸Šçš„ï¼Œæœ€èµ·ç ä¹Ÿæ˜¯é©¼å³°å¯¹åº”çš„ï¼Œç”±äºåœ¨ä¸Šé¢é…ç½®æ–‡ä»¶ä¸­å¼€å¯äº†é©¼å³°çš„é…ç½®ï¼Œæ‰€ä»¥å­—æ®µéƒ½æ˜¯èƒ½å¯¹çš„ä¸Šçš„ã€‚ä½†æ˜¯ï¼Œä¸‡ä¸€æœ‰å¯¹ä¸ä¸Šçš„å‘¢ï¼Ÿæˆ‘ä»¬ä¹Ÿæœ‰è§£å†³åŠæ³•ï¼Œä½¿ç”¨ `@Results` æ³¨è§£æ¥è§£å†³ã€‚
```java
@Select("select * from user where id = #{id}")
@Results({
        @Result(property = "username", column = "user_name"),
        @Result(property = "password", column = "password")
})
User getUser(Long id);
```
`@Results` ä¸­çš„ `@Result` æ³¨è§£æ˜¯ç”¨æ¥æŒ‡å®šæ¯ä¸€ä¸ªå±æ€§å’Œå­—æ®µçš„å¯¹åº”å…³ç³»ï¼Œè¿™æ ·çš„è¯å°±å¯ä»¥è§£å†³ä¸Šé¢è¯´çš„è¿™ä¸ªé—®é¢˜äº†ã€‚  

å½“ç„¶äº†ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ xml å’Œæ³¨è§£ç›¸ç»“åˆä½¿ç”¨ï¼Œç›®å‰æˆ‘ä»¬å®é™…çš„é¡¹ç›®ä¸­ä¹Ÿæ˜¯é‡‡ç”¨æ··ç”¨çš„æ–¹å¼ï¼Œå› ä¸ºæœ‰æ—¶å€™ xml æ–¹ä¾¿ï¼Œæœ‰æ—¶å€™æ³¨è§£æ–¹ä¾¿ï¼Œæ¯”å¦‚å°±ä¸Šé¢è¿™ä¸ªé—®é¢˜æ¥è¯´ï¼Œå¦‚æœæˆ‘ä»¬å®šä¹‰äº†ä¸Šé¢çš„è¿™ä¸ª UserMapper.xmlï¼Œé‚£ä¹ˆæˆ‘ä»¬å®Œå…¨å¯ä»¥ä½¿ç”¨ `@ResultMap` æ³¨è§£æ¥æ›¿ä»£ `@Results` æ³¨è§£ï¼Œå¦‚ä¸‹ï¼š
```java
@Select("select * from user where id = #{id}")
@ResultMap("BaseResultMap")
User getUser(Long id);
```
`@ResultMap` æ³¨è§£ä¸­çš„å€¼ä»å“ªæ¥å‘¢ï¼Ÿå¯¹åº”çš„æ˜¯ UserMapper.xml æ–‡ä»¶ä¸­å®šä¹‰çš„ `<resultMap>` æ—¶å¯¹åº”çš„ id å€¼ï¼š
```xml
<resultMap id="BaseResultMap" type="com.itcodai.course10.entity.User">
```
è¿™ç§ xml å’Œæ³¨è§£ç»“åˆç€ä½¿ç”¨çš„æƒ…å†µä¹Ÿå¾ˆå¸¸è§ï¼Œè€Œä¸”ä¹Ÿå‡å°‘äº†å¤§é‡çš„ä»£ç ï¼Œå› ä¸º xml æ–‡ä»¶å¯ä»¥ä½¿ç”¨è‡ªåŠ¨ç”Ÿæˆå·¥å…·å»ç”Ÿæˆï¼Œä¹Ÿä¸éœ€è¦äººä¸ºæ‰‹åŠ¨æ•²ï¼Œæ‰€ä»¥è¿™ç§ä½¿ç”¨æ–¹å¼ä¹Ÿå¾ˆå¸¸è§ã€‚

## 5. æ€»ç»“

æœ¬èŠ‚è¯¾ä¸»è¦ç³»ç»Ÿçš„è®²è§£äº† Spring Boot é›†æˆ MyBatis çš„è¿‡ç¨‹ï¼Œåˆ†ä¸ºåŸºäº xml å½¢å¼å’ŒåŸºäºæ³¨è§£çš„å½¢å¼æ¥è®²è§£ï¼Œé€šè¿‡å®é™…é…ç½®æ‰‹æŠŠæ‰‹è®²è§£äº† Spring Boot ä¸­ MyBatis çš„ä½¿ç”¨æ–¹å¼ï¼Œå¹¶é’ˆå¯¹æ³¨è§£æ–¹å¼ï¼Œè®²è§£äº†å¸¸è§çš„é—®é¢˜å·²ç»è§£å†³æ–¹å¼ï¼Œæœ‰å¾ˆå¼ºçš„å®æˆ˜æ„ä¹‰ã€‚åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œå»ºè®®æ ¹æ®å®é™…æƒ…å†µæ¥ç¡®å®šä½¿ç”¨å“ªç§æ–¹å¼ï¼Œä¸€èˆ¬ xml å’Œæ³¨è§£éƒ½åœ¨ç”¨ã€‚

è¯¾ç¨‹æºä»£ç ä¸‹è½½åœ°å€ï¼š[æˆ³æˆ‘ä¸‹è½½](https://gitee.com/eson15/springboot_study)

----
> æ–‡ç« å¯ä»¥ç™½å«–ï¼Œå…¬ä¼—å·ä¸èƒ½ä¸å…³æ³¨ï¼Œæ‰‹åŠ¨æ»‘ç¨½ğŸ¤£ğŸ¤£ &nbsp;
>
> æ¬¢è¿å¤§å®¶å…³æ³¨ï¼š**æ­¦å“¥èŠç¼–ç¨‹**ã€**Javaå¼€å‘å®å…¸**ï¼Œæ‚¨çš„æ”¯æŒï¼Œæ˜¯æˆ‘ä»¬åˆ›ä½œçš„æŒç»­åŠ¨åŠ›ï¼&nbsp;&nbsp;

![æ­¦å“¥èŠç¼–ç¨‹](https://img-blog.csdnimg.cn/202002150421550.jpg)![Javaå¼€å‘å®å…¸](https://img-blog.csdnimg.cn/20200608005630228.png)

----