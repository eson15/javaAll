> æ–‡ç« å¯ä»¥ç™½å«–ï¼Œå…¬ä¼—å·ä¸èƒ½ä¸å…³æ³¨ï¼Œæ‰‹åŠ¨æ»‘ç¨½ğŸ¤£ğŸ¤£ &nbsp;
>
> æ¬¢è¿å¤§å®¶å…³æ³¨ï¼š**æ­¦å“¥èŠç¼–ç¨‹**ã€**Javaå¼€å‘å®å…¸**ï¼Œæ‚¨çš„æ”¯æŒï¼Œæ˜¯æˆ‘ä»¬åˆ›ä½œçš„æŒç»­åŠ¨åŠ›ï¼&nbsp;&nbsp;

![æ­¦å“¥èŠç¼–ç¨‹](https://img-blog.csdnimg.cn/202002150421550.jpg)![Javaå¼€å‘å®å…¸](https://img-blog.csdnimg.cn/20200608005630228.png)
----

## 1. ç›‘å¬å™¨ä»‹ç»

ä»€ä¹ˆæ˜¯ web ç›‘å¬å™¨ï¼Ÿweb ç›‘å¬å™¨æ˜¯ä¸€ç§ Servlet ä¸­ç‰¹æ®Šçš„ç±»ï¼Œå®ƒä»¬èƒ½å¸®åŠ©å¼€å‘è€…ç›‘å¬ web ä¸­ç‰¹å®šçš„äº‹ä»¶ï¼Œæ¯”å¦‚ ServletContext, HttpSession, ServletRequest çš„åˆ›å»ºå’Œé”€æ¯ï¼›å˜é‡çš„åˆ›å»ºã€é”€æ¯å’Œä¿®æ”¹ç­‰ã€‚å¯ä»¥åœ¨æŸäº›åŠ¨ä½œå‰åå¢åŠ å¤„ç†ï¼Œå®ç°ç›‘æ§ã€‚

## 2. Spring Bootä¸­ç›‘å¬å™¨çš„ä½¿ç”¨

web ç›‘å¬å™¨çš„ä½¿ç”¨åœºæ™¯å¾ˆå¤šï¼Œæ¯”å¦‚ç›‘å¬ servlet ä¸Šä¸‹æ–‡ç”¨æ¥åˆå§‹åŒ–ä¸€äº›æ•°æ®ã€ç›‘å¬ http session ç”¨æ¥è·å–å½“å‰åœ¨çº¿çš„äººæ•°ã€ç›‘å¬å®¢æˆ·ç«¯è¯·æ±‚çš„ servlet request å¯¹è±¡æ¥è·å–ç”¨æˆ·çš„è®¿é—®ä¿¡æ¯ç­‰ç­‰ã€‚è¿™ä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬ä¸»è¦é€šè¿‡è¿™ä¸‰ä¸ªå®é™…çš„ä½¿ç”¨åœºæ™¯æ¥å­¦ä¹ ä¸€ä¸‹ Spring Boot ä¸­ç›‘å¬å™¨çš„ä½¿ç”¨ã€‚

### 2.1 ç›‘å¬Servletä¸Šä¸‹æ–‡å¯¹è±¡

ç›‘å¬ servlet ä¸Šä¸‹æ–‡å¯¹è±¡å¯ä»¥ç”¨æ¥åˆå§‹åŒ–æ•°æ®ï¼Œç”¨äºç¼“å­˜ã€‚ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿæˆ‘ä¸¾ä¸€ä¸ªå¾ˆå¸¸è§çš„åœºæ™¯ï¼Œæ¯”å¦‚ç”¨æˆ·åœ¨ç‚¹å‡»æŸä¸ªç«™ç‚¹çš„é¦–é¡µæ—¶ï¼Œä¸€èˆ¬éƒ½ä¼šå±•ç°å‡ºé¦–é¡µçš„ä¸€äº›ä¿¡æ¯ï¼Œè€Œè¿™äº›ä¿¡æ¯åŸºæœ¬ä¸Šæˆ–è€…å¤§éƒ¨åˆ†æ—¶é—´éƒ½ä¿æŒä¸å˜çš„ï¼Œä½†æ˜¯è¿™äº›ä¿¡æ¯éƒ½æ˜¯æ¥è‡ªæ•°æ®åº“ã€‚å¦‚æœç”¨æˆ·çš„æ¯æ¬¡ç‚¹å‡»ï¼Œéƒ½è¦ä»æ•°æ®åº“ä¸­å»è·å–æ•°æ®çš„è¯ï¼Œç”¨æˆ·é‡å°‘è¿˜å¯ä»¥æ¥å—ï¼Œå¦‚æœç”¨æˆ·é‡éå¸¸å¤§çš„è¯ï¼Œè¿™å¯¹æ•°æ®åº“ä¹Ÿæ˜¯ä¸€ç¬”å¾ˆå¤§çš„å¼€é”€ã€‚  

é’ˆå¯¹è¿™ç§é¦–é¡µæ•°æ®ï¼Œå¤§éƒ¨åˆ†éƒ½ä¸å¸¸æ›´æ–°çš„è¯ï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥æŠŠå®ƒä»¬ç¼“å­˜èµ·æ¥ï¼Œæ¯æ¬¡ç”¨æˆ·ç‚¹å‡»çš„æ—¶å€™ï¼Œæˆ‘ä»¬éƒ½ç›´æ¥ä»ç¼“å­˜ä¸­æ‹¿ï¼Œè¿™æ ·æ—¢å¯ä»¥æé«˜é¦–é¡µçš„è®¿é—®é€Ÿåº¦ï¼Œåˆå¯ä»¥é™ä½æœåŠ¡å™¨çš„å‹åŠ›ã€‚å¦‚æœåšçš„æ›´åŠ çµæ´»ä¸€ç‚¹ï¼Œå¯ä»¥å†åŠ ä¸ªå®šæ—¶å™¨ï¼Œå®šæœŸçš„æ¥æ›´æ–°è¿™ä¸ªé¦–é¡µç¼“å­˜ã€‚å°±ç±»ä¼¼ä¸ CSDN ä¸ªäººåšå®¢é¦–é¡µä¸­æ’åçš„å˜åŒ–ä¸€æ ·ã€‚

ä¸‹é¢æˆ‘ä»¬é’ˆå¯¹è¿™ä¸ªåŠŸèƒ½ï¼Œæ¥å†™ä¸€ä¸ª demoï¼Œåœ¨å®é™…ä¸­ï¼Œè¯»è€…å¯ä»¥å®Œå…¨å¥—ç”¨è¯¥ä»£ç ï¼Œæ¥å®ç°è‡ªå·±é¡¹ç›®ä¸­çš„ç›¸å…³é€»è¾‘ã€‚é¦–å…ˆå†™ä¸€ä¸ª Serviceï¼Œæ¨¡æ‹Ÿä¸€ä¸‹ä»æ•°æ®åº“æŸ¥è¯¢æ•°æ®ï¼š
```java
@Service
public class UserService {

    /**
     * è·å–ç”¨æˆ·ä¿¡æ¯
     * @return
     */
    public User getUser() {
        // å®é™…ä¸­ä¼šæ ¹æ®å…·ä½“çš„ä¸šåŠ¡åœºæ™¯ï¼Œä»æ•°æ®åº“ä¸­æŸ¥è¯¢å¯¹åº”çš„ä¿¡æ¯
        return new User(1L, "å€ªå‡æ­¦", "123456");
    }
}
```
ç„¶åå†™ä¸€ä¸ªç›‘å¬å™¨ï¼Œå®ç° `ApplicationListener<ContextRefreshedEvent>` æ¥å£ï¼Œé‡å†™ `onApplicationEvent` æ–¹æ³•ï¼Œå°† ContextRefreshedEvent å¯¹è±¡ä¼ è¿›å»ã€‚å¦‚æœæˆ‘ä»¬æƒ³åœ¨åŠ è½½æˆ–åˆ·æ–°åº”ç”¨ä¸Šä¸‹æ–‡æ—¶ï¼Œä¹Ÿé‡æ–°åˆ·æ–°ä¸‹æˆ‘ä»¬é¢„åŠ è½½çš„èµ„æºï¼Œå°±å¯ä»¥é€šè¿‡ç›‘å¬ ContextRefreshedEvent æ¥åšè¿™æ ·çš„äº‹æƒ…ã€‚å¦‚ä¸‹ï¼š
```java
/**
 * ä½¿ç”¨ApplicationListeneræ¥åˆå§‹åŒ–ä¸€äº›æ•°æ®åˆ°applicationåŸŸä¸­çš„ç›‘å¬å™¨
 * @author shengni ni
 * @date 2018/07/05
 */
@Component
public class MyServletContextListener implements ApplicationListener<ContextRefreshedEvent> {

    @Override
    public void onApplicationEvent(ContextRefreshedEvent contextRefreshedEvent) {
        // å…ˆè·å–åˆ°applicationä¸Šä¸‹æ–‡
        ApplicationContext applicationContext = contextRefreshedEvent.getApplicationContext();
        // è·å–å¯¹åº”çš„service
        UserService userService = applicationContext.getBean(UserService.class);
        User user = userService.getUser();
        // è·å–applicationåŸŸå¯¹è±¡ï¼Œå°†æŸ¥åˆ°çš„ä¿¡æ¯æ”¾åˆ°applicationåŸŸä¸­
        ServletContext application = applicationContext.getBean(ServletContext.class);
        application.setAttribute("user", user);
    }
}
```
æ­£å¦‚æ³¨é‡Šä¸­æè¿°çš„ä¸€æ ·ï¼Œé¦–å…ˆé€šè¿‡ contextRefreshedEvent æ¥è·å– application ä¸Šä¸‹æ–‡ï¼Œå†é€šè¿‡ application ä¸Šä¸‹æ–‡æ¥è·å– UserService è¿™ä¸ª beanï¼Œé¡¹ç›®ä¸­å¯ä»¥æ ¹æ®å®é™…ä¸šåŠ¡åœºæ™¯ï¼Œä¹Ÿå¯ä»¥è·å–å…¶ä»–çš„ beanï¼Œç„¶åå†è°ƒç”¨è‡ªå·±çš„ä¸šåŠ¡ä»£ç è·å–ç›¸åº”çš„æ•°æ®ï¼Œæœ€åå­˜å‚¨åˆ° application åŸŸä¸­ï¼Œè¿™æ ·å‰ç«¯åœ¨è¯·æ±‚ç›¸åº”æ•°æ®çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç›´æ¥ä» application åŸŸä¸­è·å–ä¿¡æ¯ï¼Œå‡å°‘æ•°æ®åº“çš„å‹åŠ›ã€‚ä¸‹é¢å†™ä¸€ä¸ª Controller ç›´æ¥ä» application åŸŸä¸­è·å– user ä¿¡æ¯æ¥æµ‹è¯•ä¸€ä¸‹ã€‚
```java
@RestController
@RequestMapping("/listener")
public class TestController {

    @GetMapping("/user")
    public User getUser(HttpServletRequest request) {
        ServletContext application = request.getServletContext();
        return (User) application.getAttribute("user");
    }
}
```
å¯åŠ¨é¡¹ç›®ï¼Œåœ¨æµè§ˆå™¨ä¸­è¾“å…¥ `http://localhost:8080/listener/user` æµ‹è¯•ä¸€ä¸‹å³å¯ï¼Œå¦‚æœæ­£å¸¸è¿”å› user ä¿¡æ¯ï¼Œé‚£ä¹ˆè¯´æ˜æ•°æ®å·²ç»ç¼“å­˜æˆåŠŸã€‚ä¸è¿‡ application è¿™ç§æ˜¯ç¼“å­˜åœ¨å†…å­˜ä¸­ï¼Œå¯¹å†…å­˜ä¼šæœ‰æ¶ˆè€—ï¼Œåé¢çš„è¯¾ç¨‹ä¸­æˆ‘ä¼šè®²åˆ° redisï¼Œåˆ°æ—¶å€™å†ç»™å¤§å®¶ä»‹ç»ä¸€ä¸‹ redis çš„ç¼“å­˜ã€‚

### 2.2 ç›‘å¬HTTPä¼šè¯ Sessionå¯¹è±¡

ç›‘å¬å™¨è¿˜æœ‰ä¸€ä¸ªæ¯”è¾ƒå¸¸ç”¨çš„åœ°æ–¹å°±æ˜¯ç”¨æ¥ç›‘å¬ session å¯¹è±¡ï¼Œæ¥è·å–åœ¨çº¿ç”¨æˆ·æ•°é‡ï¼Œç°åœ¨æœ‰å¾ˆå¤šå¼€å‘è€…éƒ½æœ‰è‡ªå·±çš„ç½‘ç«™ï¼Œç›‘å¬ session æ¥è·å–å½“å‰åœ¨ä¸‹ç”¨æˆ·æ•°é‡æ˜¯ä¸ªå¾ˆå¸¸è§çš„ä½¿ç”¨åœºæ™¯ï¼Œä¸‹é¢æ¥ä»‹ç»ä¸€ä¸‹å¦‚ä½•æ¥ä½¿ç”¨ã€‚
```java
/**
 * ä½¿ç”¨HttpSessionListenerç»Ÿè®¡åœ¨çº¿ç”¨æˆ·æ•°çš„ç›‘å¬å™¨
 * @author shengwu ni
 * @date 2018/07/05
 */
@Component
public class MyHttpSessionListener implements HttpSessionListener {

    private static final Logger logger = LoggerFactory.getLogger(MyHttpSessionListener.class);

    /**
     * è®°å½•åœ¨çº¿çš„ç”¨æˆ·æ•°é‡
     */
    public Integer count = 0;

    @Override
    public synchronized void sessionCreated(HttpSessionEvent httpSessionEvent) {
        logger.info("æ–°ç”¨æˆ·ä¸Šçº¿äº†");
        count++;
        httpSessionEvent.getSession().getServletContext().setAttribute("count", count);
    }

    @Override
    public synchronized void sessionDestroyed(HttpSessionEvent httpSessionEvent) {
        logger.info("ç”¨æˆ·ä¸‹çº¿äº†");
        count--;
        httpSessionEvent.getSession().getServletContext().setAttribute("count", count);
    }
}
```
å¯ä»¥çœ‹å‡ºï¼Œé¦–å…ˆè¯¥ç›‘å¬å™¨éœ€è¦å®ç° HttpSessionListener æ¥å£ï¼Œç„¶åé‡å†™ `sessionCreated` å’Œ `sessionDestroyed` æ–¹æ³•ï¼Œåœ¨ `sessionCreated` æ–¹æ³•ä¸­ä¼ é€’ä¸€ä¸ª HttpSessionEvent å¯¹è±¡ï¼Œç„¶åå°†å½“å‰ session ä¸­çš„ç”¨æˆ·æ•°é‡åŠ 1ï¼Œ`sessionDestroyed` æ–¹æ³•åˆšå¥½ç›¸åï¼Œä¸å†èµ˜è¿°ã€‚ç„¶åæˆ‘ä»¬å†™ä¸€ä¸ª Controller æ¥æµ‹è¯•ä¸€ä¸‹ã€‚
```java
@RestController
@RequestMapping("/listener")
public class TestController {

    /**
     * è·å–å½“å‰åœ¨çº¿äººæ•°ï¼Œè¯¥æ–¹æ³•æœ‰bug
     * @param request
     * @return
     */
    @GetMapping("/total")
    public String getTotalUser(HttpServletRequest request) {
        Integer count = (Integer) request.getSession().getServletContext().getAttribute("count");
        return "å½“å‰åœ¨çº¿äººæ•°ï¼š" + count;
    }
}
```
è¯¥ Controller ä¸­æ˜¯ç›´æ¥è·å–å½“å‰ session ä¸­çš„ç”¨æˆ·æ•°é‡ï¼Œå¯åŠ¨æœåŠ¡å™¨ï¼Œåœ¨æµè§ˆå™¨ä¸­è¾“å…¥ `localhost:8080/listener/total` å¯ä»¥çœ‹åˆ°è¿”å›çš„ç»“æœæ˜¯1ï¼Œå†æ‰“å¼€ä¸€ä¸ªæµè§ˆå™¨ï¼Œè¯·æ±‚ç›¸åŒçš„åœ°å€å¯ä»¥çœ‹åˆ° count æ˜¯ 2 ï¼Œè¿™æ²¡æœ‰é—®é¢˜ã€‚ä½†æ˜¯å¦‚æœå…³é—­ä¸€ä¸ªæµè§ˆå™¨å†æ‰“å¼€ï¼Œç†è®ºä¸Šåº”è¯¥è¿˜æ˜¯2ï¼Œä½†æ˜¯å®é™…æµ‹è¯•å´æ˜¯ 3ã€‚åŸå› æ˜¯ session é”€æ¯çš„æ–¹æ³•æ²¡æœ‰æ‰§è¡Œï¼ˆå¯ä»¥åœ¨åå°æ§åˆ¶å°è§‚å¯Ÿæ—¥å¿—æ‰“å°æƒ…å†µï¼‰ï¼Œå½“é‡æ–°æ‰“å¼€æ—¶ï¼ŒæœåŠ¡å™¨æ‰¾ä¸åˆ°ç”¨æˆ·åŸæ¥çš„ sessionï¼Œäºæ˜¯åˆé‡æ–°åˆ›å»ºäº†ä¸€ä¸ª sessionï¼Œé‚£æ€ä¹ˆè§£å†³è¯¥é—®é¢˜å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥å°†ä¸Šé¢çš„ Controller æ–¹æ³•æ”¹é€ ä¸€ä¸‹ï¼š
```java
@GetMapping("/total2")
public String getTotalUser(HttpServletRequest request, HttpServletResponse response) {
    Cookie cookie;
    try {
        // æŠŠsessionIdè®°å½•åœ¨æµè§ˆå™¨ä¸­
        cookie = new Cookie("JSESSIONID", URLEncoder.encode(request.getSession().getId(), "utf-8"));
        cookie.setPath("/");
        //è®¾ç½®cookieæœ‰æ•ˆæœŸä¸º2å¤©ï¼Œè®¾ç½®é•¿ä¸€ç‚¹
        cookie.setMaxAge( 48*60 * 60);
        response.addCookie(cookie);
    } catch (UnsupportedEncodingException e) {
        e.printStackTrace();
    }
    Integer count = (Integer) request.getSession().getServletContext().getAttribute("count");
    return "å½“å‰åœ¨çº¿äººæ•°ï¼š" + count;
}
```
å¯ä»¥çœ‹å‡ºï¼Œè¯¥å¤„ç†é€»è¾‘æ˜¯è®©æœåŠ¡å™¨è®°å¾—åŸæ¥é‚£ä¸ª sessionï¼Œå³æŠŠåŸæ¥çš„ sessionId è®°å½•åœ¨æµè§ˆå™¨ä¸­ï¼Œä¸‹æ¬¡å†æ‰“å¼€æ—¶ï¼ŒæŠŠè¿™ä¸ª sessionId ä¼ è¿‡å»ï¼Œè¿™æ ·æœåŠ¡å™¨å°±ä¸ä¼šé‡æ–°å†åˆ›å»ºäº†ã€‚é‡å¯ä¸€ä¸‹æœåŠ¡å™¨ï¼Œåœ¨æµè§ˆå™¨ä¸­å†æ¬¡æµ‹è¯•ä¸€ä¸‹ï¼Œå³å¯é¿å…ä¸Šé¢çš„é—®é¢˜ã€‚

### 2.3 ç›‘å¬å®¢æˆ·ç«¯è¯·æ±‚Servlet Requestå¯¹è±¡

ä½¿ç”¨ç›‘å¬å™¨è·å–ç”¨æˆ·çš„è®¿é—®ä¿¡æ¯æ¯”è¾ƒç®€å•ï¼Œå®ç° ServletRequestListener æ¥å£å³å¯ï¼Œç„¶åé€šè¿‡ request å¯¹è±¡è·å–ä¸€äº›ä¿¡æ¯ã€‚å¦‚ä¸‹ï¼š

```java
/**
 * ä½¿ç”¨ServletRequestListenerè·å–è®¿é—®ä¿¡æ¯
 * @author shengwu ni
 * @date 2018/07/05
 */
@Component
public class MyServletRequestListener implements ServletRequestListener {

    private static final Logger logger = LoggerFactory.getLogger(MyServletRequestListener.class);

    @Override
    public void requestInitialized(ServletRequestEvent servletRequestEvent) {
        HttpServletRequest request = (HttpServletRequest) servletRequestEvent.getServletRequest();
        logger.info("session idä¸ºï¼š{}", request.getRequestedSessionId());
        logger.info("request urlä¸ºï¼š{}", request.getRequestURL());

        request.setAttribute("name", "å€ªå‡æ­¦");
    }

    @Override
    public void requestDestroyed(ServletRequestEvent servletRequestEvent) {

        logger.info("request end");
        HttpServletRequest request = (HttpServletRequest) servletRequestEvent.getServletRequest();
        logger.info("requeståŸŸä¸­ä¿å­˜çš„nameå€¼ä¸ºï¼š{}", request.getAttribute("name"));

    }

}
```
è¿™ä¸ªæ¯”è¾ƒç®€å•ï¼Œä¸å†èµ˜è¿°ï¼Œæ¥ä¸‹æ¥å†™ä¸€ä¸ª Controller æµ‹è¯•ä¸€ä¸‹å³å¯ã€‚
```java
@GetMapping("/request")
public String getRequestInfo(HttpServletRequest request) {
    System.out.println("requestListenerä¸­çš„åˆå§‹åŒ–çš„nameæ•°æ®ï¼š" + request.getAttribute("name"));
    return "success";
}
```

## 3. Spring Bootä¸­è‡ªå®šä¹‰äº‹ä»¶ç›‘å¬

åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬å¾€å¾€éœ€è¦è‡ªå®šä¹‰ä¸€äº›äº‹ä»¶å’Œç›‘å¬å™¨æ¥æ»¡è¶³ä¸šåŠ¡åœºæ™¯ï¼Œæ¯”å¦‚åœ¨å¾®æœåŠ¡ä¸­ä¼šæœ‰è¿™æ ·çš„åœºæ™¯ï¼šå¾®æœåŠ¡ A åœ¨å¤„ç†å®ŒæŸä¸ªé€»è¾‘ä¹‹åï¼Œéœ€è¦é€šçŸ¥å¾®æœåŠ¡ B å»å¤„ç†å¦ä¸€ä¸ªé€»è¾‘ï¼Œæˆ–è€…å¾®æœåŠ¡ A å¤„ç†å®ŒæŸä¸ªé€»è¾‘ä¹‹åï¼Œéœ€è¦å°†æ•°æ®åŒæ­¥åˆ°å¾®æœåŠ¡ Bï¼Œè¿™ç§åœºæ™¯éå¸¸æ™®éï¼Œè¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰äº‹ä»¶ä»¥åŠç›‘å¬å™¨æ¥ç›‘å¬ï¼Œä¸€æ—¦ç›‘å¬åˆ°å¾®æœåŠ¡ A ä¸­çš„æŸäº‹ä»¶å‘ç”Ÿï¼Œå°±å»é€šçŸ¥å¾®æœåŠ¡ B å¤„ç†å¯¹åº”çš„é€»è¾‘ã€‚

### 3.1 è‡ªå®šä¹‰äº‹ä»¶

è‡ªå®šä¹‰äº‹ä»¶éœ€è¦ç»§æ‰¿ ApplicationEvent å¯¹è±¡ï¼Œåœ¨äº‹ä»¶ä¸­å®šä¹‰ä¸€ä¸ª User å¯¹è±¡æ¥æ¨¡æ‹Ÿæ•°æ®ï¼Œæ„é€ æ–¹æ³•ä¸­å°† User å¯¹è±¡ä¼ è¿›æ¥åˆå§‹åŒ–ã€‚å¦‚ä¸‹ï¼š

```java
/**
 * è‡ªå®šä¹‰äº‹ä»¶
 * @author shengwu ni
 * @date 2018/07/05
 */
public class MyEvent extends ApplicationEvent {

    private User user;

    public MyEvent(Object source, User user) {
        super(source);
        this.user = user;
    }

    // çœå»getã€setæ–¹æ³•
}
```

### 3.2 è‡ªå®šä¹‰ç›‘å¬å™¨

æ¥ä¸‹æ¥ï¼Œè‡ªå®šä¹‰ä¸€ä¸ªç›‘å¬å™¨æ¥ç›‘å¬ä¸Šé¢å®šä¹‰çš„ MyEvent äº‹ä»¶ï¼Œè‡ªå®šä¹‰ç›‘å¬å™¨éœ€è¦å®ç° `ApplicationListener` æ¥å£å³å¯ã€‚å¦‚ä¸‹ï¼š

```java
/**
 * è‡ªå®šä¹‰ç›‘å¬å™¨ï¼Œç›‘å¬MyEventäº‹ä»¶
 * @author shengwu ni
 * @date 2018/07/05
 */
@Component
public class MyEventListener implements ApplicationListener<MyEvent> {
    @Override
    public void onApplicationEvent(MyEvent myEvent) {
        // æŠŠäº‹ä»¶ä¸­çš„ä¿¡æ¯è·å–åˆ°
        User user = myEvent.getUser();
        // å¤„ç†äº‹ä»¶ï¼Œå®é™…é¡¹ç›®ä¸­å¯ä»¥é€šçŸ¥åˆ«çš„å¾®æœåŠ¡æˆ–è€…å¤„ç†å…¶ä»–é€»è¾‘ç­‰ç­‰
        System.out.println("ç”¨æˆ·åï¼š" + user.getUsername());
        System.out.println("å¯†ç ï¼š" + user.getPassword());

    }
}
```
ç„¶åé‡å†™ `onApplicationEvent` æ–¹æ³•ï¼Œå°†è‡ªå®šä¹‰çš„ MyEvent äº‹ä»¶ä¼ è¿›æ¥ï¼Œå› ä¸ºè¯¥äº‹ä»¶ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº† User å¯¹è±¡ï¼ˆè¯¥å¯¹è±¡åœ¨å®é™…ä¸­å°±æ˜¯éœ€è¦å¤„ç†çš„æ•°æ®ï¼Œåœ¨ä¸‹æ–‡æ¥æ¨¡æ‹Ÿï¼‰ï¼Œç„¶åå°±å¯ä»¥ä½¿ç”¨è¯¥å¯¹è±¡çš„ä¿¡æ¯äº†ã€‚

OKï¼Œå®šä¹‰å¥½äº†äº‹ä»¶å’Œç›‘å¬å™¨ä¹‹åï¼Œéœ€è¦æ‰‹åŠ¨å‘å¸ƒäº‹ä»¶ï¼Œè¿™æ ·ç›‘å¬å™¨æ‰èƒ½ç›‘å¬åˆ°ï¼Œè¿™éœ€è¦æ ¹æ®å®é™…ä¸šåŠ¡åœºæ™¯æ¥è§¦å‘ï¼Œé’ˆå¯¹æœ¬æ–‡çš„ä¾‹å­ï¼Œæˆ‘å†™ä¸ªè§¦å‘é€»è¾‘ï¼Œå¦‚ä¸‹ï¼š
```java
/**
 * UserService
 * @author shengwu ni
 */
@Service
public class UserService {

    @Resource
    private ApplicationContext applicationContext;

    /**
     * å‘å¸ƒäº‹ä»¶
     * @return
     */
    public User getUser2() {
        User user = new User(1L, "å€ªå‡æ­¦", "123456");
        // å‘å¸ƒäº‹ä»¶
        MyEvent event = new MyEvent(this, user);
        applicationContext.publishEvent(event);
        return user;
    }
}
```
åœ¨ service ä¸­æ³¨å…¥ ApplicationContextï¼Œåœ¨ä¸šåŠ¡ä»£ç å¤„ç†å®Œä¹‹åï¼Œé€šè¿‡ ApplicationContext å¯¹è±¡æ‰‹åŠ¨å‘å¸ƒ MyEvent äº‹ä»¶ï¼Œè¿™æ ·æˆ‘ä»¬è‡ªå®šä¹‰çš„ç›‘å¬å™¨å°±èƒ½ç›‘å¬åˆ°ï¼Œç„¶åå¤„ç†ç›‘å¬å™¨ä¸­å†™å¥½çš„ä¸šåŠ¡é€»è¾‘ã€‚

æœ€åï¼Œåœ¨ Controller ä¸­å†™ä¸€ä¸ªæ¥å£æ¥æµ‹è¯•ä¸€ä¸‹ï¼š
```java
@GetMapping("/request")
public String getRequestInfo(HttpServletRequest request) {
    System.out.println("requestListenerä¸­çš„åˆå§‹åŒ–çš„nameæ•°æ®ï¼š" + request.getAttribute("name"));
    return "success";
}
```
åœ¨æµè§ˆå™¨ä¸­è¾“å…¥ `http://localhost:8080/listener/publish`ï¼Œç„¶åè§‚å¯Ÿä¸€ä¸‹æ§åˆ¶å°æ‰“å°çš„ç”¨æˆ·åå’Œå¯†ç ï¼Œå³å¯è¯´æ˜è‡ªå®šä¹‰ç›‘å¬å™¨å·²ç»ç”Ÿæ•ˆã€‚

## 4 æ€»ç»“

æœ¬è¯¾ç³»ç»Ÿçš„ä»‹ç»äº†ç›‘å¬å™¨åŸç†ï¼Œä»¥åŠåœ¨ Spring Boot ä¸­å¦‚ä½•ä½¿ç”¨ç›‘å¬å™¨ï¼Œåˆ—ä¸¾äº†ç›‘å¬å™¨çš„ä¸‰ä¸ªå¸¸ç”¨çš„æ¡ˆä¾‹ï¼Œæœ‰å¾ˆå¥½çš„å®æˆ˜æ„ä¹‰ã€‚æœ€åè®²è§£äº†é¡¹ç›®ä¸­å¦‚ä½•è‡ªå®šä¹‰äº‹ä»¶å’Œç›‘å¬å™¨ï¼Œå¹¶ç»“åˆå¾®æœåŠ¡ä¸­å¸¸è§çš„åœºæ™¯ï¼Œç»™å‡ºå…·ä½“çš„ä»£ç æ¨¡å‹ï¼Œå‡èƒ½è¿ç”¨åˆ°å®é™…é¡¹ç›®ä¸­å»ï¼Œå¸Œæœ›è¯»è€…è®¤çœŸæ¶ˆåŒ–ã€‚

è¯¾ç¨‹æºä»£ç ä¸‹è½½åœ°å€ï¼š[æˆ³æˆ‘ä¸‹è½½](https://gitee.com/eson15/springboot_study)

----

> æ–‡ç« å¯ä»¥ç™½å«–ï¼Œå…¬ä¼—å·ä¸èƒ½ä¸å…³æ³¨ï¼Œæ‰‹åŠ¨æ»‘ç¨½ğŸ¤£ğŸ¤£ &nbsp;
>
> æ¬¢è¿å¤§å®¶å…³æ³¨ï¼š**æ­¦å“¥èŠç¼–ç¨‹**ã€**Javaå¼€å‘å®å…¸**ï¼Œæ‚¨çš„æ”¯æŒï¼Œæ˜¯æˆ‘ä»¬åˆ›ä½œçš„æŒç»­åŠ¨åŠ›ï¼&nbsp;&nbsp;

![æ­¦å“¥èŠç¼–ç¨‹](https://img-blog.csdnimg.cn/202002150421550.jpg)![Javaå¼€å‘å®å…¸](https://img-blog.csdnimg.cn/20200608005630228.png)